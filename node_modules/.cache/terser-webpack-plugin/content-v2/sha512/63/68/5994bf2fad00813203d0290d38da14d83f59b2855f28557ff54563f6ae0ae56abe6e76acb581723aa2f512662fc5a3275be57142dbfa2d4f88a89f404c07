{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{mtpe:function(t,e,n){var r;window,t.exports=(r=function(){try{return n(!function(){var t=new Error(\"Cannot find module 'react-native'\");throw t.code=\"MODULE_NOT_FOUND\",t}())}catch(t){}}(),function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var o in t)n.d(r,o,(function(e){return t[e]}).bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"\",n(n.s=37)}([function(t,e,n){\"use strict\";e.__esModule=!0;var r,o,s,i=n(4);e.constants={DEFAULT_STORE:\"cometchat\",MSG_VER_PRE:\"store-ver-pre\",MSG_VER_POST:\"store-ver-post\"},e.DEFAULT_VALUES={MSGS_LIMIT:30,MSGS_MAX_LIMIT:100,CALL_TIMEOUT:45,DEFAULT_MSG_ID:0,DEFAULT_MAX_TYPING_INDICATOR_LIMIT:5},(r=e.GroupType||(e.GroupType={})).Public=\"public\",r.Private=\"private\",r.Protected=\"protected\",r.Password=\"password\",e.GROUP_TYPE={PUBLIC:\"public\",PRIVATE:\"private\",PROTECTED:\"password\",PASSWORD:\"password\"},(o=e.GroupMemberScope||(e.GroupMemberScope={})).Admin=\"admin\",o.Moderator=\"moderator\",o.Member=\"member\",e.GROUP_MEMBER_SCOPE={ADMIN:\"admin\",MODERATOR:\"moderator\",PARTICIPANT:\"participant\"},e.XMPP={host:\"encke.cometchat.com\",port:7443,bind_url:\"/ws/\",deafult_password:\"CometChat\",jid_string:\"[%s]%s@%s/%s\",bare_jid_string:\"[%s]%s@%s\",username_string:\"[%s]%s\",muc_jid_string:\"[%s]%s@%s.%s\",xmpp_resource:\"javascripts_\"+(new Date).getTime(),CONVERSATION:{TYPE:{CHAT:\"chat\",GROUP_CHAT:\"groupchat\"}}},e.LOCAL_STORE={COMMON_STORE:\"common_store\",MESSAGE_LISTENERS_LIST:\"message_listeners_list\",USERS_STORE:\"users_store\",MESSAGES_STORE:\"messages_store\",STORE_STRING:\"%s:%s\"},e.ResponseConstants={RESPONSE_KEYS:{KEY_DATA:\"data\",KEY_META:\"meta\",KEY_CURSOR:\"cursor\",KEY_ACTION:\"action\",KEY_MESSAGE:\"message\",KEY_ERROR:\"error\",KEY_ERROR_DETAILS:\"details\",KEY_ERROR_CODE:\"code\",KEY_ERROR_MESSAGE:\"message\",KEY_AUTH_TOKEN:\"authToken\",KEY_WS_CHANNEL:\"wsChannel\",KEY_IDENTITY:\"identity\",KEY_SERVICE:\"identity\",KEY_ENTITIES:\"entities\",KEY_ENTITITY:\"entity\",KEY_ATTACHMENTS:\"attachments\",CODE_REQUEST_OK:200,CODE_BAD_REQUEST:401}},e.DELIVERY_RECEIPTS={RECEIVER_ID:\"receiverId\",RECEIVER_TYPE:\"type\",RECIPIENT:\"recipient\",MESSAGE_ID:\"messageId\",RECEIVED:\"delivered\",DELIVERED_AT:\"deliveredAt\",ID:\"id\",TIME:\"time\"},e.READ_RECEIPTS={RECEIVER_ID:\"receiverId\",RECEIVER_TYPE:\"type\",RECIPIENT:\"recipient\",MESSAGE_ID:\"messageId\",READ:\"read\",READ_AT:\"readAt\",ID:\"id\",TIME:\"time\"},e.MessageConstatnts={XMPP_KEYS:{FROM:\"from\",TO:\"to\",TYPE:\"type\",TYPE_USER:\"chat\",TYPE_GROUP:\"groupchat\"},TYPE:{TEXT:\"text\",MEDIA:\"media\",IMAGE:\"image\",VIDEO:\"video\",AUDIO:\"audio\",FILE:\"file\",CUSTOM:\"custom\"},CATEGORY:{MESSAGE:\"message\",ACTION:\"action\",CALL:\"call\"},RECEIVER_TYPE:{USER:\"user\",GROUP:\"group\"},KEYS:{ATTATCHMENT:\"attatchment\",ATTATCHMENTS:\"attachments\",ACTION:\"action\",TYPE:\"type\",DATA:\"data\",ID:\"id\",MUID:\"muid\",SENDER:\"sender\",RECEIVER:\"receiver\",CATEGORY:\"category\",RECEIVER_TYPE:\"receiverType\",SENT_AT:\"sentAt\",STATUS:\"status\",TEXT:\"text\",URL:\"url\",METADATA:\"metadata\",RECEIPTS:\"receipts\",CUSTOM_DATA:\"customData\",CUSTOM_SUB_TYPE:\"subType\"},KNOWN_MEDIA_TYPE:{IMAGE:[],VIDEO:[],AUDIO:[],FILE:[]},PAGINATION:{AFFIX:{APPEND:\"append\",PREPEND:\"prepend\"},CURSOR_FILEDS:{ID:\"id\",SENT_AT:\"sentAt\"},CURSOR_AFFIX_DEFAULT:\"prepend\",CURSOR_FIELD_DEFAULT:\"sentAt\",KEYS:{PER_PAGE:\"per_page\",CURSOR_AFFIX:\"cursorAffix\",AFFIX:\"affix\",CURSOR_FIELD:\"cursorField\",CURSOR_VALUE:\"cursorValue\",UID:\"uid\",SENT_AT:\"sentAt\",ID:\"id\",CURRENT_PAGE:\"page\"}}},e.ATTACHMENTS_CONSTANTS={KEYS:{EXTENSION:\"extension\",MIME_TYPE:\"mimeType\",NAME:\"name\",SIZE:\"size\",URL:\"url\"}},(s=e.MessageCategory||(e.MessageCategory={})).ACTION=\"action\",s.MESSAGE=\"message\",s.CALL=\"call\",e.TYPING_NOTIFICATION={RECEIVER_ID:\"receiverId\",RECEIVER_TYPE:\"receiverType\",META:\"metadata\",KEYS:{TYPING_NOTIFICATION:\"typingNotification\",TIMESTAMP:\"timestamp\"},ACTIONS:{STARTED:\"started\",ENDED:\"ended\"}},e.ActionConstatnts={ACTION_SUBJECTS:{ACTION_ON:\"on\",ACTION_BY:\"by\",ACTION_FOR:\"for\"},ACTION_ENTITY_TYPE:{GROUP_USER:\"groupuser\",USER:\"user\",GROUP:\"group\"},ACTION_KEYS:{ACTION_CREATED:\"created\",ACTION_UPDATED:\"updated\",ACTION_DELETED:\"deleted\",ENTITY:\"entity\",ENTITY_TYPE:\"entityType\",TYPE_MEMBER_JOINED:\"joined\",TYPE_MEMBER_LEFT:\"left\",TYPE_MEMBER_KICKED:\"kicked\",TYPE_MEMBER_BANNED:\"banned\",TYPE_MEMBER_UNBANNED:\"unbanned\",TYPE_MEMBER_INVITED:\"invited\",ACTION_SCOPE_CHANGED:\"scopeChanged\",ACTION_TYPE_USER:\"user\",ACTION_TYPE_GROUP:\"group\",ACTION_TYPE_GROUP_MEMBER:\"groupMember\",ACTION_TYPE_CALL:\"call\"},ActionMessages:{ACTION_GROUP_JOINED_MESSAGE:\"%s joined %s\",ACTION_GROUP_LEFT_MESSAGE:\"%s left %s\",ACTION_MEMBER_KICKED_MESSAGE:\"%s kicked %s from %s\",ACTION_MEMBER_BANNED_MESSAGE:\"%s banned %s from %s\",ACTION_MEMBER_UNBANNED_MESSAGE:\"%s unbanned %s from %s\",ACTION_MEMBER_INVITED_MESSAGE:\"%s banned %s from %s\"},ACTION_TYPE:{TYPE_MEMBER_JOINED:\"joined\",TYPE_MEMBER_LEFT:\"left\",TYPE_MEMBER_KICKED:\"kicked\",TYPE_MEMBER_BANNED:\"banned\",TYPE_MEMBER_UNBANNED:\"unbanned\",TYPE_MEMBER_INVITED:\"invited\",TYPE_MEMBER_SCOPE_CHANGED:\"scopeChanged\"},ACTIONS:{MEMBER_JOINED:\"joined\",MEMBER_LEFT:\"left\",MEMBER_KICKED:\"kicked\",MEMBER_BANNED:\"banned\",MEMBER_UNBANNED:\"unbanned\",MEMBER_INVITED:\"invited\",MEMBER_SCOPE_CHANGED:\"scopeChanged\"}},e.CallConstants={CALL_TYPE_AUDIO:\"audio\",CALL_TYPE_VIDEO:\"video\",CALL_TYPE:{AUDIO:\"audio\",VIDEO:\"video\"},RECEIVER_TYPE_GROUP:\"group\",RECEIVER_TYPE_USER:\"user\",CALL_KEYS:{CALL_DATA:\"data\",CALL_ID:\"id\",CALL_SESSION_ID:\"sessionid\",CALL_RECEIVER:\"receiver\",CALL_SENDER:\"sender\",CALL_RECEIVER_TYPE:\"receiverType\",CALL_STATUS:\"status\",CALL_TYPE:\"type\",CALL_INITIATED_AT:\"initiatedAt\",CALL_JOINED_AT:\"joinedAt\",CALL_LEFT_AT:\"leftAt\",CALL_METADATA:\"metadata\",CALL_ENTITIES:\"entities\",CALL_ENTITY_TYPE:\"entityType\",CALL_ENTITY:\"entity\",CALL_ENTITY_USER:\"user\",CALL_ENTITY_GROUP:\"group\"},CALL_STATUS:{INITIATED:\"initiated\",ONGOING:\"ongoing\",UNANSWERED:\"unanswered\",REJECTED:\"rejected\",BUSY:\"busy\",CANCELLED:\"cancelled\",ENDED:\"ended\"}},e.GroupConstants={KEYS:{NAME:\"name\",GUID:\"guid\",TYPE:\"type\",PASSWORD:\"password\",ICON:\"icon\",DESCRIPTION:\"description\",OWNER:\"owner\",METADATA:\"metadata\",CREATED_AT:\"createdAt\",UPDATED_AT:\"updatedAt\",HAS_JOINED:\"hasJoined\",WS_CHANNEL:\"wsChannel\"}},e.GroupMemersConstans={KEYS:{SCOPE:\"scope\",UID:\"uid\",GUID:\"guid\",USER:\"user\"}},e.UserConstants={UID:\"uid\",NAME:\"name\",AUTH_TOKEN:\"authToken\",AVATAR:\"avatar\",CREDITS:\"credits\",EMAIL:\"email\",LAST_ACTIVE_AT:\"lastActiveAt\",LINK:\"link\",META_DATA:\"metaData\",ROLE:\"role\",STATUS:\"status\",STATUS_MESSAGE:\"statusMessage\",USER_NAME:\"user_name\"},e.Errors={ERROR_IO_EXCEPTION:\"ERROR_IO_EXCEPTION\",ERROR_JSON_EXCEPTION:\"ERROR_JSON_EXCEPTION\",ERROR_PASSWORD_MISSING:\"ERROR_PASSWORD_MISSING\",ERROR_LIMIT_EXCEEDED:\"ERROR_LIMIT_EXCEEDED\",ERROR_USER_NOT_LOGGED_IN:\"ERROR_USER_NOT_LOGGED_IN\",ERROR_INVALID_GUID:\"ERROR_INVALID_GUID\",ERROR_PASSWORD_MISSING_MESSAGE:\"Password is mandatory for a password group\",ERROR_LIMIT_EXCEEDED_MESSAGE:\"Limit Exceeded Max limit of %s\",ERROR_USER_NOT_LOGGED_IN_MESSAGE:\"Please log in to CometChat before calling this method\",ERROR_INVALID_GUID_MESSAGE:\"Please provide a valid GUID\",ERROR_DEFAULT_MESSAGE:\"Something went wrong\"},e.CALL_ERROR={CALL_ALREADY_INITIATED:{code:\"CALL_ALREADY_INITIATED\",name:\"CALL_ALREADY_INITIATED\",message:\"There is already call in progress\",details:{}},ERROR_IN_CALLING:{code:\"CALL_IN_PROGRESS\",name:\"CALL_ALREADY_INITIATED\",message:\"There is already call in progress\",details:{}}},e.PARAMETER_ERROR={PARAMETER_REQUIRED:{code:\"%s_NOT_PROVIDED\",name:\"%s_NOT_PROVIDED\",message:\"please provide the %s\",details:{}}},e.GroupErrors={NOT_A_GROUP:new i.CometChatException({code:\"NOT_A_GROUP\",message:\"Please use group class to construct a new group\"})},e.PresenceConstatnts={XMPP_KEYS:{FROM:\"from\",STATUS:\"status\",LAST_ACTIVE_AT:\"lastActiveAt\",TYPE:\"type\"},STATUS:{ONLINE:\"online\",OFFLINE:\"offline\",JOINED:\"JOINED\",LEFT:\"LEFT\"}},e.APP_SETTINGS={APP_SETTINGS:\"app_settings\",KEYS:{CHAT_HOST:\"CHAT_HOST\",CHAT_USE_SSL:\"CHAT_USE_SSL\",GROUP_SERVICE:\"GROUP_SERVICE\",CALL_SERVICE:\"CALL_SERVICE\",CHAT_WS_PORT:\"CHAT_WS_PORT\",CHAT_WSS_PORT:\"CHAT_WSS_PORT\",CHAT_HTTP_BIND_PORT:\"CHAT_HTTP_BIND_PORT\",CHAT_HTTPS_BIND_PORT:\"CHAT_HTTPS_BIND_PORT\",ADMIN_API_HOST:\"ADMIN_API_HOST\",CLIENT_API_HOST:\"CLIENT_API_HOST\",WEBRTC_HOST:\"WEBRTC_HOST\",WEBRTC_USE_SSL:\"WEBRTC_USE_SSL\",WEBRTC_WS_PORT:\"WEBRTC_WS_PORT\",WEBRTC_WSS_PORT:\"WEBRTC_WSS_PORT\",WEBRTC_HTTP_BIND_PORT:\"WEBRTC_HTTP_BIND_PORT\",WEBRTC_HTTPS_BIND_PORT:\"WEBRTC_HTTPS_BIND_PORT\",EXTENSION_LIST:\"extensions\",EXTENSION_KEYS:{ID:\"id\",NAME:\"name\"}}}},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(5),o=n(0),s=n(6),i=n(4);function a(t){return null!=t&&(\"string\"==typeof t&&(t=t.trim()),\"object\"==typeof t&&0===Object.keys(t).length&&(t=void 0)),[\"\",0,\"0\",!1,null,\"null\",void 0,\"undefined\"].includes(t)}e.isObject=function(t){return t instanceof Object&&t.constructor===Object},e.isTruthy=function(t){return[!0,1,\"1\",\"true\",\"TRUE\"].includes(t)},e.isFalsy=a,e.getOrdinalSuffix=function(t){var e=t%10,n=t%100;return 1==e&&11!=n?t+\"st\":2==e&&12!=n?t+\"nd\":3==e&&13!=n?t+\"rd\":t+\"th\"},e.format=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.split(\"%s\").reduce(function(t,n,r){return t+n+(e[r]||\"\")},\"\")},e.createUidFromJid=function(t){return t.substring(t.lastIndexOf(\"]\")+1,t.lastIndexOf(\"@\"))};var c=function(){function t(){}return t.log=function(t,e){},t.error=function(t,e){},t.info=function(t,e){},t}();function u(){return new Promise(function(t,e){s.makeApiCall(\"appSettings\").then(function(e){r.LocalStorage.getInstance().set(\"app_settings\",e.data),t(e.data)},function(t){e(new i.CometChatException(t.error))})})}e.Logger=c,e.getCurrentTime=function(){return(new Date).getTime()},e.getAppSettings=function(){return new Promise(function(t,e){r.LocalStorage.getInstance().get(o.APP_SETTINGS.APP_SETTINGS).then(function(n){a(n)?u().then(function(e){t(e)},function(t){e(t)}):t(n)},function(t){e(t)})})},e.getUpdatedSettings=u,e.isImage=function(t){var e;return t.type&&t.type.toLowerCase().includes(\"image\")&&(e=!0),e},e.isVideo=function(t){var e;return t.type&&t.type.toLowerCase().includes(\"video\")&&(e=!0),e},e.isAudio=function(t){var e;return t.type&&t.type.toLowerCase().includes(\"audio\")&&(e=!0),e}},function(t,e,n){\"use strict\";(function(t){var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,s){function i(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(i,a)}c((r=r.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},\"function\"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError(\"Generator is already executing.\");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(a){s=[6,a],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};e.__esModule=!0;var i=n(22),a=n(1),c=n(4),u=n(6),l=n(3),h=n(7),d=n(12),p=n(5),f=n(24),g=n(23),E=n(13),m=n(16),_=n(31),T=n(0),C=n(18),S=n(32),A=n(33),y=n(15),I=n(19),v=n(27),N=n(34),M=n(17),R=n(46),O=n(47),P=n(49),b=n(50),L=n(20),w=n(28),D=n(29),x=n(25),U=n(35),Y=n(51),G=n(30),F=n(14),H=h.XMPPConnectionHelper.getInstance(),k=function(){function e(r){\"undefined\"!=typeof document?a.Logger.info(\"This is browser\",\"we have everything\"):\"undefined\"!=typeof navigator&&\"ReactNative\"==navigator.product?(a.Logger.info(\"This is react-native\",\"we do not have dom\"),t.DOMParser=n(52).DOMParser,t.document=(new t.DOMParser).parseFromString(\"<?xml version='1.0'?>\",\"text/xml\"),e.isNative=!0):a.Logger.info(\"This is node\",\"we do not have anything\"),e.typingTimer(),e.appId=r,e.messagesStore=m.MessagesStore.getInstance(),e.localStorage=p.LocalStorage.getInstance(),e.userStore=A.UserStore.getInstance(),e.messageListnerMaping=L.MessageListnerMaping.getInstance()}return e.setAuthToken=function(t){e.authToken=t},e.prototype.getAuthToken=function(){return e.authToken},e.getAppId=function(){return e.appId},e.prototype.getApiKey=function(){return e.apiKey},e.init=function(t){var n=this;return void 0===t&&(t=\"\"),new Promise(function(r,o){\"object\"==typeof t&&t.hasOwnProperty(\"appId\")&&(t=t.appId),a.isFalsy(t)?o(new c.CometChatException(N.INIT_ERROR.NO_APP_ID)):(n.initialzed=!0,n.getInstance(t)),e.localStorage.get(\"user\").then(function(t){t?(e.user=new l.Me(t),e.setAuthToken(e.user.getAuthToken()),e.XMPPLogin(e.user,function(){r()},function(){e.logout()})):r()})})},e.isInitialized=function(){return this.initialzed},e.getInstance=function(t){return this.cometChat||(this.cometChat=new e(t)),this.cometChat},e.login=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(\"object\"==typeof n[0]){var o=n[0];n[0].hasOwnProperty(\"authToken\")?n[0]=o.authToken:n[0].hasOwnProperty(\"username\")&&n[0].hasOwnProperty(\"apiKey\")&&(n[0]=o.username,n[1]=o.apiKey)}return new Promise(function(r,o){if(2==n.length?(a.isFalsy(n[0])||a.isFalsy(n[1]))&&o(new c.CometChatException(N.ERRORS.PARAMETER_MISSING)):1==n.length?a.isFalsy(n[0])&&o(new c.CometChatException(N.ERRORS.PARAMETER_MISSING)):o(new c.CometChatException(N.ERRORS.PARAMETER_MISSING)),!a.isFalsy(t.getAppId()))return e.localStorage.get(\"user\").then(function(s){if(2!=n.length)return e.authToken=n[0],e.isSecure=!0,t.getLoggedinUser().then(function(i){null!=s&&s.uid!==i.uid?e.messagesStore.clearStore().then(function(){e.userStore.clearStore().then(function(){e.localStorage.clearStore().then(function(){(e.user=new l.Me(i)).setAuthToken(n[0]),e.setAuthToken(n[0]),F.ExtensionController.hookOnLogin(e.user),e.XMPPLogin(e.user,r,o)})})}):(t.user=new l.Me(i),t.user.setAuthToken(n[0]),t.setAuthToken(n[0]),F.ExtensionController.hookOnLogin(e.user),t.XMPPLogin(t.user,r,o))},function(t){o(new c.CometChatException(t.error))});e.isSecure=!1,e.apiKey=n[1];var i=n[0];null!=s&&s.uid!==n[0]?t.messagesStore.clearStore().then(function(){e.userStore.clearStore().then(function(){e.localStorage.clearStore().then(function(){e.generateAuthToken(i).then(function(t){e.user=new l.Me(t),e.setAuthToken(e.user.getAuthToken()),e.getLoggedinUser().then(function(t){(e.user=new l.Me(t)).setAuthToken(e.authToken),e.setAuthToken(e.user.getAuthToken()),F.ExtensionController.hookOnLogin(e.user),e.XMPPLogin(e.user,r,o)},function(t){o(new c.CometChatException(t.error))})},function(t){o(new c.CometChatException(t))})})})}):a.isFalsy(e.authToken)?a.isFalsy(i)||(a.isFalsy(e.apiKey)?o(new c.CometChatException(N.LOGIN_ERROR.UNAUTHORISED)):t.generateAuthToken(i).then(function(n){t.user=new l.Me(n),t.setAuthToken(e.user.getAuthToken()),t.getLoggedinUser().then(function(n){t.user=new l.Me(n),t.user.setAuthToken(e.authToken),t.setAuthToken(t.user.getAuthToken()),F.ExtensionController.hookOnLogin(e.user),t.XMPPLogin(t.user,r,o)},function(t){o(new c.CometChatException(t.error))})},function(t){o(new c.CometChatException(t))})):(F.ExtensionController.hookOnLogin(e.user),t.XMPPLogin(t.user,r,o))});o(new c.CometChatException(N.LOGIN_ERROR.NOT_INITIALIZED))})},e.sendMessage=function(t){return o(this,void 0,void 0,function(){var e,n,r=this;return s(this,function(i){switch(i.label){case 0:return t instanceof g.TextMessage||t instanceof f.MediaMessage||t instanceof x.CustomMessage||(t=t[T.MessageConstatnts.KEYS.ATTATCHMENT]?(e=T.MessageConstatnts.TYPE.FILE,a.isImage(t[T.MessageConstatnts.KEYS.ATTATCHMENT])?e=T.MessageConstatnts.TYPE.IMAGE:a.isAudio(t[T.MessageConstatnts.KEYS.ATTATCHMENT])?e=T.MessageConstatnts.TYPE.AUDIO:a.isVideo(t[T.MessageConstatnts.KEYS.ATTATCHMENT])&&(e=T.MessageConstatnts.TYPE.VIDEO),new f.MediaMessage(t[T.MessageConstatnts.KEYS.RECEIVER],t[T.MessageConstatnts.KEYS.ATTATCHMENT],e,t[T.MessageConstatnts.KEYS.RECEIVER_TYPE])):new g.TextMessage(t[T.MessageConstatnts.KEYS.RECEIVER],t[T.MessageConstatnts.KEYS.TEXT],T.MessageConstatnts.TYPE.TEXT,t[T.MessageConstatnts.KEYS.RECEIVER_TYPE])),[4,F.ExtensionController.hookBeforeMessageSent(t)];case 1:return n=i.sent(),t=n,[2,new Promise(function(e,n){return u.makeApiCall(\"sendMessage\",{},t,t instanceof f.MediaMessage).then(function(t){return o(r,void 0,void 0,function(){var n,r;return s(this,function(o){switch(o.label){case 0:return n=E.MessageController.trasformJSONMessge(t.data),[4,F.ExtensionController.hookAfterMessageSent(n)];case 1:return r=o.sent(),e(n=r),[2]}})})},function(t){n(new c.CometChatException(t.error))})})]}})})},e.sendDirectMessage=function(t){return Object.assign(t,{receiverType:T.MessageConstatnts.RECEIVER_TYPE.USER}),this.sendMessage(t)},e.sendGroupMessage=function(t){return Object.assign(t,{receiverType:T.MessageConstatnts.RECEIVER_TYPE.GROUP}),this.sendMessage(t)},e.sendMediaMessage=function(t){return this.sendMessage(t)},e.sendCustomMessage=function(t){return this.sendMessage(t)},e.getLastDeliveredMessageId=function(t){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,L.MessageListnerMaping.getInstance().get(\"all\")];case 1:return[2,t.sent()]}})})},e.startTyping=function(t){if(!a.isFalsy(t)){var n,r=this.RECEIVER_TYPE.USER,o={};if(t instanceof w.TypingIndicator)n=t.getReceiverId(),r=t.getReceiverType(),o=t.getMetadata();else{if(!t.hasOwnProperty(T.TYPING_NOTIFICATION.RECEIVER_ID))return;n=t[T.TYPING_NOTIFICATION.RECEIVER_ID],t.hasOwnProperty(T.TYPING_NOTIFICATION.RECEIVER_TYPE)&&(r=t[T.TYPING_NOTIFICATION.RECEIVER_TYPE]),t.hasOwnProperty(T.TYPING_NOTIFICATION.META)&&(o=t[T.TYPING_NOTIFICATION.META])}a.isFalsy(n)||(r=r==this.RECEIVER_TYPE.USER?T.XMPP.CONVERSATION.TYPE.CHAT:T.XMPP.CONVERSATION.TYPE.GROUP_CHAT,(D.TypingNotificationController.getTypingStartedMap(n)&&a.getCurrentTime()-D.TypingNotificationController.getTypingStartedMap(n)>=1e3*T.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT||null==D.TypingNotificationController.getTypingStartedMap(n))&&a.getAppSettings().then(function(t){switch(r){case T.XMPP.CONVERSATION.TYPE.CHAT:H.sendTypingStarted(a.format(T.XMPP.bare_jid_string,e.getAppId(),n,t[T.APP_SETTINGS.KEYS.CHAT_HOST]),r,o);break;case T.XMPP.CONVERSATION.TYPE.GROUP_CHAT:H.sendTypingStarted(a.format(T.XMPP.muc_jid_string,e.getAppId(),n,t[T.APP_SETTINGS.KEYS.GROUP_SERVICE],t[T.APP_SETTINGS.KEYS.CHAT_HOST]),r,o)}D.TypingNotificationController.addTypingStarted(n)},function(t){}))}},e.endTyping=function(t){if(!a.isFalsy(t)){var n,r=this.RECEIVER_TYPE.USER,o={};if(t instanceof w.TypingIndicator)n=t.getReceiverId(),r=t.getReceiverType(),o=t.getMetadata();else{if(!t.hasOwnProperty(T.TYPING_NOTIFICATION.RECEIVER_ID))return;n=t[T.TYPING_NOTIFICATION.RECEIVER_ID],t.hasOwnProperty(T.TYPING_NOTIFICATION.RECEIVER_TYPE)&&(r=t[T.TYPING_NOTIFICATION.RECEIVER_TYPE]),r=r==this.RECEIVER_TYPE.USER?T.XMPP.CONVERSATION.TYPE.CHAT:T.XMPP.CONVERSATION.TYPE.GROUP_CHAT,t.hasOwnProperty(T.TYPING_NOTIFICATION.META)&&(o=t[T.TYPING_NOTIFICATION.META])}if(a.isFalsy(n))return;D.TypingNotificationController.getTypingStartedMap(n)&&a.getCurrentTime()-D.TypingNotificationController.getTypingStartedMap(n)<1e3*T.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT&&(D.TypingNotificationController.getTypingEndedMap(n)&&a.getCurrentTime()-D.TypingNotificationController.getTypingEndedMap(n)>=1e3*T.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT||null==D.TypingNotificationController.getTypingEndedMap(n))&&a.getAppSettings().then(function(t){switch(r){case T.XMPP.CONVERSATION.TYPE.CHAT:H.sendTypingPaused(a.format(T.XMPP.bare_jid_string,e.getAppId(),n,t[T.APP_SETTINGS.KEYS.CHAT_HOST]),r,o);break;case T.XMPP.CONVERSATION.TYPE.GROUP_CHAT:H.sendTypingPaused(a.format(T.XMPP.muc_jid_string,e.getAppId(),n,t[T.APP_SETTINGS.KEYS.GROUP_SERVICE],t[T.APP_SETTINGS.KEYS.CHAT_HOST]),r,o)}D.TypingNotificationController.addTypingEnded(n)},function(t){})}},e.markMessageAsRead=function(t){t instanceof Object?(t.hasOwnProperty(T.READ_RECEIPTS.RECEIVER_ID)&&t.hasOwnProperty(T.MessageConstatnts.KEYS.RECEIVER_TYPE),t.hasOwnProperty(T.READ_RECEIPTS.MESSAGE_ID)):t=E.MessageController.trasformJSONMessge(t),t.getId(),t.getSender().getUid(),t.getReceiver(),t.getReceiverType(),h.XMPPConnectionHelper.getInstance().markAsRead(t.getSender().getUid(),t.getReceiverType(),t.getId().toString(),t.getReceiver())},e.getMessageDetails=function(t){return u.makeApiCall(\"getMessageDetails\",{messageId:t}).then(function(t){E.MessageController.trasformJSONMessge(t.data)},function(t){a.Logger.error(\"CometChat:GetMessageDetails:\",t)})},e.getPreviousMessagesByTimestamp=function(t,e){return new Promise(function(n,r){a.isFalsy(e)?r(new c.CometChatException(JSON.parse(a.format(JSON.stringify(T.PARAMETER_ERROR.PARAMETER_REQUIRED),\"TIMESTAMP\",\"TIMESTAMP\",\"timestamp\")))):E.MessageController.getAllMessage(t,e,T.MessageConstatnts.PAGINATION.CURSOR_FILEDS.SENT_AT,T.MessageConstatnts.PAGINATION.AFFIX.PREPEND).then(function(t){return n(t)},function(t){return r(t)})})},e.getPreviousMessagesById=function(t,e){return new Promise(function(n,r){a.isFalsy(e)?r(new c.CometChatException(JSON.parse(a.format(JSON.stringify(T.PARAMETER_ERROR.PARAMETER_REQUIRED),\"ID\",\"ID\",\"id\")))):E.MessageController.getAllMessage(t,e,T.MessageConstatnts.PAGINATION.CURSOR_FILEDS.ID,T.MessageConstatnts.PAGINATION.AFFIX.PREPEND).then(function(t){return n(t)},function(t){return r(t)})})},e.getNextMessagesByTimestamp=function(t,e){return new Promise(function(n,r){a.isFalsy(e)?r(new c.CometChatException(JSON.parse(a.format(JSON.stringify(T.PARAMETER_ERROR.PARAMETER_REQUIRED),\"TIMESTAMP\",\"TIMESTAMP\",\"timestamp\")))):E.MessageController.getAllMessage(t,e,T.MessageConstatnts.PAGINATION.CURSOR_FILEDS.SENT_AT,T.MessageConstatnts.PAGINATION.AFFIX.APPEND).then(function(t){return n(t)},function(t){return r(t)})})},e.getNextMessagesById=function(t,e){return new Promise(function(n,r){a.isFalsy(e)?r(new c.CometChatException(JSON.parse(a.format(JSON.stringify(T.PARAMETER_ERROR.PARAMETER_REQUIRED),\"ID\",\"ID\",\"id\")))):E.MessageController.getAllMessage(t,e,T.MessageConstatnts.PAGINATION.CURSOR_FILEDS.ID,T.MessageConstatnts.PAGINATION.AFFIX.APPEND).then(function(t){return n(t)},function(t){return r(t)})})},e.getUser=function(t){return new Promise(function(n,r){\"object\"==typeof t&&t.hasOwnProperty(\"uid\")&&(t=t.uid),u.makeApiCall(\"user\",{uid:t}).then(function(t){var r=_.UsersController.trasformJSONUser(t.data),o=[];o.push(a.format(T.XMPP.username_string,e.getAppId(),t.data[T.UserConstants.UID])),h.XMPPConnectionHelper.getInstance().getPresenceInfo(o,function(t){o.map(function(e,o){r.setLastActiveAt(t[o].getLastActiveAt()),r.setStatus(t[o].getStatus()),n(r)})})}).catch(function(t){r(new c.CometChatException(t.error))})})},e.getLoggedinUser=function(){return new Promise(function(t,n){e.localStorage.get(\"user\").then(function(r){r?t(e.user=new l.Me(r)):u.makeApiCall(\"getMyDetails\").then(function(e){t(e.data)},function(t){n(new c.CometChatException(t.error))}).catch(function(t){n(t)})},function(t){n(new c.CometChatException(t.error))})})},e.createGroup=function(t){return new Promise(function(e,n){if(!(t instanceof C.Group)){var r=void 0;if(!t.hasOwnProperty(T.GroupConstants.KEYS.GUID))return void n(new c.CometChatException(N.ERRORS.PARAMETER_MISSING));if(!t.hasOwnProperty(T.GroupConstants.KEYS.NAME))return void n(new c.CometChatException(N.ERRORS.PARAMETER_MISSING));if(r=new C.Group(t[T.GroupConstants.KEYS.GUID],t[T.GroupConstants.KEYS.NAME],\"\"),t.hasOwnProperty(T.GroupConstants.KEYS.TYPE))if(t[T.GroupConstants.KEYS.TYPE].toLocaleLowerCase()==T.GroupType.Password){if(!t.hasOwnProperty(T.GroupConstants.KEYS.PASSWORD))return void n(new c.CometChatException(N.GROUP_CREATION_ERRORS.EMPTY_PASSWORD));r.setType(T.GROUP_TYPE.PASSWORD),r.setPassword(t[T.GroupConstants.KEYS.PASSWORD])}else r.setType(t[T.GroupConstants.KEYS.TYPE]);else r.setType(T.GROUP_TYPE.PUBLIC);t.hasOwnProperty(T.GroupConstants.KEYS.ICON)&&r.setIcon(t[T.GroupConstants.KEYS.ICON]),t.hasOwnProperty(T.GroupConstants.KEYS.DESCRIPTION)&&r.setDescription(t[T.GroupConstants.KEYS.DESCRIPTION]),t=r}u.makeApiCall(\"createGroup\",{},t).then(function(n){H.joinMuc(t),S.GroupsController.trasformJSONGroup(n.data).setHasJoined(!0),e(S.GroupsController.trasformJSONGroup(n.data))},function(t){n(new c.CometChatException(t.error))})})},e.getGroup=function(t){return\"object\"==typeof t&&t.hasOwnProperty(\"guid\")&&(t=t.guid),new Promise(function(e,n){u.makeApiCall(\"getGroup\",{guid:t}).then(function(t){e(S.GroupsController.trasformJSONGroup(t.data))},function(t){n(new c.CometChatException(t.error))})})},e.joinGroup=function(t,e,n){return void 0===e&&(e=T.GroupType.Public),void 0===n&&(n=\"\"),new Promise(function(r,o){var s;\"object\"==typeof t&&(t.hasOwnProperty(T.GroupConstants.KEYS.GUID)?(t.hasOwnProperty(T.GroupConstants.KEYS.TYPE)&&(e=t[T.GroupConstants.KEYS.TYPE],t[T.GroupConstants.KEYS.TYPE].toLocaleLowerCase()===T.GroupType.Password&&t.hasOwnProperty(T.GroupConstants.KEYS.PASSWORD)&&(n=t[T.GroupConstants.KEYS.PASSWORD])),t=t[T.GroupConstants.KEYS.GUID]):o(new c.CometChatException(N.ERRORS.PARAMETER_MISSING))),s=a.isFalsy(n)?new C.Group(t,\"name\",e):new C.Group(t,\"name\",e,n),u.makeApiCall(\"joinGroup\",s,s).then(function(t){H.joinMuc(s);var e=S.GroupsController.trasformJSONGroup(t.data[T.ResponseConstants.RESPONSE_KEYS.KEY_DATA][T.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][T.ActionConstatnts.ACTION_KEYS.ENTITY]);e.setHasJoined(!0),r(e)},function(t){o(new c.CometChatException(t.error))})})},e.updateGroup=function(t){return new Promise(function(e,n){if(!(t instanceof C.Group)){var r=void 0;if(!t.hasOwnProperty(T.GroupConstants.KEYS.GUID))return void n(new c.CometChatException(N.ERRORS.PARAMETER_MISSING));r=new C.Group(T.GroupConstants.KEYS.GUID,\"\",\"\"),t.hasOwnProperty(T.GroupConstants.KEYS.TYPE)?r.setType(t[T.GroupConstants.KEYS.TYPE]):t[T.GroupConstants.KEYS.TYPE]=T.GROUP_TYPE.PUBLIC,t.hasOwnProperty(T.GroupConstants.KEYS.NAME)&&r.setName(t[T.GroupConstants.KEYS.NAME]),t.hasOwnProperty(T.GroupConstants.KEYS.ICON)&&r.setIcon(t[T.GroupConstants.KEYS.ICON]),t.hasOwnProperty(T.GroupConstants.KEYS.DESCRIPTION)&&r.setDescription(t[T.GroupConstants.KEYS.DESCRIPTION]),t=r}u.makeApiCall(\"updateGroup\",t,t).then(function(t){e(S.GroupsController.trasformJSONGroup(t.data))},function(t){n(new c.CometChatException(t.error))})})},e.deleteGroup=function(t){return new Promise(function(e,n){u.makeApiCall(\"deleteGroup\",{guid:t}).then(function(t){e(!0)},function(t){n(new c.CometChatException(t.error))})})},e.leaveGroup=function(t){return new Promise(function(e,n){u.makeApiCall(\"leaveGroup\",{guid:t}).then(function(n){H.leaveMuc(t),e(!0)},function(t){n(new c.CometChatException(t.error))})})},e.kickGroupMember=function(t,e){return new Promise(function(n,r){u.makeApiCall(\"kickGroupMembers\",{guid:t,uid:e}).then(function(t){n(!0)},function(t){r(new c.CometChatException(t.error))})})},e.updateGroupMemberScope=function(t,e,n){return new Promise(function(r,o){u.makeApiCall(\"changeScopeOfMember\",{guid:t,uid:e},{scope:n}).then(function(t){r(!0)},function(t){o(new c.CometChatException(t.error))})})},e.banGroupMember=function(t,e){return new Promise(function(n,r){u.makeApiCall(\"banGroupMember\",{guid:t,uid:e}).then(function(t){n(!0)},function(t){r(new c.CometChatException(t.error))})})},e.unbanGroupMember=function(t,e){return new Promise(function(n,r){u.makeApiCall(\"unbanGroupMember\",{guid:t,uid:e}).then(function(t){n(!0)},function(t){r(new c.CometChatException(t.error))})})},e.addMembersToGroup=function(t,e,n){var o=[],s=[],i=[],l=[];return new Promise(function(h,d){a.isFalsy(e)&&a.isFalsy(n)?d(new c.CometChatException({})):a.isFalsy(e)||a.isFalsy(n)?a.isFalsy(e)?n.map(function(t){l.push(t.getUid())}):(e.filter(function(t){if(t.getScope()==T.GROUP_MEMBER_SCOPE.ADMIN)return!0}).map(function(t){o.push(t.getUid())}),e.filter(function(t){if(t.getScope()==T.GROUP_MEMBER_SCOPE.MODERATOR)return!0}).map(function(t){s.push(t.getUid())}),e.filter(function(t){if(t.getScope()==T.GROUP_MEMBER_SCOPE.PARTICIPANT)return!0}).map(function(t){i.push(t.getUid())})):(e.filter(function(t){if(t.getScope()==T.GROUP_MEMBER_SCOPE.ADMIN)return!0}).map(function(t){o.push(t.getUid())}),e.filter(function(t){if(t.getScope()==T.GROUP_MEMBER_SCOPE.MODERATOR)return!0}).map(function(t){s.push(t.getUid())}),e.filter(function(t){if(t.getScope()==T.GROUP_MEMBER_SCOPE.PARTICIPANT)return!0}).map(function(t){i.push(t.getUid())}),n.map(function(t){l.push(t.getUid())}));var p={};a.isFalsy(o)||(p=r({},p,{admin:o})),a.isFalsy(i)||(p=r({},p,{participant:i})),a.isFalsy(s)||(p=r({},p,{moderator:s})),a.isFalsy(l)||(p=r({},p,{banneduser:l})),u.makeApiCall(\"addMemebersToGroup\",{guid:t},p).then(function(t){h(t)},function(t){d(new c.CometChatException(t.error))})})},e.initiateCall=function(t){return new Promise(function(e,n){a.isFalsy(JSON.parse(JSON.stringify(t)).sender)?a.isFalsy(v.CallController.getInstance().getActiveCall())?(t.setStatus(T.CallConstants.CALL_STATUS.INITIATED),u.makeApiCall(\"createCallSession\",{},t).then(function(t){var r=E.MessageController.trasformJSONMessge(t[T.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);v.CallController.getInstance().initiateCall(r).then(function(t){e(r)}).catch(function(t){n(t)})},function(t){n(new c.CometChatException(t.error))})):n(new c.CometChatException(T.CALL_ERROR.ERROR_IN_CALLING)):v.CallController.getInstance().initiateCall(t).then(function(n){e(Object.assign(t))}).catch(function(t){n(t)})})},e.acceptCall=function(t){return new Promise(function(e,n){var r={};r[T.CallConstants.CALL_KEYS.CALL_STATUS]=T.CallConstants.CALL_STATUS.ONGOING,u.makeApiCall(\"updateCallSession\",{sessionid:t},r).then(function(t){var n=E.MessageController.trasformJSONMessge(t[T.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);v.CallController.getInstance().onCallStarted(n),e(n)},function(t){n(new c.CometChatException(t.error))})})},e.rejectCall=function(t,e){switch(e){case T.CallConstants.CALL_STATUS.REJECTED:return this.rejectIncomingCall(t);case T.CallConstants.CALL_STATUS.CANCELLED:return this.cancelCall(t);case T.CallConstants.CALL_STATUS.BUSY:return this.sendBusyResponse(t);default:return this.endCall(t)}},e.endCall=function(t){return new Promise(function(e,n){var r={};r[T.CallConstants.CALL_KEYS.CALL_STATUS]=T.CallConstants.CALL_STATUS.ENDED,v.CallController.getInstance().getActiveCall().getJoinedAt()&&(r[T.CallConstants.CALL_KEYS.CALL_JOINED_AT]=v.CallController.getInstance().getActiveCall().getJoinedAt()),u.makeApiCall(\"updateCallSession\",{sessionid:t},r).then(function(t){var n=E.MessageController.trasformJSONMessge(t[T.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);v.CallController.getInstance().endCall(),e(n)},function(t){a.Logger.log(\"calling Log\",{error:t});var n=v.CallController.getInstance().getActiveCall();n.setStatus(T.CallConstants.CALL_STATUS.ENDED),e(n),v.CallController.getInstance().endCall()})})},e.getActiveCall=function(){return v.CallController.getInstance().getActiveCall()},e.startCall=function(t,e,n,r){v.CallController.getInstance().startCall(e,n,r)},e.toggleAudio=function(){v.CallController.toggleAudio()},e.toggleVideo=function(){v.CallController.toggleVideo()},e.leaveCall=function(){v.CallController.leave()},e.createCallView=function(t){return{prop1:this.makeCall,onMessage:function(t){v.CallController.getInstance().getCallListner()._eventListener.onCallEnded(v.CallController.getInstance().getActiveCall()),e.endCall(v.CallController.getInstance().getActiveCall().getSessionId()).then(function(t){}).catch(function(t){})}}},e.makeCall=function(t,e){t.setState(function(t){return r({},t,{uri:e})})},e.rejectIncomingCall=function(t){return new Promise(function(e,n){var r={};r[T.CallConstants.CALL_KEYS.CALL_STATUS]=T.CallConstants.CALL_STATUS.REJECTED,u.makeApiCall(\"updateCallSession\",{sessionid:t},r).then(function(t){var n=E.MessageController.trasformJSONMessge(t[T.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);e(n)},function(t){n(new c.CometChatException(t.error))})})},e.cancelCall=function(t){return new Promise(function(e,n){var r={};r[T.CallConstants.CALL_KEYS.CALL_STATUS]=T.CallConstants.CALL_STATUS.CANCELLED,u.makeApiCall(\"updateCallSession\",{sessionid:t},r).then(function(t){var n=E.MessageController.trasformJSONMessge(t[T.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);v.CallController.getInstance().endCallSession(),e(n)},function(t){n(new c.CometChatException(t.error))})})},e.sendBusyResponse=function(t){return new Promise(function(e,n){var r={};r[T.CallConstants.CALL_KEYS.CALL_STATUS]=T.CallConstants.CALL_STATUS.BUSY,u.makeApiCall(\"updateCallSession\",{sessionid:t},r).then(function(t){var n=E.MessageController.trasformJSONMessge(t[T.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);e(n)},function(t){n(new c.CometChatException(t.error))})})},e.sendUnansweredResponse=function(t){return new Promise(function(e,n){var r={};r[T.CallConstants.CALL_KEYS.CALL_STATUS]=T.CallConstants.CALL_STATUS.UNANSWERED,u.makeApiCall(\"updateCallSession\",{sessionid:t},r).then(function(t){var n=E.MessageController.trasformJSONMessge(t[T.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);h.XMPPConnectionHelper.getInstance().trigerMessageHandler(Object.assign(n,t[T.ResponseConstants.RESPONSE_KEYS.KEY_DATA])),e(n)},function(t){n(new c.CometChatException(t.error))})})},e.addMessageListener=function(t,e){H.addMessageEventListener(t,e)},e.removeMessageListener=function(t){H.removeMessageEventListener(t)},e.addCallListener=function(t,e){H.addCallEventListener(t,e)},e.removeCallListener=function(t){H.removeCallEventListener(t)},e.addUserListener=function(t,e){H.addUserEventListener(t,e)},e.removeUserListener=function(t){H.removeUserEventListener(t)},e.addGroupListener=function(t,e){H.addGroupEventListener(t,e)},e.removeGroupListener=function(t){H.removeGroupEventListener(t)},e.generateAuthToken=function(t){return new Promise(function(e,n){u.makeApiCall(\"authToken\",{uid:t}).then(function(t){e(t.data)}).catch(function(t){n(new c.CometChatException(t.error))})})},e.XMPPLogin=function(t,e,n){var r=this;H.XMMPLogin(t.getUid(),t.getWsChannel().secret,function(o){switch(o){case d.Strophe.Status.CONNFAIL:n(new c.CometChatException(N.LOGIN_ERROR.XMPP_CONNECTION_FAIL));break;case d.Strophe.Status.CONNECTED:r.localStorage.set(\"user\",t),e(new l.User(t));break;case d.Strophe.Status.DISCONNECTED:break;case d.Strophe.Status.DISCONNECTING:a.Logger.info(\"Connection\",\"Disconnecting\");break;case d.Strophe.Status.AUTHFAIL:n(new c.CometChatException(N.LOGIN_ERROR.XMPP_CONNECTION_FAIL))}})},e.getAppSettings=function(){return new Promise(function(t,e){u.makeApiCall(\"appSettings\").then(function(e){p.LocalStorage.getInstance().set(\"app_settings\",e.data),t(e.data)},function(t){e(new c.CometChatException(t.error))})})},e.logout=function(){var t=this;return new Promise(function(e,n){u.makeApiCall(\"userLogout\").then(function(n){h.XMPPConnectionHelper.getInstance().XMPPDisconnect(),t.clearCache(),t.apiKey=void 0,t.user=void 0,t.authToken=void 0,e(n.data)},function(t){n(new c.CometChatException(t.error))})})},e.isExtensionEnabled=function(t){return new Promise(function(e){F.ExtensionController.getExtensionList().then(function(n){Object.keys(n).map(function(n){n==t&&e(!0)}),e(!1)},function(t){a.Logger.log(\"error while fetching exntension list\",t),e(!1)})})},e.clearCache=function(){this.messagesStore.clearStore(),this.userStore.clearStore(),this.localStorage.clearStore()},e.typingTimer=function(){setInterval(function(){D.TypingNotificationController.clearTimer()},500)},e.initialzed=!1,e.isNative=!1,e.CometChatException=c.CometChatException,e.TextMessage=g.TextMessage,e.MediaMessage=f.MediaMessage,e.CustomMessage=x.CustomMessage,e.Action=M.Action,e.Call=I.Call,e.TypingIndicator=w.TypingIndicator,e.Group=C.Group,e.AppUser=l.User,e.User=l.User,e.GroupMember=U.GroupMember,e.MessagesRequest=b.DefaultMessagesRequest,e.MessagesRequestBuilder=b.DefaultMessagesRequestBuilder,e.UsersRequest=P.UsersRequest,e.UsersRequestBuilder=P.UsersRequestBuilder,e.GroupsRequest=R.GroupsRequest,e.GroupsRequestBuilder=R.GroupsRequestBuilder,e.GroupMembersRequest=O.GroupMembersRequest,e.GroupMembersRequestBuilder=O.GroupMembersRequestBuilder,e.BannedMembersRequest=O.GroupMembersRequest,e.BannedMembersRequestBuilder=O.GroupOutCastMembersRequestBuilder,e.MessageListener=y.MessageEventListener,e.UserListener=y.UserEventListener,e.GroupListener=y.GroupEventListener,e.OngoingCallListener=y.UserCallEventListener,e.CallListener=y.CallEventListener,e.MESSAGE_TYPE=T.MessageConstatnts.TYPE,e.CATEGORY_MESSAGE=T.MessageConstatnts.CATEGORY.MESSAGE,e.CATEGORY_ACTION=T.MessageConstatnts.CATEGORY.ACTION,e.CATEGORY_CALL=T.MessageConstatnts.CATEGORY.CALL,e.ACTION_TYPE=T.ActionConstatnts.ACTIONS,e.CALL_TYPE=T.CallConstants.CALL_TYPE,e.RECEIVER_TYPE=T.MessageConstatnts.RECEIVER_TYPE,e.CALL_STATUS=T.CallConstants.CALL_STATUS,e.CallController=v.CallController,e.GROUP_MEMBER_SCOPE=T.GROUP_MEMBER_SCOPE,e.GROUP_TYPE=T.GROUP_TYPE,e.MESSAGE_REQUEST=T.MessageConstatnts.PAGINATION.CURSOR_FILEDS,e.CometChatExtension=Y.CometChatExtension,e.ExtensionManager=G.ExtensionManager,e.isCall=!1,e.endpointFactory=new i.EndpointFactory,e.startTypingCount=0,e.endTypingCount=0,e}();e.CometChat=k}).call(this,n(21))},function(t,e,n){\"use strict\";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var s=function(){function t(t){this.uid=t.uid,this.name=t.name,this.authToken=t.authToken,this.avatar=t.avatar,this.credits=t.credits,this.email=t.email,this.lastActiveAt=t.lastActiveAt,this.link=t.link,this.metadata=t.metadata,this.role=t.role,this.statusMessage=t.statusMessage}return t.prototype.getUid=function(){return this.uid},t.prototype.setUid=function(t){this.uid=t},t.prototype.getName=function(){return this.name},t.prototype.setName=function(t){this.name=t},t.prototype.getAuthToken=function(){return this.authToken},t.prototype.setAuthToken=function(t){this.authToken=t},t.prototype.getAvatar=function(){return this.avatar},t.prototype.setAvatar=function(t){this.avatar=t},t.prototype.getCredits=function(){return this.credits},t.prototype.setCredits=function(t){this.credits=t},t.prototype.getEmail=function(){return this.email},t.prototype.setEmail=function(t){this.email=t},t.prototype.getLastActiveAt=function(){return this.lastActiveAt},t.prototype.setLastActiveAt=function(t){this.lastActiveAt=t},t.prototype.getLink=function(){return this.link},t.prototype.setLink=function(t){return this.link=t},t.prototype.getMetadata=function(){return this.metadata},t.prototype.setMetadata=function(t){this.metadata=t},t.prototype.getRole=function(){return this.role},t.prototype.setRole=function(t){this.role=t},t.prototype.getStatus=function(){return this.status},t.prototype.setStatus=function(t){this.status=t},t.prototype.getStatusMessage=function(){return this.statusMessage},t.prototype.setStatusMessage=function(t){this.statusMessage=t},t}(),i=function(t){function e(e){var n=t.call(this,e)||this;return n.wsChannel=e.wsChannel,n}return o(e,t),e.prototype.getWsChannel=function(){return this.wsChannel},e}(e.User=s);e.Me=i},function(t,e,n){\"use strict\";e.__esModule=!0,e.CometChatException=function(t){this.code=t.code,this.name=t.name,this.message=t.message,this.details=t.details}},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(1),o=n(0),s=n(10),i=n(2),a=function(){function t(t){if(this.store=o.constants.DEFAULT_STORE,i.CometChat.isNative)try{this.localStore=n(11).AsyncStorage}catch(t){}else r.isFalsy(t)||(this.store=t),this.localStore=s.createInstance({name:r.format(o.LOCAL_STORE.STORE_STRING,i.CometChat.getAppId(),o.LOCAL_STORE.COMMON_STORE)}),this.localStore.setDriver([s.LOCALSTORAGE,s.INDEXEDDB,s.WEBSQL])}return t.getInstance=function(){return null==t.localStorage&&(t.localStorage=new t),t.localStorage},t.prototype.set=function(t,e){return this.localStore.setItem(t,JSON.stringify(e))},t.prototype.remove=function(t){this.localStore.removeItem(t)},t.prototype.get=function(t){var e=this;return new Promise(function(n,r){e.localStore.getItem(t).then(function(e){try{n(JSON.parse(e))}catch(t){n(e)}},function(t){r(t)})})},t.prototype.clearStore=function(){return this.localStore.clear()},t.prototype.clear=function(t){},t.prototype.selectStore=function(t){this.store=t},t.localStorage=null,t}();e.LocalStorage=a},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(38),o=n(2),s=n(1);function i(t,e,n,r,o){var i;return void 0===t&&(t=\"\"),void 0===e&&(e=\"GET\"),void 0===n&&(n={}),void 0===r&&(r={}),n=s.isFalsy(n)?void 0:(\"GET\"==e&&(t+=\"?\",Object.keys(n).map(function(e){t=t+e+\"=\"+n[e]+\"&\"}),n=void 0),o&&(i=new FormData(this),Object.keys(n).map(function(t){n[t]instanceof Object&&!(n[t]instanceof File)?i.set(t,JSON.stringify(n[t])):i.set(t,n[t])})),JSON.stringify(n)),fetch(t,{method:e,mode:\"cors\",cache:\"no-cache\",headers:r,redirect:\"follow\",referrer:\"no-referrer\",body:o?i:n})}e.makeApiCall=function(t,e,n,s){void 0===t&&(t=\"\"),void 0===e&&(e={}),void 0===n&&(n={});var a=o.CometChat.getInstance();return new Promise(function(c,u){r.getEndPoint(t,e).then(function(e){var r={appId:o.CometChat.getAppId(),Accept:\"application/json\"};s||(r[\"Content-Type\"]=\"application/json\"),e.hasOwnProperty(\"isAdminApi\")&&e.isAdminApi?a.getApiKey()?r.apiKey=a.getApiKey():u({error:{code:\"API_KEY_NOT_SET\",message:\"An apiKey is needed to use the \"+t+\" api.\",name:\"API_KEY_NOT_SET\"}}):a.getAuthToken()?r.authToken=a.getAuthToken():u({error:{code:\"USER_NOT_LOGED_IN\",message:\"An authToken is need to use the \"+t+\" api.\",name:\"user not logged in\"}}),i(e.endpoint,e.method,n,r,s).then(function(t){return t.json()}).then(function(t){t.hasOwnProperty(\"data\")?(t.data.hasOwnProperty(\"authToken\")&&o.CometChat.setAuthToken(t.data.authToken),c(t)):u(t)}).catch(function(t){return u})}).catch(function(t){return u})})},e.makeAdminApiCall=function(t,e,n,s){void 0===t&&(t=\"\"),void 0===e&&(e={}),void 0===n&&(n={});var a=o.CometChat.getInstance();return new Promise(function(c,u){r.getEndPoint(t,e).then(function(e){var r={appId:o.CometChat.getAppId(),Accept:\"application/json\"};s||(r[\"Content-Type\"]=\"application/json\"),e.hasOwnProperty(\"isAdminApi\")&&e.isAdminApi?a.getApiKey()?r.apiKey=a.getApiKey():u({error:\"An apiKey is need to use the \"+t+\" api.\"}):a.getAuthToken()?r.authToken=a.getAuthToken():u({error:\"An authToken is need to use the \"+t+\" api.\"}),i(e.endpoint,e.method,n,r,s).then(function(t){return t.json()}).then(function(t){t.hasOwnProperty(\"data\")?(t.data.hasOwnProperty(\"authToken\")&&o.CometChat.setAuthToken(t.data.authToken),c(t)):u(t)}).catch(function(t){return u})}).catch(function(t){return u})})},e.postData=i},function(t,e,n){\"use strict\";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,s){function i(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(i,a)}c((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},\"function\"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError(\"Generator is already executing.\");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(a){s=[6,a],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};e.__esModule=!0;var s=n(1),i=n(39),a=n(2),c=n(15),u=n(13),l=n(0),h=n(26),d=(n(43),n(44),n(17)),p=n(8),f=n(45),g=n(19),E=n(27),m=n(5),_=n(28),T=n(20),C=n(29),S=n(14),A=function(){function e(){this.messageHandlers=[],this.userHandlers=[],this.callHandlers=[],this.groupHandlers=[],this.iqHandlers=[]}return e.getInstance=function(){return null!=this.xMPPConnectionHelper&&null!=this.xMPPConnectionHelper||(this.xMPPConnectionHelper=new e),this.xMPPConnectionHelper},e.prototype.XMPPConnect=function(t){var n=this;return new Promise(function(r,o){s.isFalsy(t)&&(t=e.XMPP_BIND_URL),m.LocalStorage.getInstance().get(l.APP_SETTINGS.APP_SETTINGS).then(function(t){s.isFalsy(t)?s.getAppSettings().then(function(t){n.connection=new i.Strophe.Connection(e.XMPP_BIND_URL=\"wss://\"+t[l.APP_SETTINGS.KEYS.CHAT_HOST]+\":\"+t[l.APP_SETTINGS.KEYS.CHAT_HTTPS_BIND_PORT]+l.XMPP.bind_url),r(!0)}):(n.connection=new i.Strophe.Connection(e.XMPP_BIND_URL=\"wss://\"+t[l.APP_SETTINGS.KEYS.CHAT_HOST]+\":\"+t[l.APP_SETTINGS.KEYS.CHAT_HTTPS_BIND_PORT]+l.XMPP.bind_url),r(!0))})})},e.prototype.XMPPDisconnect=function(){this.connection.flush(),this.connection.disconnect()},e.prototype.XMMPLogin=function(t,n,c){var f=this;void 0===n&&(n=l.XMPP.deafult_password),this.XMPPConnect().then(function(E){f.connection.connected?c(i.Strophe.Status.CONNECTED):f.connection.connect(s.format(l.XMPP.jid_string,a.CometChat.getAppId(),t,e.XMPP_HOST,l.XMPP.xmpp_resource),n,function(t){s.isFalsy(c)||c(t),t==i.Strophe.Status.CONNECTED&&(f.connection.sendPresence(i.$pres().c(\"priority\").t(\"1\").up().c(\"status\").t(\"online\")),f.connection.muc.init(f.connection),f.connection.vcard.init(f.connection),f.connection.chatstates.init(f.connection),f.connection.receipts.init(f.connection),f.connection.muc.join(s.format(l.XMPP.muc_jid_string,a.CometChat.getAppId(),\"somegroup\",\"call\",l.XMPP.host),f.connection.jid),m.LocalStorage.getInstance().get(l.APP_SETTINGS.APP_SETTINGS).then(function(t){s.isFalsy(t)?s.getAppSettings().then(function(t){f.connection.muc.listRooms(a.CometChat.getAppId()+\".\"+t[l.APP_SETTINGS.KEYS.CHAT_HOST],function(t){var e=t.getElementsByTagName(\"item\");(e=Array.prototype.slice.call(e)).map(function(t){f.connection.muc.join(t.getAttribute(\"jid\"),f.connection.jid)})})}):f.connection.muc.listRooms(a.CometChat.getAppId()+\".\"+t[l.APP_SETTINGS.KEYS.CHAT_HOST],function(t){var e=t.getElementsByTagName(\"item\");(e=Array.prototype.slice.call(e)).map(function(t){f.connection.muc.join(t.getAttribute(\"jid\"),f.connection.jid)})})}),f.connection.send(i.$iq({from:i.Strophe.getBareJidFromJid(f.connection.jid),id:\"enable1\",type:\"set\"}).c(\"enable\",{xmlns:\"urn:xmpp:carbons:2\"})),f.connection.addHandler(function(t){if(!(0<t.getElementsByTagName(\"x\").length)){var e=h.PresenceController.transformPresence(t);f.getUsersVCard(e.getUid(),function(t){s.isFalsy(t.getUid())||f.userHandlers.map(function(n){if(n)switch(t.setLastActiveAt(e.getLastActiveAt()),e.getStatus()){case l.PresenceConstatnts.STATUS.ONLINE:t.setStatus(l.PresenceConstatnts.STATUS.ONLINE),s.isFalsy(n._eventListener.onUserOnline)||n._eventListener.onUserOnline(t);break;default:t.setStatus(l.PresenceConstatnts.STATUS.OFFLINE),s.isFalsy(n._eventListener.onUserOffline)||n._eventListener.onUserOffline(t)}})})}return!0},null,\"presence\"),f.connection.addHandler(function(t){var e=t.getElementsByTagName(\"presence\");return 0<(e=Array.prototype.slice.call(e)).length&&f.iqHandlers.map(function(t){t._callback(h.PresenceController.transformPresences(e))}),!0},null,\"iq\"),f.connection.addHandler(function(t){var n;try{try{n=u.MessageController.trasformXMPPMessage(t),s.isFalsy(n)?(s.Logger.info(\"this are receipts receipts\",t),u.MessageController.isDeliveryReceipt(t)?f.publishDeliveryReceipt(t):u.MessageController.isReadRceipt(t)&&f.publishReadReceipt(t)):(s.Logger.info(\"processing incoming message for receipts\",{message:t,_message:n}),f.connection.receipts._processReceipt(t,n.getId())),t=t.getAttribute(l.MessageConstatnts.XMPP_KEYS.TYPE)==l.MessageConstatnts.XMPP_KEYS.TYPE_GROUP&&p.getFullJidForGroup(t.getAttribute(l.MessageConstatnts.XMPP_KEYS.FROM))==e.getInstance().connection.jid?null:n}catch(n){return s.Logger.error(\"Error in processing incoming message\",{e:n,message:t}),!0}if(!s.isFalsy(t)){s.Logger.info(\"We are only processing the incoming message and not recipts\",{message:t});try{T.MessageListnerMaping.getInstance().set(\"all\",t.id)}catch(n){s.Logger.error(\"Error in storing  incoming message id\",{e:n})}f.messageHandlers.map(function(e){return r(f,void 0,void 0,function(){var n,r,i;return o(this,function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),e?t instanceof d.Action?[3,4]:[3,1]:[3,4];case 1:return t instanceof g.Call?[3,4]:[3,2];case 2:n=t;try{T.MessageListnerMaping.getInstance().set(e._name,t.id)}catch(o){}return r=u.MessageController.trasformJSONMessge(n),[4,S.ExtensionController.hookOnMessageReceived(r)];case 3:switch((n=o.sent()).getType()){case l.MessageConstatnts.TYPE.TEXT:s.isFalsy(e._eventListener.onTextMessageReceived)||e._eventListener.onTextMessageReceived(n);break;case l.MessageConstatnts.TYPE.CUSTOM:s.isFalsy(e._eventListener.onCustomMessageReceived)||e._eventListener.onCustomMessageReceived(n);break;default:s.isFalsy(e._eventListener.onMediaMessageReceived)||e._eventListener.onMediaMessageReceived(n)}o.label=4;case 4:return[3,6];case 5:return i=o.sent(),s.Logger.error(\"Error in processing incoming message\",{e:i}),[3,6];case 6:return[2]}})})}),t instanceof g.Call&&(s.Logger.info(\"processing incoming call \",{message:t}),f.publishCallEvents(t)),t instanceof d.Action&&(s.Logger.info(\"processing incoming group actions \",{message:t}),f.publishActionEvents(t))}}catch(n){s.Logger.info(\"Error in message processing\",{error:n})}return!0},null,\"message\"),f.connection.addHandler(function(t){try{if(0<t.getElementsByTagName(\"error\").length)return s.Logger.info(\"Processing incoming message\",t),!0;var n,r=t.getElementsByTagName(\"composing\"),o=t.getElementsByTagName(\"paused\"),i=t.getAttribute(\"from\"),a=t.getAttribute(\"type\");if(t.getElementsByTagName(\"body\")[0]&&(n=unescape(p.parseHTML(t.getElementsByTagName(\"body\")[0])).trim().toString()),0<r.length||0<o.length)switch(a){case l.XMPP.CONVERSATION.TYPE.CHAT:var c=new _.TypingIndicator(p.getUidFromJid(f.connection.jid),l.MessageConstatnts.RECEIVER_TYPE.USER);f.getUsersVCard(p.getUidFromJid(i),function(t){c.setSender(t),n&&c.setMetadata(n),0<r.length&&C.TypingNotificationController.addIncomingTypingStarted(c),0<o.length&&C.TypingNotificationController.removeIncomingTypingStarted(c),f.messageHandlers.map(function(t){0<r.length&&t._eventListener.onTypingStarted&&t._eventListener.onTypingStarted(c),0<o.length&&t._eventListener.onTypingEnded&&t._eventListener.onTypingEnded(c)})});break;case l.XMPP.CONVERSATION.TYPE.GROUP_CHAT:if(p.getFullJidForGroup(t.getAttribute(l.MessageConstatnts.XMPP_KEYS.FROM))==e.getInstance().connection.jid)return!(t=null);c=new _.TypingIndicator(p.getGUIDFromJID(i),l.MessageConstatnts.RECEIVER_TYPE.GROUP),f.getUsersVCard(p.getUidFromJid(i),function(t){c.setSender(t),n&&c.setMetadata(n),0<r.length&&C.TypingNotificationController.addIncomingTypingStarted(c),0<o.length&&C.TypingNotificationController.removeIncomingTypingStarted(c),f.messageHandlers.map(function(t){0<r.length&&t._eventListener.onTypingStarted&&t._eventListener.onTypingStarted(c),0<o.length&&t._eventListener.onTypingEnded&&t._eventListener.onTypingEnded(c)})})}}catch(t){s.Logger.error(\"error in message processing\",{error:t})}return!0},i.Strophe.NS.CHATSTATES,\"message\"))})})},e.prototype.getPresenceInfo=function(t,e){var n=this,r=\"somename\"+(new Date).getTime();this.addIqHandler(r,function(t){e(t)}),s.getAppSettings().then(function(e){var r=i.$iq({from:n.connection.jid,id:\"CC^COMETCHAT-PRESENCE\",type:\"get\",to:e[l.APP_SETTINGS.KEYS.CHAT_HOST]}).c(\"query\",{xmlns:\"jabber:iq:presencereq\",action:\"presence\"}).t(JSON.stringify(t));n.connection.send(r)},function(e){s.Logger.error(\"getPresenceInfo\",e);var r=i.$iq({from:n.connection.jid,id:\"CC^COMETCHAT-PRESENCE\",type:\"get\",to:l.XMPP.host}).c(\"query\",{xmlns:\"jabber:iq:presencereq\",action:\"presence\"}).t(JSON.stringify(t));n.connection.send(r)})},e.prototype.sendTypingStarted=function(t,e,n){void 0===e&&(e=l.XMPP.CONVERSATION.TYPE.CHAT),t&&this.connection.chatstates.sendComposing(t,e,n)},e.prototype.sendTypingPaused=function(t,e,n){void 0===e&&(e=l.XMPP.CONVERSATION.TYPE.CHAT),t&&this.connection.chatstates.sendPaused(t,e,n)},e.prototype.addMessageEventListener=function(t,e){this.messageHandlers=this.messageHandlers.filter(function(e){return e._name!=t}),this.messageHandlers=this.messageHandlers.concat([new c.MessageListener(t,e)]),T.MessageListnerMaping.getInstance().get(t).then(function(e){s.isFalsy(e)&&T.MessageListnerMaping.getInstance().set(t,0)})},e.prototype.removeMessageEventListener=function(t){this.messageHandlers=this.messageHandlers.filter(function(e){return e._name!==t})},e.prototype.addCallEventListener=function(t,e){this.callHandlers=this.callHandlers.filter(function(e){return e._name!=t}),this.callHandlers=this.callHandlers.concat([new c.CallListener(t,e)])},e.prototype.removeCallEventListener=function(t){this.callHandlers=this.callHandlers.filter(function(e){return e._name!==t})},e.prototype.addUserEventListener=function(t,e){this.userHandlers=this.userHandlers.filter(function(e){return e._name!=t}),this.userHandlers=this.userHandlers.concat([new c.UserListener(t,e)])},e.prototype.removeUserEventListener=function(t){this.userHandlers=this.userHandlers.filter(function(e){return e._name!==t})},e.prototype.addGroupEventListener=function(t,e){this.groupHandlers=this.groupHandlers.filter(function(t){}),this.groupHandlers=this.groupHandlers.concat([new c.GroupListener(t,e)])},e.prototype.removeGroupEventListener=function(t){this.groupHandlers=this.groupHandlers.filter(function(e){return e._name!==t})},e.prototype.addIqHandler=function(t,e){this.iqHandlers=this.iqHandlers.concat([new c.Listener(t,e)])},e.prototype.removeIqHandler=function(t){this.iqHandlers=this.iqHandlers.filter(function(e){return e._name!==t})},e.prototype.joinMuc=function(t){var e=this;s.getAppSettings().then(function(n){e.connection.muc.join(s.format(l.XMPP.muc_jid_string,a.CometChat.getAppId(),t.getGuid(),a.CometChat.getAppId(),n[l.APP_SETTINGS.KEYS.CHAT_HOST]),e.connection.jid,null,null,null,null,0)})},e.prototype.leaveMuc=function(t){var e=this;s.getAppSettings().then(function(n){e.connection.muc.leave(s.format(l.XMPP.muc_jid_string,a.CometChat.getAppId(),t,a.CometChat.getAppId(),n[l.APP_SETTINGS.KEYS.CHAT_HOST]),e.connection.jid)})},e.prototype.getUsersVCard=function(t,e){var n=this;p.getJidFromUid(t).then(function(t){n.connection.vcard.get(function(t){e(f.VCardController.transformVCard(t))},t)})},e.prototype.trigerMessageHandler=function(t,e){if(s.isFalsy(e))t=u.MessageController.trasformJSONMessge(t),this.messageHandlers.map(function(e){try{if(e._eventListener)if(t instanceof d.Action);else if(t instanceof g.Call);else switch(t.getType()){case l.MessageConstatnts.TYPE.TEXT:s.isFalsy(e._eventListener.onTextMessageReceived)||e._eventListener.onTextMessageReceived(t);break;case l.MessageConstatnts.TYPE.CUSTOM:s.isFalsy(e._eventListener.onCustomMessageReceived)||e._eventListener.onCustomMessageReceived(t);break;default:s.isFalsy(e._eventListener.onMediaMessageReceived)||e._eventListener.onMediaMessageReceived(t)}}catch(e){s.Logger.error(\"Error in `trigerMessageHandler`\",e)}}),t instanceof g.Call&&this.publishCallEvents(t),t instanceof d.Action&&this.publishActionEvents(t);else if(t=u.MessageController.trasformJSONMessge(t),this.messageHandlers[e]._eventListener)try{if(this.messageHandlers[e]._eventListener)if(t instanceof d.Action);else if(t instanceof g.Call);else switch(t.getType()){case l.MessageConstatnts.TYPE.TEXT:s.isFalsy(this.messageHandlers[e]._eventListener.onTextMessageReceived)||this.messageHandlers[e]._eventListener.onTextMessageReceived(t);break;case l.MessageConstatnts.TYPE.CUSTOM:s.isFalsy(this.messageHandlers[e]._eventListener.onCustomMessageReceived)||this.messageHandlers[e]._eventListener.onCustomMessageReceived(t);break;default:s.isFalsy(this.messageHandlers[e]._eventListener.onMediaMessageReceived)||this.messageHandlers[e]._eventListener.onMediaMessageReceived(t)}}catch(e){s.Logger.error(\"Error in `trigerMessageHandler`\",e)}},e.prototype.publishActionEvents=function(t){switch(t.getAction()){case l.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_JOINED:case l.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_INVITED:this.groupHandlers.map(function(e){s.isFalsy(e._eventListener.onUserJoined)||e._eventListener.onUserJoined(t,t.getActionBy(),t.getActionFor())});break;case l.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_LEFT:this.groupHandlers.map(function(e){s.isFalsy(e._eventListener.onUserLeft)||e._eventListener.onUserLeft(t,t.getActionBy(),t.getActionFor())});break;case l.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_BANNED:this.groupHandlers.map(function(e){s.isFalsy(e._eventListener.onUserBanned)||e._eventListener.onUserBanned(t.getActionOn(),t.getActionBy(),t.getActionFor())});break;case l.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_KICKED:this.groupHandlers.map(function(e){s.isFalsy(e._eventListener.onUserKicked)||e._eventListener.onUserKicked(t,t.getActionOn(),t.getActionBy(),t.getActionFor())});break;case l.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_UNBANNED:this.groupHandlers.map(function(e){s.isFalsy(e._eventListener.onUserUnbanned)||e._eventListener.onUserUnbanned(t,t.getActionOn(),t.getActionBy(),t.getActionFor())});break;case l.ActionConstatnts.ACTION_TYPE.TYPE_MEMBER_SCOPE_CHANGED:this.groupHandlers.map(function(e){s.isFalsy(e._eventListener.onMemberScopeChanged)||e._eventListener.onMemberScopeChanged(t)})}},e.prototype.publishCallEvents=function(e){switch(e.getStatus()){case l.CallConstants.CALL_STATUS.INITIATED:e.getReceiverType()==l.CallConstants.RECEIVER_TYPE_GROUP?this.callHandlers.map(function(t){e.getCallInitiator().getUid().toLocaleLowerCase()!=a.CometChat.user.getUid().toLocaleLowerCase()&&(s.isFalsy(t._eventListener.onIncomingCallReceived)||t._eventListener.onIncomingCallReceived(e))}):this.callHandlers.map(function(t){s.isFalsy(t._eventListener.onIncomingCallReceived)||t._eventListener.onIncomingCallReceived(e)});break;case l.CallConstants.CALL_STATUS.ONGOING:e.getReceiverType()==l.CallConstants.RECEIVER_TYPE_GROUP?e.getCallInitiator().getUid().toLocaleLowerCase()==a.CometChat.user.getUid().toLocaleLowerCase()&&this.callHandlers.map(function(t){s.isFalsy(t._eventListener.onOutgoingCallAccepted)||t._eventListener.onOutgoingCallAccepted(e)}):this.callHandlers.map(function(t){s.isFalsy(t._eventListener.onOutgoingCallAccepted)||t._eventListener.onOutgoingCallAccepted(e)});break;case l.CallConstants.CALL_STATUS.UNANSWERED:if(e.getReceiverType()==l.CallConstants.RECEIVER_TYPE_GROUP)e.getCallInitiator().getUid().toLocaleLowerCase()==a.CometChat.user.getUid().toLocaleLowerCase()&&this.callHandlers.map(function(t){s.isFalsy(t._eventListener.onIncomingCallCancelled)||t._eventListener.onIncomingCallCancelled(e)});else{try{E.CallController.getInstance().endCall()}catch(t){s.Logger.error(\"CallError\",t)}this.callHandlers.map(function(t){s.isFalsy(t._eventListener.onIncomingCallCancelled)||t._eventListener.onIncomingCallCancelled(e)})}break;case l.CallConstants.CALL_STATUS.REJECTED:if(e.getReceiverType()==l.CallConstants.RECEIVER_TYPE_GROUP)e.getCallInitiator().getUid().toLocaleLowerCase()==a.CometChat.user.getUid().toLocaleLowerCase()&&this.callHandlers.map(function(t){s.isFalsy(t._eventListener.onOutgoingCallRejected)||t._eventListener.onOutgoingCallRejected(e)});else{try{E.CallController.getInstance().endCall()}catch(t){s.Logger.error(\"CallError\",t)}this.callHandlers.map(function(t){s.isFalsy(t._eventListener.onOutgoingCallRejected)||t._eventListener.onOutgoingCallRejected(e)})}break;case l.CallConstants.CALL_STATUS.BUSY:e.getReceiverType()==l.CallConstants.RECEIVER_TYPE_GROUP?e.getCallInitiator().getUid().toLocaleLowerCase()==a.CometChat.user.getUid().toLocaleLowerCase()&&this.callHandlers.map(function(t){s.isFalsy(t._eventListener.onOutgoingCallRejected)||t._eventListener.onOutgoingCallRejected(e)}):this.callHandlers.map(function(t){try{E.CallController.getInstance().endCall()}catch(t){s.Logger.error(\"CallError\",t)}s.isFalsy(t._eventListener.onOutgoingCallRejected)||t._eventListener.onOutgoingCallRejected(e)});break;case l.CallConstants.CALL_STATUS.CANCELLED:if(e.getReceiverType()==l.CallConstants.RECEIVER_TYPE_GROUP)e.getCallInitiator().getUid().toLocaleLowerCase()==a.CometChat.user.getUid().toLocaleLowerCase()&&this.callHandlers.map(function(t){s.isFalsy(t._eventListener.onIncomingCallCancelled)||t._eventListener.onIncomingCallCancelled(e)});else{try{E.CallController.getInstance().endCall()}catch(t){s.Logger.error(\"CallError\",t)}this.callHandlers.map(function(t){s.isFalsy(t._eventListener.onIncomingCallCancelled)||t._eventListener.onIncomingCallCancelled(e)})}break;case l.CallConstants.CALL_STATUS.ENDED:this.callHandlers.map(function(t){s.isFalsy(t._eventListener.onOutgoingCallRejected)||t._eventListener.onOutgoingCallRejected(e)});try{E.CallController.getInstance().getCallListner()&&E.CallController.getInstance().getCallListner()._eventListener.onCallEnded(e),E.CallController.getInstance().endCall()}catch(t){s.Logger.error(\"CallError\",t)}}},e.prototype.publishTypinStatusNotification=function(t,e){switch(e){case l.TYPING_NOTIFICATION.ACTIONS.STARTED:this.messageHandlers.map(function(e){e._eventListener.onTypingStarted&&e._eventListener.onTypingStarted(t)}),C.TypingNotificationController.addIncomingTypingStarted(t);break;case l.TYPING_NOTIFICATION.ACTIONS.ENDED:this.messageHandlers.map(function(e){e._eventListener.onTypingEnded&&e._eventListener.onTypingEnded(t)}),C.TypingNotificationController.removeIncomingTypingStarted(t)}},e.prototype.publishDeliveryReceipt=function(t){var e=this;u.MessageController.processDeliveryReceipt(t).then(function(t){e.messageHandlers.map(function(e){e._eventListener.onMessageDelivered&&e._eventListener.onMessageDelivered(t)})})},e.prototype.publishReadReceipt=function(t){var e=this;u.MessageController.processReadReceipt(t).then(function(t){e.messageHandlers.map(function(e){e._eventListener.onMessageRead&&e._eventListener.onMessageRead(t)})})},e.prototype.markAsRead=function(t,e,n,r){var o=this;p.getJidFromUid(t).then(function(t){var s=i.$msg({to:t,from:o.connection.jid,id:o.connection.getUniqueId(),type:l.MessageConstatnts.XMPP_KEYS.TYPE_USER}),c=i.Strophe.xmlElement(\"read\",{type:e,receiverId:r,xmlns:i.Strophe.NS.RECEIPTS,id:\"[\"+a.CometChat.getAppId()+\"]\"+n});s.tree().appendChild(c),o.connection.send(s)})},e.XMPP_HOST=l.XMPP.host,e.XMPP_PORT=l.XMPP.port,e.xMPPConnectionHelper=new e,e.XMPP_BIND_URL=\"wss://\"+e.XMPP_HOST+\":\"+e.XMPP_PORT+l.XMPP.bind_url,e}();e.XMPPConnectionHelper=A},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(0),o=n(1),s=n(2);e.getUidFromJid=function(t){return t.substring(t.lastIndexOf(\"]\")+1,t.lastIndexOf(\"@\"))},e.getappIdFromJid=function(t){return t.substring(t.lastIndexOf(\"[\")+1,t.lastIndexOf(\"]\"))},e.getmessageIdFromStanzaId=function(t){return t?t.substring(t.lastIndexOf(\"]\")+1,t.length):t},e.parseHTML=function(e){try{return e.textContent}catch(t){return e}},e.getJidFromUid=function(t){return new Promise(function(e,n){o.getAppSettings().then(function(n){e(o.format(r.XMPP.bare_jid_string,s.CometChat.getAppId(),t,n[r.APP_SETTINGS.KEYS.CHAT_HOST]))},function(n){e(o.format(r.XMPP.bare_jid_string,s.CometChat.getAppId(),t,r.XMPP.host))})})},e.getGUIDFromJID=function(t){return t.substring(t.indexOf(\"]\")+1,t.indexOf(\"@\"))},e.getGroupJidFromGUID=function(t){return new Promise(function(e,n){o.getAppSettings().then(function(n){e(o.format(r.XMPP.muc_jid_string,s.CometChat.getAppId(),t,n[r.APP_SETTINGS.KEYS.GROUP_SERVICE],n[r.APP_SETTINGS.KEYS.CHAT_HOST]))},function(n){e(o.format(r.XMPP.muc_jid_string,s.CometChat.getAppId(),t,s.CometChat.getAppId(),r.XMPP.host))})})},e.getFullJidForGroup=function(t){return t.substring(t.indexOf(\"/\")+1)}},function(t,e,n){\"use strict\";e.__esModule=!0;var r=function(){function t(t,e,n,r){this.receiver=t,this.type=e,this.receiverType=n,this.category=r}return t.prototype.getId=function(){return this.id},t.prototype.setId=function(t){this.id=t},t.prototype.getMuid=function(){return this.muid},t.prototype.setMuid=function(t){this.muid=t},t.prototype.getSender=function(){return this.sender},t.prototype.setSender=function(t){this.sender=t},t.prototype.getReceiver=function(){return this.receiver},t.prototype.setReceiver=function(t){this.receiver=t},t.prototype.getType=function(){return this.type},t.prototype.setType=function(t){this.type=t},t.prototype.get=function(){return this.id},t.prototype.setReceiverType=function(t){this.receiverType=t},t.prototype.getReceiverType=function(){return this.receiverType},t.prototype.setSentAt=function(t){this.sentAt=t},t.prototype.getSentAt=function(){return this.sentAt},t.prototype.getStatus=function(){return this.status},t.prototype.setStatus=function(t){this.status=t},t.prototype.getDeliveredAt=function(){return this.deliveredAt},t.prototype.setDeliveredAt=function(t){this.deliveredAt=t},t.prototype.getReadAt=function(){return this.readAt},t.prototype.setReadAt=function(t){this.readAt=t},t.prototype.getCategory=function(){return this.category},t.prototype.setCategory=function(t){this.category=t},t}();e.BaseMessage=r},function(t,e,n){(function(e){t.exports=function t(e,n,r){function o(i,a){if(!n[i]){if(!e[i]){if(s)return s(i,!0);var c=new Error(\"Cannot find module '\"+i+\"'\");throw c.code=\"MODULE_NOT_FOUND\",c}var u=n[i]={exports:{}};e[i][0].call(u.exports,function(t){return o(e[i][1][t]||t)},u,u.exports,t,e,n,r)}return n[i].exports}for(var s=!1,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(t,n,r){(function(t){\"use strict\";var e,r,o=t.MutationObserver||t.WebKitMutationObserver;if(o){var s=0,i=new o(l),a=t.document.createTextNode(\"\");i.observe(a,{characterData:!0}),e=function(){a.data=s=++s%2}}else if(t.setImmediate||void 0===t.MessageChannel)e=\"document\"in t&&\"onreadystatechange\"in t.document.createElement(\"script\")?function(){var e=t.document.createElement(\"script\");e.onreadystatechange=function(){l(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(l,0)};else{var c=new t.MessageChannel;c.port1.onmessage=l,e=function(){c.port2.postMessage(0)}}var u=[];function l(){var t,e;r=!0;for(var n=u.length;n;){for(e=u,u=[],t=-1;++t<n;)e[t]();n=u.length}r=!1}n.exports=function(t){1!==u.push(t)||r||e()}}).call(this,void 0!==e?e:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{}],2:[function(t,e,n){\"use strict\";var r=t(1);function o(){}var s={},i=[\"REJECTED\"],a=[\"FULFILLED\"],c=[\"PENDING\"];function u(t){if(\"function\"!=typeof t)throw new TypeError(\"resolver must be a function\");this.state=c,this.queue=[],this.outcome=void 0,t!==o&&p(this,t)}function l(t,e,n){this.promise=t,\"function\"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),\"function\"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(t,e,n){r(function(){var r;try{r=e(n)}catch(r){return s.reject(t,r)}r===t?s.reject(t,new TypeError(\"Cannot resolve promise with itself\")):s.resolve(t,r)})}function d(t){var e=t&&t.then;if(t&&(\"object\"==typeof t||\"function\"==typeof t)&&\"function\"==typeof e)return function(){e.apply(t,arguments)}}function p(t,e){var n=!1;function r(e){n||(n=!0,s.reject(t,e))}function o(e){n||(n=!0,s.resolve(t,e))}var i=f(function(){e(o,r)});\"error\"===i.status&&r(i.value)}function f(t,e){var n={};try{n.value=t(e),n.status=\"success\"}catch(t){n.status=\"error\",n.value=t}return n}(e.exports=u).prototype.catch=function(t){return this.then(null,t)},u.prototype.then=function(t,e){if(\"function\"!=typeof t&&this.state===a||\"function\"!=typeof e&&this.state===i)return this;var n=new this.constructor(o);return this.state!==c?h(n,this.state===a?t:e,this.outcome):this.queue.push(new l(n,t,e)),n},l.prototype.callFulfilled=function(t){s.resolve(this.promise,t)},l.prototype.otherCallFulfilled=function(t){h(this.promise,this.onFulfilled,t)},l.prototype.callRejected=function(t){s.reject(this.promise,t)},l.prototype.otherCallRejected=function(t){h(this.promise,this.onRejected,t)},s.resolve=function(t,e){var n=f(d,e);if(\"error\"===n.status)return s.reject(t,n.value);var r=n.value;if(r)p(t,r);else{t.state=a,t.outcome=e;for(var o=-1,i=t.queue.length;++o<i;)t.queue[o].callFulfilled(e)}return t},s.reject=function(t,e){t.state=i,t.outcome=e;for(var n=-1,r=t.queue.length;++n<r;)t.queue[n].callRejected(e);return t},u.resolve=function(t){return t instanceof this?t:s.resolve(new this(o),t)},u.reject=function(t){var e=new this(o);return s.reject(e,t)},u.all=function(t){var e=this;if(\"[object Array]\"!==Object.prototype.toString.call(t))return this.reject(new TypeError(\"must be an array\"));var n=t.length,r=!1;if(!n)return this.resolve([]);for(var i=new Array(n),a=0,c=-1,u=new this(o);++c<n;)l(t[c],c);return u;function l(t,o){e.resolve(t).then(function(t){i[o]=t,++a!==n||r||(r=!0,s.resolve(u,i))},function(t){r||(r=!0,s.reject(u,t))})}},u.race=function(t){if(\"[object Array]\"!==Object.prototype.toString.call(t))return this.reject(new TypeError(\"must be an array\"));var e=t.length,n=!1;if(!e)return this.resolve([]);for(var r=-1,i=new this(o);++r<e;)this.resolve(t[r]).then(function(t){n||(n=!0,s.resolve(i,t))},function(t){n||(n=!0,s.reject(i,t))});return i}},{1:1}],3:[function(t,n,r){(function(e){\"use strict\";\"function\"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,void 0!==e?e:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{2:2}],4:[function(t,e,n){\"use strict\";var r=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t},o=function(){try{if(\"undefined\"!=typeof indexedDB)return indexedDB;if(\"undefined\"!=typeof webkitIndexedDB)return webkitIndexedDB;if(\"undefined\"!=typeof mozIndexedDB)return mozIndexedDB;if(\"undefined\"!=typeof OIndexedDB)return OIndexedDB;if(\"undefined\"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}();function s(e,n){e=e||[],n=n||{};try{return new Blob(e,n)}catch(t){if(\"TypeError\"!==t.name)throw t;for(var r=new(\"undefined\"!=typeof BlobBuilder?BlobBuilder:\"undefined\"!=typeof MSBlobBuilder?MSBlobBuilder:\"undefined\"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),o=0;o<e.length;o+=1)r.append(e[o]);return r.getBlob(n.type)}}\"undefined\"==typeof Promise&&t(3);var i=Promise;function a(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}function c(t,e,n){\"function\"==typeof e&&t.then(e),\"function\"==typeof n&&t.catch(n)}function u(t){return\"string\"!=typeof t&&(t=String(t)),t}function l(){if(arguments.length&&\"function\"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var h=\"local-forage-detect-blob-support\",d=void 0,p={},f=Object.prototype.toString,g=\"readonly\",E=\"readwrite\";function m(t){return\"boolean\"==typeof d?i.resolve(d):(e=t,new i(function(t){var n=e.transaction(h,E),r=s([\"\"]);n.objectStore(h).put(r,\"key\"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\\/(\\d+)/),n=navigator.userAgent.match(/Edge\\//);t(n||!e||43<=parseInt(e[1],10))}}).catch(function(){return!1})).then(function(t){return d=t});var e}function _(t){var e=p[t.name],n={};n.promise=new i(function(t,e){n.resolve=t,n.reject=e}),e.deferredOperations.push(n),e.dbReady=e.dbReady?e.dbReady.then(function(){return n.promise}):n.promise}function T(t){var e=p[t.name].deferredOperations.pop();if(e)return e.resolve(),e.promise}function C(t,e){var n=p[t.name].deferredOperations.pop();if(n)return n.reject(e),n.promise}function S(t,e){return new i(function(n,r){if(p[t.name]=p[t.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},t.db){if(!e)return n(t.db);_(t),t.db.close()}var s=[t.name];e&&s.push(t.version);var i=o.open.apply(o,s);e&&(i.onupgradeneeded=function(e){var n=i.result;try{n.createObjectStore(t.storeName),e.oldVersion<=1&&n.createObjectStore(h)}catch(e){if(\"ConstraintError\"!==e.name)throw e}}),i.onerror=function(t){t.preventDefault(),r(i.error)},i.onsuccess=function(){n(i.result),T(t)}})}function A(t){return S(t,!1)}function y(t){return S(t,!0)}function I(t,e){if(!t.db)return!0;var n=!t.db.objectStoreNames.contains(t.storeName),r=t.version>t.db.version;if(t.version<t.db.version&&(t.version=t.db.version),r||n){if(n){var o=t.db.version+1;o>t.version&&(t.version=o)}return!0}return!1}function v(t){return s([function(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),o=0;o<e;o++)r[o]=t.charCodeAt(o);return n}(atob(t.data))],{type:t.type})}function N(t){return t&&t.__local_forage_encoded_blob}function M(t){var e=this,n=e._initReady().then(function(){var t=p[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady});return c(n,t,t),n}function R(t,e,n,r){void 0===r&&(r=1);try{var o=t.db.transaction(t.storeName,e);n(null,o)}catch(o){if(0<r&&(!t.db||\"InvalidStateError\"===o.name||\"NotFoundError\"===o.name))return i.resolve().then(function(){if(!t.db||\"NotFoundError\"===o.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),y(t)}).then(function(){return function(t){_(t);for(var e=p[t.name],n=e.forages,r=0;r<n.length;r++){var o=n[r];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return t.db=null,A(t).then(function(e){return t.db=e,I(t)?y(t):e}).then(function(r){t.db=e.db=r;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=r}).catch(function(e){throw C(t,e),e})}(t).then(function(){R(t,e,n,r-1)})}).catch(n);n(o)}}var O={_driver:\"asyncStorage\",_initStorage:function(t){var e=this,n={db:null};if(t)for(var r in t)n[r]=t[r];var o=p[n.name];o||(p[n.name]=o={forages:[],db:null,dbReady:null,deferredOperations:[]}),o.forages.push(e),e._initReady||(e._initReady=e.ready,e.ready=M);var s=[];function a(){return i.resolve()}for(var c=0;c<o.forages.length;c++){var u=o.forages[c];u!==e&&s.push(u._initReady().catch(a))}var l=o.forages.slice(0);return i.all(s).then(function(){return n.db=o.db,A(n)}).then(function(t){return n.db=t,I(n)?y(n):t}).then(function(t){n.db=o.db=t,e._dbInfo=n;for(var r=0;r<l.length;r++){var s=l[r];s!==e&&(s._dbInfo.db=n.db,s._dbInfo.version=n.version)}})},_support:function(){try{if(!o)return!1;var t=\"undefined\"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e=\"function\"==typeof fetch&&-1!==fetch.toString().indexOf(\"[native code\");return(!t||e)&&\"undefined\"!=typeof indexedDB&&\"undefined\"!=typeof IDBKeyRange}catch(t){return!1}}(),iterate:function(t,e){var n=this,r=new i(function(e,r){n.ready().then(function(){R(n._dbInfo,g,function(o,s){if(o)return r(o);try{var i=s.objectStore(n._dbInfo.storeName).openCursor(),a=1;i.onsuccess=function(){var n=i.result;if(n){var r=n.value;N(r)&&(r=v(r));var o=t(r,n.key,a++);void 0!==o?e(o):n.continue()}else e()},i.onerror=function(){r(i.error)}}catch(o){r(o)}})}).catch(r)});return a(r,e),r},getItem:function(t,e){var n=this;t=u(t);var r=new i(function(e,r){n.ready().then(function(){R(n._dbInfo,g,function(o,s){if(o)return r(o);try{var i=s.objectStore(n._dbInfo.storeName).get(t);i.onsuccess=function(){var t=i.result;void 0===t&&(t=null),N(t)&&(t=v(t)),e(t)},i.onerror=function(){r(i.error)}}catch(o){r(o)}})}).catch(r)});return a(r,e),r},setItem:function(t,e,n){var r=this;t=u(t);var o=new i(function(n,o){var s;r.ready().then(function(){return s=r._dbInfo,\"[object Blob]\"===f.call(e)?m(s.db).then(function(t){return t?e:(n=e,new i(function(t,e){var r=new FileReader;r.onerror=e,r.onloadend=function(e){var r=btoa(e.target.result||\"\");t({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)}));var n}):e}).then(function(e){R(r._dbInfo,E,function(s,i){if(s)return o(s);try{var a=i.objectStore(r._dbInfo.storeName);null===e&&(e=void 0);var c=a.put(e,t);i.oncomplete=function(){void 0===e&&(e=null),n(e)},i.onabort=i.onerror=function(){o(c.error?c.error:c.transaction.error)}}catch(s){o(s)}})}).catch(o)});return a(o,n),o},removeItem:function(t,e){var n=this;t=u(t);var r=new i(function(e,r){n.ready().then(function(){R(n._dbInfo,E,function(o,s){if(o)return r(o);try{var i=s.objectStore(n._dbInfo.storeName).delete(t);s.oncomplete=function(){e()},s.onerror=function(){r(i.error)},s.onabort=function(){r(i.error?i.error:i.transaction.error)}}catch(o){r(o)}})}).catch(r)});return a(r,e),r},clear:function(t){var e=this,n=new i(function(t,n){e.ready().then(function(){R(e._dbInfo,E,function(r,o){if(r)return n(r);try{var s=o.objectStore(e._dbInfo.storeName).clear();o.oncomplete=function(){t()},o.onabort=o.onerror=function(){n(s.error?s.error:s.transaction.error)}}catch(r){n(r)}})}).catch(n)});return a(n,t),n},length:function(t){var e=this,n=new i(function(t,n){e.ready().then(function(){R(e._dbInfo,g,function(r,o){if(r)return n(r);try{var s=o.objectStore(e._dbInfo.storeName).count();s.onsuccess=function(){t(s.result)},s.onerror=function(){n(s.error)}}catch(r){n(r)}})}).catch(n)});return a(n,t),n},key:function(t,e){var n=this,r=new i(function(e,r){t<0?e(null):n.ready().then(function(){R(n._dbInfo,g,function(o,s){if(o)return r(o);try{var i=s.objectStore(n._dbInfo.storeName),a=!1,c=i.openCursor();c.onsuccess=function(){var n=c.result;n?0===t?e(n.key):a?e(n.key):(a=!0,n.advance(t)):e(null)},c.onerror=function(){r(c.error)}}catch(o){r(o)}})}).catch(r)});return a(r,e),r},keys:function(t){var e=this,n=new i(function(t,n){e.ready().then(function(){R(e._dbInfo,g,function(r,o){if(r)return n(r);try{var s=o.objectStore(e._dbInfo.storeName).openCursor(),i=[];s.onsuccess=function(){var e=s.result;e?(i.push(e.key),e.continue()):t(i)},s.onerror=function(){n(s.error)}}catch(r){n(r)}})}).catch(n)});return a(n,t),n},dropInstance:function(t,e){e=l.apply(this,arguments);var n,r=this.config();if((t=\"function\"!=typeof t&&t||{}).name||(t.name=t.name||r.name,t.storeName=t.storeName||r.storeName),t.name){var s=t.name===r.name&&this._dbInfo.db?i.resolve(this._dbInfo.db):A(t).then(function(e){var n=p[t.name],r=n.forages;n.db=e;for(var o=0;o<r.length;o++)r[o]._dbInfo.db=e;return e});n=s.then(t.storeName?function(e){if(e.objectStoreNames.contains(t.storeName)){var n=e.version+1;_(t);var r=p[t.name],s=r.forages;e.close();for(var a=0;a<s.length;a++){var c=s[a];c._dbInfo.db=null,c._dbInfo.version=n}return new i(function(e,r){var s=o.open(t.name,n);s.onerror=function(t){s.result.close(),r(t)},s.onupgradeneeded=function(){s.result.deleteObjectStore(t.storeName)},s.onsuccess=function(){var t=s.result;t.close(),e(t)}}).then(function(t){r.db=t;for(var e=0;e<s.length;e++){var n=s[e];n._dbInfo.db=t,T(n._dbInfo)}}).catch(function(e){throw(C(t,e)||i.resolve()).catch(function(){}),e})}}:function(e){_(t);var n=p[t.name],r=n.forages;e.close();for(var s=0;s<r.length;s++)r[s]._dbInfo.db=null;return new i(function(e,n){var r=o.deleteDatabase(t.name);r.onerror=r.onblocked=function(t){var e=r.result;e&&e.close(),n(t)},r.onsuccess=function(){var t=r.result;t&&t.close(),e(t)}}).then(function(t){n.db=t;for(var e=0;e<r.length;e++)T(r[e]._dbInfo)}).catch(function(e){throw(C(t,e)||i.resolve()).catch(function(){}),e})})}else n=i.reject(\"Invalid arguments\");return a(n,e),n}},P=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",b=/^~~local_forage_type~([^~]+)~/,L=\"__lfsc__:\",w=L.length,D=\"arbf\",x=\"blob\",U=w+D.length,Y=Object.prototype.toString;function G(t){var e,n,r,o,s,i=.75*t.length,a=t.length,c=0;\"=\"===t[t.length-1]&&(i--,\"=\"===t[t.length-2]&&i--);var u=new ArrayBuffer(i),l=new Uint8Array(u);for(e=0;e<a;e+=4)n=P.indexOf(t[e]),r=P.indexOf(t[e+1]),o=P.indexOf(t[e+2]),s=P.indexOf(t[e+3]),l[c++]=n<<2|r>>4,l[c++]=(15&r)<<4|o>>2,l[c++]=(3&o)<<6|63&s;return u}function F(t){var e,n=new Uint8Array(t),r=\"\";for(e=0;e<n.length;e+=3)r+=P[n[e]>>2],r+=P[(3&n[e])<<4|n[e+1]>>4],r+=P[(15&n[e+1])<<2|n[e+2]>>6],r+=P[63&n[e+2]];return n.length%3==2?r=r.substring(0,r.length-1)+\"=\":n.length%3==1&&(r=r.substring(0,r.length-2)+\"==\"),r}var H={serialize:function(t,e){var n=\"\";if(t&&(n=Y.call(t)),t&&(\"[object ArrayBuffer]\"===n||t.buffer&&\"[object ArrayBuffer]\"===Y.call(t.buffer))){var r,o=L;t instanceof ArrayBuffer?(r=t,o+=D):(r=t.buffer,\"[object Int8Array]\"===n?o+=\"si08\":\"[object Uint8Array]\"===n?o+=\"ui08\":\"[object Uint8ClampedArray]\"===n?o+=\"uic8\":\"[object Int16Array]\"===n?o+=\"si16\":\"[object Uint16Array]\"===n?o+=\"ur16\":\"[object Int32Array]\"===n?o+=\"si32\":\"[object Uint32Array]\"===n?o+=\"ui32\":\"[object Float32Array]\"===n?o+=\"fl32\":\"[object Float64Array]\"===n?o+=\"fl64\":e(new Error(\"Failed to get type for BinaryArray\"))),e(o+F(r))}else if(\"[object Blob]\"===n){var s=new FileReader;s.onload=function(){var n=\"~~local_forage_type~\"+t.type+\"~\"+F(this.result);e(L+x+n)},s.readAsArrayBuffer(t)}else try{e(JSON.stringify(t))}catch(n){e(null,n)}},deserialize:function(t){if(t.substring(0,w)!==L)return JSON.parse(t);var e,n=t.substring(U),r=t.substring(w,U);if(r===x&&b.test(n)){var o=n.match(b);e=o[1],n=n.substring(o[0].length)}var i=G(n);switch(r){case D:return i;case x:return s([i],{type:e});case\"si08\":return new Int8Array(i);case\"ui08\":return new Uint8Array(i);case\"uic8\":return new Uint8ClampedArray(i);case\"si16\":return new Int16Array(i);case\"ur16\":return new Uint16Array(i);case\"si32\":return new Int32Array(i);case\"ui32\":return new Uint32Array(i);case\"fl32\":return new Float32Array(i);case\"fl64\":return new Float64Array(i);default:throw new Error(\"Unkown type: \"+r)}},stringToBuffer:G,bufferToString:F};function k(t,e,n,r){t.executeSql(\"CREATE TABLE IF NOT EXISTS \"+e.storeName+\" (id INTEGER PRIMARY KEY, key unique, value)\",[],n,r)}function B(t,e,n,r,o,s){t.executeSql(n,r,o,function(t,i){i.code===i.SYNTAX_ERR?t.executeSql(\"SELECT name FROM sqlite_master WHERE type='table' AND name = ?\",[e.storeName],function(t,a){a.rows.length?s(t,i):k(t,e,function(){t.executeSql(n,r,o,s)},s)},s):s(t,i)},s)}var K={_driver:\"webSQLStorage\",_initStorage:function(t){var e=this,n={db:null};if(t)for(var r in t)n[r]=\"string\"!=typeof t[r]?t[r].toString():t[r];var o=new i(function(r,o){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(t){return o(t)}n.db.transaction(function(t){k(t,n,function(){e._dbInfo=n,r()},function(t,e){o(e)})},o)});return n.serializer=H,o},_support:\"function\"==typeof openDatabase,iterate:function(t,e){var n=this,r=new i(function(e,r){n.ready().then(function(){var o=n._dbInfo;o.db.transaction(function(n){B(n,o,\"SELECT * FROM \"+o.storeName,[],function(n,r){for(var s=r.rows,i=s.length,a=0;a<i;a++){var c=s.item(a),u=c.value;if(u&&(u=o.serializer.deserialize(u)),void 0!==(u=t(u,c.key,a+1)))return void e(u)}e()},function(t,e){r(e)})})}).catch(r)});return a(r,e),r},getItem:function(t,e){var n=this;t=u(t);var r=new i(function(e,r){n.ready().then(function(){var o=n._dbInfo;o.db.transaction(function(n){B(n,o,\"SELECT * FROM \"+o.storeName+\" WHERE key = ? LIMIT 1\",[t],function(t,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=o.serializer.deserialize(r)),e(r)},function(t,e){r(e)})})}).catch(r)});return a(r,e),r},setItem:function(t,e,n){return(function t(e,n,r,o){var s=this;e=u(e);var c=new i(function(i,a){s.ready().then(function(){void 0===n&&(n=null);var c=n,u=s._dbInfo;u.serializer.serialize(n,function(n,l){l?a(l):u.db.transaction(function(t){B(t,u,\"INSERT OR REPLACE INTO \"+u.storeName+\" (key, value) VALUES (?, ?)\",[e,n],function(){i(c)},function(t,e){a(e)})},function(n){if(n.code===n.QUOTA_ERR){if(0<o)return void i(t.apply(s,[e,c,r,o-1]));a(n)}})})}).catch(a)});return a(c,r),c}).apply(this,[t,e,n,1])},removeItem:function(t,e){var n=this;t=u(t);var r=new i(function(e,r){n.ready().then(function(){var o=n._dbInfo;o.db.transaction(function(n){B(n,o,\"DELETE FROM \"+o.storeName+\" WHERE key = ?\",[t],function(){e()},function(t,e){r(e)})})}).catch(r)});return a(r,e),r},clear:function(t){var e=this,n=new i(function(t,n){e.ready().then(function(){var r=e._dbInfo;r.db.transaction(function(e){B(e,r,\"DELETE FROM \"+r.storeName,[],function(){t()},function(t,e){n(e)})})}).catch(n)});return a(n,t),n},length:function(t){var e=this,n=new i(function(t,n){e.ready().then(function(){var r=e._dbInfo;r.db.transaction(function(e){B(e,r,\"SELECT COUNT(key) as c FROM \"+r.storeName,[],function(e,n){var r=n.rows.item(0).c;t(r)},function(t,e){n(e)})})}).catch(n)});return a(n,t),n},key:function(t,e){var n=this,r=new i(function(e,r){n.ready().then(function(){var o=n._dbInfo;o.db.transaction(function(n){B(n,o,\"SELECT key FROM \"+o.storeName+\" WHERE id = ? LIMIT 1\",[t+1],function(t,n){var r=n.rows.length?n.rows.item(0).key:null;e(r)},function(t,e){r(e)})})}).catch(r)});return a(r,e),r},keys:function(t){var e=this,n=new i(function(t,n){e.ready().then(function(){var r=e._dbInfo;r.db.transaction(function(e){B(e,r,\"SELECT key FROM \"+r.storeName,[],function(e,n){for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o).key);t(r)},function(t,e){n(e)})})}).catch(n)});return a(n,t),n},dropInstance:function(t,e){e=l.apply(this,arguments);var n=this.config();(t=\"function\"!=typeof t&&t||{}).name||(t.name=t.name||n.name,t.storeName=t.storeName||n.storeName);var r,o=this;return a(r=t.name?new i(function(e){var r,s;r=t.name===n.name?o._dbInfo.db:openDatabase(t.name,\"\",\"\",0),e(t.storeName?{db:r,storeNames:[t.storeName]}:(s=r,new i(function(t,e){s.transaction(function(n){n.executeSql(\"SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'\",[],function(e,n){for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o).name);t({db:s,storeNames:r})},function(t,n){e(n)})},function(t){e(t)})})))}).then(function(t){return new i(function(e,n){t.db.transaction(function(r){function o(t){return new i(function(e,n){r.executeSql(\"DROP TABLE IF EXISTS \"+t,[],function(){e()},function(t,e){n(e)})})}for(var s=[],a=0,c=t.storeNames.length;a<c;a++)s.push(o(t.storeNames[a]));i.all(s).then(function(){e()}).catch(function(t){n(t)})},function(t){n(t)})})}):i.reject(\"Invalid arguments\"),e),r}};function j(t,e){var n=t.name+\"/\";return t.storeName!==e.storeName&&(n+=t.storeName+\"/\"),n}var q={_driver:\"localStorageWrapper\",_initStorage:function(t){var e={};if(t)for(var n in t)e[n]=t[n];return e.keyPrefix=j(t,this._defaultConfig),!function(){var t=\"_localforage_support_test\";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(t){return!0}}()||0<localStorage.length?((this._dbInfo=e).serializer=H,i.resolve()):i.reject()},_support:function(){try{return\"undefined\"!=typeof localStorage&&\"setItem\"in localStorage&&!!localStorage.setItem}catch(t){return!1}}(),iterate:function(t,e){var n=this,r=n.ready().then(function(){for(var e=n._dbInfo,r=e.keyPrefix,o=r.length,s=localStorage.length,i=1,a=0;a<s;a++){var c=localStorage.key(a);if(0===c.indexOf(r)){var u=localStorage.getItem(c);if(u&&(u=e.serializer.deserialize(u)),void 0!==(u=t(u,c.substring(o),i++)))return u}}});return a(r,e),r},getItem:function(t,e){var n=this;t=u(t);var r=n.ready().then(function(){var e=n._dbInfo,r=localStorage.getItem(e.keyPrefix+t);return r&&(r=e.serializer.deserialize(r)),r});return a(r,e),r},setItem:function(t,e,n){var r=this;t=u(t);var o=r.ready().then(function(){void 0===e&&(e=null);var n=e;return new i(function(o,s){var i=r._dbInfo;i.serializer.serialize(e,function(e,r){if(r)s(r);else try{localStorage.setItem(i.keyPrefix+t,e),o(n)}catch(e){\"QuotaExceededError\"!==e.name&&\"NS_ERROR_DOM_QUOTA_REACHED\"!==e.name||s(e),s(e)}})})});return a(o,n),o},removeItem:function(t,e){var n=this;t=u(t);var r=n.ready().then(function(){localStorage.removeItem(n._dbInfo.keyPrefix+t)});return a(r,e),r},clear:function(t){var e=this,n=e.ready().then(function(){for(var t=e._dbInfo.keyPrefix,n=localStorage.length-1;0<=n;n--){var r=localStorage.key(n);0===r.indexOf(t)&&localStorage.removeItem(r)}});return a(n,t),n},length:function(t){var e=this.keys().then(function(t){return t.length});return a(e,t),e},key:function(t,e){var n=this,r=n.ready().then(function(){var e,r=n._dbInfo;try{e=localStorage.key(t)}catch(r){e=null}return e&&(e=e.substring(r.keyPrefix.length)),e});return a(r,e),r},keys:function(t){var e=this,n=e.ready().then(function(){for(var t=e._dbInfo,n=localStorage.length,r=[],o=0;o<n;o++){var s=localStorage.key(o);0===s.indexOf(t.keyPrefix)&&r.push(s.substring(t.keyPrefix.length))}return r});return a(n,t),n},dropInstance:function(t,e){if(e=l.apply(this,arguments),!(t=\"function\"!=typeof t&&t||{}).name){var n=this.config();t.name=t.name||n.name,t.storeName=t.storeName||n.storeName}var r,o=this;return a(r=t.name?new i(function(e){e(t.storeName?j(t,o._defaultConfig):t.name+\"/\")}).then(function(t){for(var e=localStorage.length-1;0<=e;e--){var n=localStorage.key(e);0===n.indexOf(t)&&localStorage.removeItem(n)}}):i.reject(\"Invalid arguments\"),e),r}},X=function(t,e){for(var n=t.length,r=0;r<n;){if((o=t[r])===(s=e)||\"number\"==typeof o&&\"number\"==typeof s&&isNaN(o)&&isNaN(s))return!0;r++}var o,s;return!1},V=Array.isArray||function(t){return\"[object Array]\"===Object.prototype.toString.call(t)},J={},W={},$={INDEXEDDB:O,WEBSQL:K,LOCALSTORAGE:q},z=[$.INDEXEDDB._driver,$.WEBSQL._driver,$.LOCALSTORAGE._driver],Q=[\"dropInstance\"],Z=[\"clear\",\"getItem\",\"iterate\",\"key\",\"keys\",\"length\",\"removeItem\",\"setItem\"].concat(Q),tt={description:\"\",driver:z.slice(),name:\"localforage\",size:4980736,storeName:\"keyvaluepairs\",version:1};function et(t,e){t[e]=function(){var n=arguments;return t.ready().then(function(){return t[e].apply(t,n)})}}function nt(){for(var t=1;t<arguments.length;t++){var e=arguments[t];if(e)for(var n in e)e.hasOwnProperty(n)&&(arguments[0][n]=V(e[n])?e[n].slice():e[n])}return arguments[0]}var rt=new(function(){function t(e){for(var n in function(e,n){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this),$)if($.hasOwnProperty(n)){var r=$[n],o=r._driver;this[n]=o,J[o]||this.defineDriver(r)}this._defaultConfig=nt({},tt),this._config=nt({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return t.prototype.config=function(t){if(\"object\"!==(void 0===t?\"undefined\":r(t)))return\"string\"==typeof t?this._config[t]:this._config;if(this._ready)return new Error(\"Can't call config() after localforage has been used.\");for(var e in t){if(\"storeName\"===e&&(t[e]=t[e].replace(/\\W/g,\"_\")),\"version\"===e&&\"number\"!=typeof t[e])return new Error(\"Database version must be a number.\");this._config[e]=t[e]}return!(\"driver\"in t&&t.driver)||this.setDriver(this._config.driver)},t.prototype.defineDriver=function(t,e,n){var r=new i(function(e,n){try{var r=t._driver,o=new Error(\"Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver\");if(!t._driver)return void n(o);for(var s=Z.concat(\"_initStorage\"),c=0,u=s.length;c<u;c++){var l=s[c];if((!X(Q,l)||t[l])&&\"function\"!=typeof t[l])return void n(o)}!function(){for(var e=function(t){return function(){var e=new Error(\"Method \"+t+\" is not implemented by the current driver\"),n=i.reject(e);return a(n,arguments[arguments.length-1]),n}},n=0,r=Q.length;n<r;n++){var o=Q[n];t[o]||(t[o]=e(o))}}();var h=function(n){J[r]=t,W[r]=n,e()};\"_support\"in t?t._support&&\"function\"==typeof t._support?t._support().then(h,n):h(!!t._support):h(!0)}catch(o){n(o)}});return c(r,e,n),r},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(t,e,n){var r=J[t]?i.resolve(J[t]):i.reject(new Error(\"Driver not found.\"));return c(r,e,n),r},t.prototype.getSerializer=function(t){var e=i.resolve(H);return c(e,t),e},t.prototype.ready=function(t){var e=this,n=e._driverSet.then(function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready});return c(n,t,t),n},t.prototype.setDriver=function(t,e,n){var r=this;V(t)||(t=[t]);var o=this._getSupportedDrivers(t);function s(){r._config.driver=r.driver()}function a(t){return r._extend(t),s(),r._ready=r._initStorage(r._config),r._ready}var u=null!==this._driverSet?this._driverSet.catch(function(){return i.resolve()}):i.resolve();return this._driverSet=u.then(function(){var t=o[0];return r._dbInfo=null,r._ready=null,r.getDriver(t).then(function(t){var e;r._driver=t._driver,s(),r._wrapLibraryMethodsWithReady(),r._initDriver=(e=o,function(){var t=0;return function n(){for(;t<e.length;){var o=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(o).then(a).catch(n)}s();var c=new Error(\"No available storage method found.\");return r._driverSet=i.reject(c),r._driverSet}()})})}).catch(function(){s();var t=new Error(\"No available storage method found.\");return r._driverSet=i.reject(t),r._driverSet}),c(this._driverSet,e,n),this._driverSet},t.prototype.supports=function(t){return!!W[t]},t.prototype._extend=function(t){nt(this,t)},t.prototype._getSupportedDrivers=function(t){for(var e=[],n=0,r=t.length;n<r;n++){var o=t[n];this.supports(o)&&e.push(o)}return e},t.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,e=Z.length;t<e;t++)et(this,Z[t])},t.prototype.createInstance=function(e){return new t(e)},t}());e.exports=rt},{3:3}]},{},[4])(4)}).call(this,n(21))},function(t,e){if(void 0===r){var n=new Error(\"Cannot find module 'react-native'\");throw n.code=\"MODULE_NOT_FOUND\",n}t.exports=r},function(t,e,n){var r;window,r=function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var o in t)n.d(r,o,(function(e){return t[e]}).bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"\",n(n.s=\"./src/strophe.js\")}({\"./src/bosh.js\":function(t,e,n){\"use strict\";n.r(e);var r=n(\"./src/core.js\"),o=r.default.Strophe,s=r.default.$build;o.Request=function(t,e,n,r){this.id=++o._requestId,this.xmlData=t,this.data=o.serialize(t),this.origFunc=e,this.func=e,this.rid=n,this.date=NaN,this.sends=r||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},o.Request.prototype={getResponse:function(){var t=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(\"parsererror\"===(t=this.xhr.responseXML.documentElement).tagName)throw o.error(\"invalid response received\"),o.error(\"responseText: \"+this.xhr.responseText),o.error(\"responseXML: \"+o.serialize(this.xhr.responseXML)),new Error(\"parsererror\")}else if(this.xhr.responseText){if(o.debug(\"Got responseText but no responseXML; attempting to parse it with DOMParser...\"),!(t=(new DOMParser).parseFromString(this.xhr.responseText,\"application/xml\").documentElement))throw new Error(\"Parsing produced null node\");if(t.querySelector(\"parsererror\")){o.error(\"invalid response received: \"+t.querySelector(\"parsererror\").textContent),o.error(\"responseText: \"+this.xhr.responseText);var e=new Error;throw e.name=o.ErrorCondition.BAD_FORMAT,e}}return t},_newXHR:function(){var t=null;return window.XMLHttpRequest?(t=new XMLHttpRequest).overrideMimeType&&t.overrideMimeType(\"text/xml; charset=utf-8\"):window.ActiveXObject&&(t=new ActiveXObject(\"Microsoft.XMLHTTP\")),t.onreadystatechange=this.func.bind(null,this),t}},o.Bosh=function(t){this._conn=t,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]},o.Bosh.prototype={strip:null,_buildBody:function(){var t=s(\"body\",{rid:this.rid++,xmlns:o.NS.HTTPBIND});return null!==this.sid&&t.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),t},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem(\"strophe-bosh-session\"),this._conn.nextValidRid(this.rid)},_connect:function(t,e,n){this.wait=t||this.wait,this.hold=e||this.hold,this.errors=0;var r=this._buildBody().attrs({to:this._conn.domain,\"xml:lang\":\"en\",wait:this.wait,hold:this.hold,content:\"text/xml; charset=utf-8\",ver:\"1.6\",\"xmpp:version\":\"1.0\",\"xmlns:xmpp\":o.NS.BOSH});n&&r.attrs({route:n});var s=this._conn._connect_cb;this._requests.push(new o.Request(r.tree(),this._onRequestStateChange.bind(this,s.bind(this._conn)),r.tree().getAttribute(\"rid\"))),this._throttledRequestHandler()},_attach:function(t,e,n,r,s,i,a){this._conn.jid=t,this.sid=e,this.rid=n,this._conn.connect_callback=r,this._conn.domain=o.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=s||this.wait,this.hold=i||this.hold,this.window=a||this.window,this._conn._changeConnectStatus(o.Status.ATTACHED,null)},_restore:function(t,e,n,r,s){var i=JSON.parse(window.sessionStorage.getItem(\"strophe-bosh-session\"));if(!(null!=i&&i.rid&&i.sid&&i.jid&&(null==t||o.getBareJidFromJid(i.jid)===o.getBareJidFromJid(t)||null===o.getNodeFromJid(t)&&o.getDomainFromJid(i.jid)===t))){var a=new Error(\"_restore: no restoreable session.\");throw a.name=\"StropheSessionError\",a}this._conn.restored=!0,this._attach(i.jid,i.sid,i.rid,e,n,r,s)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem(\"strophe-bosh-session\",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem(\"strophe-bosh-session\")},_connect_cb:function(t){var e=t.getAttribute(\"type\");if(null!==e&&\"terminate\"===e){var n=t.getAttribute(\"condition\");o.error(\"BOSH-Connection failed: \"+n);var r=t.getElementsByTagName(\"conflict\");return null!==n?(\"remote-stream-error\"===n&&0<r.length&&(n=\"conflict\"),this._conn._changeConnectStatus(o.Status.CONNFAIL,n)):this._conn._changeConnectStatus(o.Status.CONNFAIL,\"unknown\"),this._conn._doDisconnect(n),o.Status.CONNFAIL}this.sid||(this.sid=t.getAttribute(\"sid\"));var s=t.getAttribute(\"requests\");s&&(this.window=parseInt(s,10));var i=t.getAttribute(\"hold\");i&&(this.hold=parseInt(i,10));var a=t.getAttribute(\"wait\");a&&(this.wait=parseInt(a,10));var c=t.getAttribute(\"inactivity\");c&&(this.inactivity=parseInt(c,10))},_disconnect:function(t){this._sendTerminate(t)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem(\"strophe-bosh-session\"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(t){var e=this._getRequestStatus(t),n=this._conn.protocolErrorHandlers.HTTP[e];n&&n.call(this,e)},_hitError:function(t){this.errors++,o.warn(\"request errored, status: \"+t+\", number of errors: \"+this.errors),4<this.errors&&this._conn._onDisconnectTimeout()},_no_auth_received:function(t){o.warn(\"Server did not yet offer a supported authentication mechanism. Sending a blank poll request.\"),t=t?t.bind(this._conn):this._conn._connect_cb.bind(this._conn);var e=this._buildBody();this._requests.push(new o.Request(e.tree(),this._onRequestStateChange.bind(this,t),e.tree().getAttribute(\"rid\"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(;0<this._requests.length;){var t=this._requests.pop();t.abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){}}},_onIdle:function(){var t=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===t.length&&!this._conn.disconnecting&&(o.info(\"no requests during idle cycle, sending blank request\"),t.push(null)),!this._conn.paused){if(this._requests.length<2&&0<t.length){for(var e=this._buildBody(),n=0;n<t.length;n++)null!==t[n]&&(\"restart\"===t[n]?e.attrs({to:this._conn.domain,\"xml:lang\":\"en\",\"xmpp:restart\":\"true\",\"xmlns:xmpp\":o.NS.BOSH}):e.cnode(t[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new o.Request(e.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),e.tree().getAttribute(\"rid\"))),this._throttledRequestHandler()}if(0<this._requests.length){var r=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(o.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),r>Math.floor(o.TIMEOUT*this.wait)&&(o.warn(\"Request \"+this._requests[0].id+\" timed out, over \"+Math.floor(o.TIMEOUT*this.wait)+\" seconds since last activity\"),this._throttledRequestHandler())}}},_getRequestStatus:function(t,e){var n;if(4===t.xhr.readyState)try{n=t.xhr.status}catch(t){o.error(\"Caught an error while retrieving a request's status, reqStatus: \"+n)}return void 0===n&&(n=\"number\"==typeof e?e:0),n},_onRequestStateChange:function(t,e){if(o.debug(\"request id \"+e.id+\".\"+e.sends+\" state changed to \"+e.xhr.readyState),e.abort)e.abort=!1;else if(4===e.xhr.readyState){var n=this._getRequestStatus(e);if(this.lastResponseHeaders=e.xhr.getAllResponseHeaders(),this.disconnecting&&400<=n)return this._hitError(n),void this._callProtocolErrorHandlers(e);var r=0<n&&n<500,s=e.sends>this._conn.maxRetries;(r||s)&&(this._removeRequest(e),o.debug(\"request id \"+e.id+\" should now be removed\")),200===n?((this._requests[1]===e||this._requests[0]===e&&0<this._requests.length&&this._requests[0].age()>Math.floor(o.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(e.rid)+1),o.debug(\"request id \"+e.id+\".\"+e.sends+\" got 200\"),t(e),this.errors=0):0===n||400<=n&&n<600||12e3<=n?(o.error(\"request id \"+e.id+\".\"+e.sends+\" error \"+n+\" happened\"),this._hitError(n),this._callProtocolErrorHandlers(e),400<=n&&n<500&&(this._conn._changeConnectStatus(o.Status.DISCONNECTING,null),this._conn._doDisconnect())):o.error(\"request id \"+e.id+\".\"+e.sends+\" error \"+n+\" happened\"),r||s?s&&!this._conn.connected&&this._conn._changeConnectStatus(o.Status.CONNFAIL,\"giving-up\"):this._throttledRequestHandler()}},_processRequest:function(t){var e=this,n=this._requests[t],r=this._getRequestStatus(n,-1);if(n.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var s=n.age(),i=!isNaN(s)&&s>Math.floor(o.TIMEOUT*this.wait),a=null!==n.dead&&n.timeDead()>Math.floor(o.SECONDARY_TIMEOUT*this.wait);if((i||a||4===n.xhr.readyState&&(r<1||500<=r))&&(a&&o.error(\"Request \".concat(this._requests[t].id,\" timed out (secondary), restarting\")),n.abort=!0,n.xhr.abort(),n.xhr.onreadystatechange=function(){},this._requests[t]=new o.Request(n.xmlData,n.origFunc,n.rid,n.sends),n=this._requests[t]),0===n.xhr.readyState){o.debug(\"request id \"+n.id+\".\"+n.sends+\" posting\");try{var c=this._conn.options.contentType||\"text/xml; charset=utf-8\";n.xhr.open(\"POST\",this._conn.service,!this._conn.options.sync),void 0!==n.xhr.setRequestHeader&&n.xhr.setRequestHeader(\"Content-Type\",c),this._conn.options.withCredentials&&(n.xhr.withCredentials=!0)}catch(t){return o.error(\"XHR open failed: \"+t.toString()),this._conn.connected||this._conn._changeConnectStatus(o.Status.CONNFAIL,\"bad-service\"),void this._conn.disconnect()}var u=function(){if(n.date=new Date,e._conn.options.customHeaders){var t=e._conn.options.customHeaders;for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.xhr.setRequestHeader(r,t[r])}n.xhr.send(n.data)};if(1<n.sends){var l=1e3*Math.min(Math.floor(o.TIMEOUT*this.wait),Math.pow(n.sends,3));setTimeout(function(){u()},l)}else u();n.sends++,this._conn.xmlOutput!==o.Connection.prototype.xmlOutput&&this._conn.xmlOutput(n.xmlData.nodeName===this.strip&&n.xmlData.childNodes.length?n.xmlData.childNodes[0]:n.xmlData),this._conn.rawOutput!==o.Connection.prototype.rawOutput&&this._conn.rawOutput(n.data)}else o.debug(\"_processRequest: \"+(0===t?\"first\":\"second\")+\" request has readyState of \"+n.xhr.readyState)}},_removeRequest:function(t){o.debug(\"removing request\");for(var e=this._requests.length-1;0<=e;e--)t===this._requests[e]&&this._requests.splice(e,1);t.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(t){var e=this._requests[t];null===e.dead&&(e.dead=new Date),this._processRequest(t)},_reqToData:function(t){try{return t.getResponse()}catch(t){if(\"parsererror\"!==t.message)throw t;this._conn.disconnect(\"strophe-parsererror\")}},_sendTerminate:function(t){o.info(\"_sendTerminate was called\");var e=this._buildBody().attrs({type:\"terminate\"});t&&e.cnode(t.tree());var n=new o.Request(e.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),e.tree().getAttribute(\"rid\"));this._requests.push(n),this._throttledRequestHandler()},_send:function(){var t=this;clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){return t._conn._onIdle()},100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){o.debug(this._requests?\"_throttledRequestHandler called with \"+this._requests.length+\" requests\":\"_throttledRequestHandler called with undefined requests\"),this._requests&&0!==this._requests.length&&(0<this._requests.length&&this._processRequest(0),1<this._requests.length&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}}},\"./src/core.js\":function(t,e,n){\"use strict\";n.r(e);var r=n(\"./src/md5.js\"),o=n(\"./src/sha1.js\"),s=n(\"./src/utils.js\");function i(t){return(i=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t})(t)}function a(t,e){return new l.Builder(t,e)}function c(t){return new l.Builder(\"iq\",t)}function u(t){return new l.Builder(\"presence\",t)}var l={VERSION:\"1.3.0\",NS:{HTTPBIND:\"http://jabber.org/protocol/httpbind\",BOSH:\"urn:xmpp:xbosh\",CLIENT:\"jabber:client\",AUTH:\"jabber:iq:auth\",ROSTER:\"jabber:iq:roster\",PROFILE:\"jabber:iq:profile\",DISCO_INFO:\"http://jabber.org/protocol/disco#info\",DISCO_ITEMS:\"http://jabber.org/protocol/disco#items\",MUC:\"http://jabber.org/protocol/muc\",SASL:\"urn:ietf:params:xml:ns:xmpp-sasl\",STREAM:\"http://etherx.jabber.org/streams\",FRAMING:\"urn:ietf:params:xml:ns:xmpp-framing\",BIND:\"urn:ietf:params:xml:ns:xmpp-bind\",SESSION:\"urn:ietf:params:xml:ns:xmpp-session\",VERSION:\"jabber:iq:version\",STANZAS:\"urn:ietf:params:xml:ns:xmpp-stanzas\",XHTML_IM:\"http://jabber.org/protocol/xhtml-im\",XHTML:\"http://www.w3.org/1999/xhtml\"},XHTML:{tags:[\"a\",\"blockquote\",\"br\",\"cite\",\"em\",\"img\",\"li\",\"ol\",\"p\",\"span\",\"strong\",\"ul\",\"body\"],attributes:{a:[\"href\"],blockquote:[\"style\"],br:[],cite:[\"style\"],em:[],img:[\"src\",\"alt\",\"style\",\"height\",\"width\"],li:[\"style\"],ol:[\"style\"],p:[\"style\"],span:[\"style\"],strong:[],ul:[\"style\"],body:[]},css:[\"background-color\",\"color\",\"font-family\",\"font-size\",\"font-style\",\"font-weight\",\"margin-left\",\"margin-right\",\"text-align\",\"text-decoration\"],validTag:function(t){for(var e=0;e<l.XHTML.tags.length;e++)if(t===l.XHTML.tags[e])return!0;return!1},validAttribute:function(t,e){if(void 0!==l.XHTML.attributes[t]&&0<l.XHTML.attributes[t].length)for(var n=0;n<l.XHTML.attributes[t].length;n++)if(e===l.XHTML.attributes[t][n])return!0;return!1},validCSS:function(t){for(var e=0;e<l.XHTML.css.length;e++)if(t===l.XHTML.css[e])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},ErrorCondition:{BAD_FORMAT:\"bad-format\",CONFLICT:\"conflict\",MISSING_JID_NODE:\"x-strophe-bad-non-anon-jid\",NO_AUTH_MECH:\"no-auth-mech\",UNKNOWN_REASON:\"unknown\"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(t,e){l.NS[t]=e},forEachChild:function(t,e,n){for(var r=0;r<t.childNodes.length;r++){var o=t.childNodes[r];o.nodeType!==l.ElementType.NORMAL||e&&!this.isTagEqual(o,e)||n(o)}},isTagEqual:function(t,e){return t.tagName===e},_xmlGenerator:null,_makeGenerator:function(){var t;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(t=this._getIEXmlDom()).appendChild(t.createElement(\"strophe\")):t=document.implementation.createDocument(\"jabber:client\",\"strophe\",null),t},xmlGenerator:function(){return l._xmlGenerator||(l._xmlGenerator=l._makeGenerator()),l._xmlGenerator},_getIEXmlDom:function(){for(var t=null,e=[\"Msxml2.DOMDocument.6.0\",\"Msxml2.DOMDocument.5.0\",\"Msxml2.DOMDocument.4.0\",\"MSXML2.DOMDocument.3.0\",\"MSXML2.DOMDocument\",\"MSXML.DOMDocument\",\"Microsoft.XMLDOM\"],n=0;n<e.length&&null===t;n++)try{t=new ActiveXObject(e[n])}catch(e){t=null}return t},xmlElement:function(t){if(!t)return null;for(var e=l.xmlGenerator().createElement(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r)if(\"string\"==typeof r||\"number\"==typeof r)e.appendChild(l.xmlTextNode(r));else if(\"object\"===i(r)&&\"function\"==typeof r.sort)for(var o=0;o<r.length;o++){var s=r[o];\"object\"===i(s)&&\"function\"==typeof s.sort&&null!=s[1]&&e.setAttribute(s[0],s[1])}else if(\"object\"===i(r))for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&null!=r[a]&&e.setAttribute(a,r[a])}return e},xmlescape:function(t){return(t=(t=(t=(t=t.replace(/\\&/g,\"&amp;\")).replace(/</g,\"&lt;\")).replace(/>/g,\"&gt;\")).replace(/'/g,\"&apos;\")).replace(/\"/g,\"&quot;\")},xmlunescape:function(t){return(t=(t=(t=(t=t.replace(/\\&amp;/g,\"&\")).replace(/&lt;/g,\"<\")).replace(/&gt;/g,\">\")).replace(/&apos;/g,\"'\")).replace(/&quot;/g,'\"')},xmlTextNode:function(t){return l.xmlGenerator().createTextNode(t)},xmlHtmlNode:function(t){var e;return DOMParser?e=(new DOMParser).parseFromString(t,\"text/xml\"):((e=new ActiveXObject(\"Microsoft.XMLDOM\")).async=\"false\",e.loadXML(t)),e},getText:function(t){if(!t)return null;var e=\"\";0===t.childNodes.length&&t.nodeType===l.ElementType.TEXT&&(e+=t.nodeValue);for(var n=0;n<t.childNodes.length;n++)t.childNodes[n].nodeType===l.ElementType.TEXT&&(e+=t.childNodes[n].nodeValue);return l.xmlescape(e)},copyElement:function(t){var e;if(t.nodeType===l.ElementType.NORMAL){e=l.xmlElement(t.tagName);for(var n=0;n<t.attributes.length;n++)e.setAttribute(t.attributes[n].nodeName,t.attributes[n].value);for(var r=0;r<t.childNodes.length;r++)e.appendChild(l.copyElement(t.childNodes[r]))}else t.nodeType===l.ElementType.TEXT&&(e=l.xmlGenerator().createTextNode(t.nodeValue));return e},createHtml:function(t){var e;if(t.nodeType===l.ElementType.NORMAL){var n=t.nodeName.toLowerCase();if(l.XHTML.validTag(n))try{e=l.xmlElement(n);for(var r=0;r<l.XHTML.attributes[n].length;r++){var o=l.XHTML.attributes[n][r],s=t.getAttribute(o);if(null!=s&&\"\"!==s&&!1!==s&&0!==s)if(\"style\"===o&&\"object\"===i(s)&&void 0!==s.cssText&&(s=s.cssText),\"style\"===o){for(var a=[],c=s.split(\";\"),u=0;u<c.length;u++){var h=c[u].split(\":\"),d=h[0].replace(/^\\s*/,\"\").replace(/\\s*$/,\"\").toLowerCase();if(l.XHTML.validCSS(d)){var p=h[1].replace(/^\\s*/,\"\").replace(/\\s*$/,\"\");a.push(d+\": \"+p)}}0<a.length&&(s=a.join(\"; \"),e.setAttribute(o,s))}else e.setAttribute(o,s)}for(var f=0;f<t.childNodes.length;f++)e.appendChild(l.createHtml(t.childNodes[f]))}catch(t){e=l.xmlTextNode(\"\")}else{e=l.xmlGenerator().createDocumentFragment();for(var g=0;g<t.childNodes.length;g++)e.appendChild(l.createHtml(t.childNodes[g]))}}else if(t.nodeType===l.ElementType.FRAGMENT){e=l.xmlGenerator().createDocumentFragment();for(var E=0;E<t.childNodes.length;E++)e.appendChild(l.createHtml(t.childNodes[E]))}else t.nodeType===l.ElementType.TEXT&&(e=l.xmlTextNode(t.nodeValue));return e},escapeNode:function(t){return\"string\"!=typeof t?t:t.replace(/^\\s+|\\s+$/g,\"\").replace(/\\\\/g,\"\\\\5c\").replace(/ /g,\"\\\\20\").replace(/\\\"/g,\"\\\\22\").replace(/\\&/g,\"\\\\26\").replace(/\\'/g,\"\\\\27\").replace(/\\//g,\"\\\\2f\").replace(/:/g,\"\\\\3a\").replace(/</g,\"\\\\3c\").replace(/>/g,\"\\\\3e\").replace(/@/g,\"\\\\40\")},unescapeNode:function(t){return\"string\"!=typeof t?t:t.replace(/\\\\20/g,\" \").replace(/\\\\22/g,'\"').replace(/\\\\26/g,\"&\").replace(/\\\\27/g,\"'\").replace(/\\\\2f/g,\"/\").replace(/\\\\3a/g,\":\").replace(/\\\\3c/g,\"<\").replace(/\\\\3e/g,\">\").replace(/\\\\40/g,\"@\").replace(/\\\\5c/g,\"\\\\\")},getNodeFromJid:function(t){return t.indexOf(\"@\")<0?null:t.split(\"@\")[0]},getDomainFromJid:function(t){var e=l.getBareJidFromJid(t);if(e.indexOf(\"@\")<0)return e;var n=e.split(\"@\");return n.splice(0,1),n.join(\"@\")},getResourceFromJid:function(t){var e=t.split(\"/\");return e.length<2?null:(e.splice(0,1),e.join(\"/\"))},getBareJidFromJid:function(t){return t?t.split(\"/\")[0]:null},_handleError:function(t){void 0!==t.stack&&l.fatal(t.stack),l.fatal(t.sourceURL?\"error: \"+this.handler+\" \"+t.sourceURL+\":\"+t.line+\" - \"+t.name+\": \"+t.message:t.fileName?\"error: \"+this.handler+\" \"+t.fileName+\":\"+t.lineNumber+\" - \"+t.name+\": \"+t.message:\"error: \"+t.message)},log:function(t,e){t===this.LogLevel.FATAL&&\"object\"===i(window.console)&&\"function\"==typeof window.console.error&&window.console.error(e)},debug:function(t){this.log(this.LogLevel.DEBUG,t)},info:function(t){this.log(this.LogLevel.INFO,t)},warn:function(t){this.log(this.LogLevel.WARN,t)},error:function(t){this.log(this.LogLevel.ERROR,t)},fatal:function(t){this.log(this.LogLevel.FATAL,t)},serialize:function(t){if(!t)return null;\"function\"==typeof t.tree&&(t=t.tree());var e=function(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||\"[object Arguments]\"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}()}(Array(t.attributes.length).keys()).map(function(e){return t.attributes[e].nodeName});e.sort();var n=e.reduce(function(e,n){return\"\".concat(e,\" \").concat(n,'=\"').concat(l.xmlescape(t.attributes.getNamedItem(n).value),'\"')},\"<\".concat(t.nodeName));if(0<t.childNodes.length){n+=\">\";for(var r=0;r<t.childNodes.length;r++){var o=t.childNodes[r];switch(o.nodeType){case l.ElementType.NORMAL:n+=l.serialize(o);break;case l.ElementType.TEXT:n+=l.xmlescape(o.nodeValue);break;case l.ElementType.CDATA:n+=\"<![CDATA[\"+o.nodeValue+\"]]>\"}}n+=\"</\"+t.nodeName+\">\"}else n+=\"/>\";return n},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(t,e){l._connectionPlugins[t]=e},Builder:function(t,e){\"presence\"!==t&&\"message\"!==t&&\"iq\"!==t||(e&&!e.xmlns?e.xmlns=l.NS.CLIENT:e||(e={xmlns:l.NS.CLIENT})),this.nodeTree=l.xmlElement(t,e),this.node=this.nodeTree}};l.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return l.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(void 0===t[e]?this.node.removeAttribute(e):this.node.setAttribute(e,t[e]));return this},c:function(t,e,n){var r=l.xmlElement(t,e,n);return this.node.appendChild(r),\"string\"!=typeof n&&\"number\"!=typeof n&&(this.node=r),this},cnode:function(t){var e,n=l.xmlGenerator();try{e=void 0!==n.importNode}catch(t){e=!1}var r=e?n.importNode(t,!0):l.copyElement(t);return this.node.appendChild(r),this.node=r,this},t:function(t){var e=l.xmlTextNode(t);return this.node.appendChild(e),this},h:function(t){var e=document.createElement(\"body\");e.innerHTML=t;for(var n=l.createHtml(e);0<n.childNodes.length;)this.node.appendChild(n.childNodes[0]);return this}},l.Handler=function(t,e,n,r,o,s,i){this.handler=t,this.ns=e,this.name=n,this.type=r,this.id=o,this.options=i||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(l.warn('The \"matchBare\" option is deprecated, use \"matchBareFromJid\" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.from=this.options.matchBareFromJid?s?l.getBareJidFromJid(s):null:s,this.user=!0},l.Handler.prototype={getNamespace:function(t){var e=t.getAttribute(\"xmlns\");return e&&this.options.ignoreNamespaceFragment&&(e=e.split(\"#\")[0]),e},namespaceMatch:function(t){var e=this,n=!1;return!this.ns||(l.forEachChild(t,null,function(t){e.getNamespace(t)===e.ns&&(n=!0)}),n||this.getNamespace(t)===this.ns)},isMatch:function(t){var e=t.getAttribute(\"from\");this.options.matchBareFromJid&&(e=l.getBareJidFromJid(e));var n=t.getAttribute(\"type\");return!(!this.namespaceMatch(t)||this.name&&!l.isTagEqual(t,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&t.getAttribute(\"id\")!==this.id||this.from&&e!==this.from)},run:function(t){var e=null;try{e=this.handler(t)}catch(t){throw l._handleError(t),t}return e},toString:function(){return\"{Handler: \"+this.handler+\"(\"+this.name+\",\"+this.id+\",\"+this.ns+\")}\"}},l.TimedHandler=function(t,e){this.period=t,this.handler=e,this.lastCalled=(new Date).getTime(),this.user=!0},l.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return\"{TimedHandler: \"+this.handler+\"(\"+this.period+\")}\"}},l.Connection=function(t,e){var n=this;this.service=t,this.options=e||{};var r=this.options.protocol||\"\";for(var o in this._proto=0===t.indexOf(\"ws:\")||0===t.indexOf(\"wss:\")||0===r.indexOf(\"ws\")?new l.Websocket(this):new l.Bosh(this),this.jid=\"\",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){return n._onIdle()},100),s.default.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),l._connectionPlugins)if(Object.prototype.hasOwnProperty.call(l._connectionPlugins,o)){var i=function(){};i.prototype=l._connectionPlugins[o],this[o]=new i,this[o].init(this)}},l.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(t){var e=\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return(\"x\"===t?e:3&e|8).toString(16)});return\"string\"==typeof t||\"number\"==typeof t?e+\":\"+t:e+\"\"},addProtocolErrorHandler:function(t,e,n){this.protocolErrorHandlers[t][e]=n},connect:function(t,e,n,r,o,s,i){this.jid=t,this.authzid=l.getBareJidFromJid(this.jid),this.authcid=i||l.getNodeFromJid(this.jid),this.pass=e,this.servtype=\"xmpp\",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=l.getDomainFromJid(this.jid),this._changeConnectStatus(l.Status.CONNECTING,null),this._proto._connect(r,o,s)},attach:function(t,e,n,r,o,s,i){if(!(this._proto instanceof l.Bosh)){var a=new Error('The \"attach\" method can only be used with a BOSH connection.');throw a.name=\"StropheSessionError\",a}this._proto._attach(t,e,n,r,o,s,i)},restore:function(t,e,n,r,o){if(!this._sessionCachingSupported()){var s=new Error('The \"restore\" method can only be used with a BOSH connection.');throw s.name=\"StropheSessionError\",s}this._proto._restore(t,e,n,r,o)},_sessionCachingSupported:function(){if(this._proto instanceof l.Bosh){if(!JSON)return!1;try{sessionStorage.setItem(\"_strophe_\",\"_strophe_\"),sessionStorage.removeItem(\"_strophe_\")}catch(t){return!1}return!0}return!1},xmlInput:function(t){},xmlOutput:function(t){},rawInput:function(t){},rawOutput:function(t){},nextValidRid:function(t){},send:function(t){if(null!==t){if(\"function\"==typeof t.sort)for(var e=0;e<t.length;e++)this._queueData(t[e]);else this._queueData(\"function\"==typeof t.tree?t.tree():t);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(t,e,n,r){var o=this,s=null;\"function\"==typeof t.tree&&(t=t.tree());var i=t.getAttribute(\"id\");if(i||(i=this.getUniqueId(\"sendPresence\"),t.setAttribute(\"id\",i)),\"function\"==typeof e||\"function\"==typeof n){var a=this.addHandler(function(t){s&&o.deleteTimedHandler(s),\"error\"===t.getAttribute(\"type\")?n&&n(t):e&&e(t)},null,\"presence\",null,i);r&&(s=this.addTimedHandler(r,function(){return o.deleteHandler(a),n&&n(null),!1}))}return this.send(t),i},sendIQ:function(t,e,n,r){var o=this,s=null;\"function\"==typeof t.tree&&(t=t.tree());var i=t.getAttribute(\"id\");if(i||(i=this.getUniqueId(\"sendIQ\"),t.setAttribute(\"id\",i)),\"function\"==typeof e||\"function\"==typeof n){var a=this.addHandler(function(t){s&&o.deleteTimedHandler(s);var r=t.getAttribute(\"type\");if(\"result\"===r)e&&e(t);else{if(\"error\"!==r){var i=new Error(\"Got bad IQ type of \".concat(r));throw i.name=\"StropheError\",i}n&&n(t)}},null,\"iq\",[\"error\",\"result\"],i);r&&(s=this.addTimedHandler(r,function(){return o.deleteHandler(a),n&&n(null),!1}))}return this.send(t),i},_queueData:function(t){if(null===t||!t.tagName||!t.childNodes){var e=new Error(\"Cannot queue non-DOMElement.\");throw e.name=\"StropheError\",e}this._data.push(t)},_sendRestart:function(){var t=this;this._data.push(\"restart\"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){return t._onIdle()},100)},addTimedHandler:function(t,e){var n=new l.TimedHandler(t,e);return this.addTimeds.push(n),n},deleteTimedHandler:function(t){this.removeTimeds.push(t)},addHandler:function(t,e,n,r,o,s,i){var a=new l.Handler(t,e,n,r,o,s,i);return this.addHandlers.push(a),a},deleteHandler:function(t){this.removeHandlers.push(t);var e=this.addHandlers.indexOf(t);0<=e&&this.addHandlers.splice(e,1)},registerSASLMechanisms:function(t){this.mechanisms={},(t=t||[l.SASLAnonymous,l.SASLExternal,l.SASLMD5,l.SASLOAuthBearer,l.SASLXOAuth2,l.SASLPlain,l.SASLSHA1]).forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(t){this.mechanisms[t.prototype.name]=t},disconnect:function(t){if(this._changeConnectStatus(l.Status.DISCONNECTING,t),l.info(\"Disconnect was called because: \"+t),this.connected){var e=!1;this.disconnecting=!0,this.authenticated&&(e=u({xmlns:l.NS.CLIENT,type:\"unavailable\"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(e)}else l.info(\"Disconnect was called before Strophe connected to the server\"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(t,e,n){for(var r in l._connectionPlugins)if(Object.prototype.hasOwnProperty.call(l._connectionPlugins,r)){var o=this[r];if(o.statusChanged)try{o.statusChanged(t,e)}catch(t){l.error(\"\".concat(r,\" plugin caused an exception changing status: \").concat(t))}}if(this.connect_callback)try{this.connect_callback(t,e,n)}catch(t){l._handleError(t),l.error(\"User connection callback caused an exception: \".concat(t))}},_doDisconnect:function(t){\"number\"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),l.info(\"_doDisconnect was called\"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(l.Status.DISCONNECTED,t),this.connected=!1},_dataRecv:function(t,e){var n=this;l.info(\"_dataRecv called\");var r=this._proto._reqToData(t);if(null!==r){for(this.xmlInput!==l.Connection.prototype.xmlInput&&this.xmlInput(r.nodeName===this._proto.strip&&r.childNodes.length?r.childNodes[0]:r),this.rawInput!==l.Connection.prototype.rawInput&&this.rawInput(e||l.serialize(r));0<this.removeHandlers.length;){var o=this.removeHandlers.pop(),s=this.handlers.indexOf(o);0<=s&&this.handlers.splice(s,1)}for(;0<this.addHandlers.length;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var i=r.getAttribute(\"type\");if(null!==i&&\"terminate\"===i){if(this.disconnecting)return;var a=r.getAttribute(\"condition\"),c=r.getElementsByTagName(\"conflict\");return null!==a?(\"remote-stream-error\"===a&&0<c.length&&(a=\"conflict\"),this._changeConnectStatus(l.Status.CONNFAIL,a)):this._changeConnectStatus(l.Status.CONNFAIL,l.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(a)}l.forEachChild(r,null,function(t){var e=n.handlers;n.handlers=[];for(var r=0;r<e.length;r++){var o=e[r];try{!o.isMatch(t)||!n.authenticated&&o.user?n.handlers.push(o):o.run(t)&&n.handlers.push(o)}catch(t){l.warn(\"Removing Strophe handlers due to uncaught exception: \"+t.message)}}})}}},mechanisms:{},_connect_cb:function(t,e,n){var r;l.info(\"_connect_cb was called\"),this.connected=!0;try{r=this._proto._reqToData(t)}catch(t){if(t.name!==l.ErrorCondition.BAD_FORMAT)throw t;this._changeConnectStatus(l.Status.CONNFAIL,l.ErrorCondition.BAD_FORMAT),this._doDisconnect(l.ErrorCondition.BAD_FORMAT)}if(r&&(this.xmlInput!==l.Connection.prototype.xmlInput&&this.xmlInput(r.nodeName===this._proto.strip&&r.childNodes.length?r.childNodes[0]:r),this.rawInput!==l.Connection.prototype.rawInput&&this.rawInput(n||l.serialize(r)),this._proto._connect_cb(r)!==l.Status.CONNFAIL))if(r.getElementsByTagNameNS?0<r.getElementsByTagNameNS(l.NS.STREAM,\"features\").length:0<r.getElementsByTagName(\"stream:features\").length||0<r.getElementsByTagName(\"features\").length){var o=[],s=r.getElementsByTagName(\"mechanism\");if(0<s.length)for(var i=0;i<s.length;i++){var a=l.getText(s[i]);this.mechanisms[a]&&o.push(this.mechanisms[a])}0!==o.length||0!==r.getElementsByTagName(\"auth\").length?!1!==this.do_authentication&&this.authenticate(o):this._proto._no_auth_received(e)}else this._proto._no_auth_received(e)},sortMechanismsByPriority:function(t){for(var e=0;e<t.length-1;++e){for(var n=e,r=e+1;r<t.length;++r)t[r].prototype.priority>t[n].prototype.priority&&(n=r);if(n!==e){var o=t[e];t[e]=t[n],t[n]=o}}return t},_attemptSASLAuth:function(t){t=this.sortMechanismsByPriority(t||[]);for(var e=!1,n=0;n<t.length;++n)if(t[n].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,\"success\",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,\"failure\",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,\"challenge\",null,null),this._sasl_mechanism=new t[n],this._sasl_mechanism.onStart(this);var r=a(\"auth\",{xmlns:l.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var o=this._sasl_mechanism.onChallenge(this,null);r.t(btoa(o))}this.send(r.tree()),e=!0;break}return e},_attemptLegacyAuth:function(){null===l.getNodeFromJid(this.jid)?(this._changeConnectStatus(l.Status.CONNFAIL,l.ErrorCondition.MISSING_JID_NODE),this.disconnect(l.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(l.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,\"_auth_1\"),this.send(c({type:\"get\",to:this.domain,id:\"_auth_1\"}).c(\"query\",{xmlns:l.NS.AUTH}).c(\"username\",{}).t(l.getNodeFromJid(this.jid)).tree()))},authenticate:function(t){this._attemptSASLAuth(t)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(t){var e=atob(l.getText(t)),n=this._sasl_mechanism.onChallenge(this,e),r=a(\"response\",{xmlns:l.NS.SASL});return\"\"!==n&&r.t(btoa(n)),this.send(r.tree()),!0},_auth1_cb:function(t){var e=c({type:\"set\",id:\"_auth_2\"}).c(\"query\",{xmlns:l.NS.AUTH}).c(\"username\",{}).t(l.getNodeFromJid(this.jid)).up().c(\"password\").t(this.pass);return l.getResourceFromJid(this.jid)||(this.jid=l.getBareJidFromJid(this.jid)+\"/strophe\"),e.up().c(\"resource\",{}).t(l.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,\"_auth_2\"),this.send(e.tree()),!1},_sasl_success_cb:function(t){var e=this;if(this._sasl_data[\"server-signature\"]){var n,r=atob(l.getText(t)).match(/([a-z]+)=([^,]+)(,|$)/);if(\"v\"===r[1]&&(n=r[2]),n!==this._sasl_data[\"server-signature\"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}l.info(\"SASL authentication succeeded.\"),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var o=[],s=function(t,n){for(;t.length;)e.deleteHandler(t.pop());return e._sasl_auth1_cb(n),!1};return o.push(this._addSysHandler(function(t){return s(o,t)},null,\"stream:features\",null,null)),o.push(this._addSysHandler(function(t){return s(o,t)},l.NS.STREAM,\"features\",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(t){this.features=t;for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];\"bind\"===n.nodeName&&(this.do_bind=!0),\"session\"===n.nodeName&&(this.do_session=!0)}if(!this.do_bind)return this._changeConnectStatus(l.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,\"_bind_auth_2\");var r=l.getResourceFromJid(this.jid);return this.send(r?c({type:\"set\",id:\"_bind_auth_2\"}).c(\"bind\",{xmlns:l.NS.BIND}).c(\"resource\",{}).t(r).tree():c({type:\"set\",id:\"_bind_auth_2\"}).c(\"bind\",{xmlns:l.NS.BIND}).tree()),!1},_sasl_bind_cb:function(t){var e;if(\"error\"===t.getAttribute(\"type\"))return l.info(\"SASL binding failed.\"),0<t.getElementsByTagName(\"conflict\").length&&(e=l.ErrorCondition.CONFLICT),this._changeConnectStatus(l.Status.AUTHFAIL,e,t),!1;var n=t.getElementsByTagName(\"bind\");if(!(0<n.length))return l.info(\"SASL binding failed.\"),this._changeConnectStatus(l.Status.AUTHFAIL,null,t),!1;var r=n[0].getElementsByTagName(\"jid\");0<r.length&&(this.jid=l.getText(r[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,\"_session_auth_2\"),this.send(c({type:\"set\",id:\"_session_auth_2\"}).c(\"session\",{xmlns:l.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(l.Status.CONNECTED,null)))},_sasl_session_cb:function(t){if(\"result\"===t.getAttribute(\"type\"))this.authenticated=!0,this._changeConnectStatus(l.Status.CONNECTED,null);else if(\"error\"===t.getAttribute(\"type\"))return l.info(\"Session creation failed.\"),this._changeConnectStatus(l.Status.AUTHFAIL,null,t),!1;return!1},_sasl_failure_cb:function(t){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(l.Status.AUTHFAIL,null,t),!1},_auth2_cb:function(t){return\"result\"===t.getAttribute(\"type\")?(this.authenticated=!0,this._changeConnectStatus(l.Status.CONNECTED,null)):\"error\"===t.getAttribute(\"type\")&&(this._changeConnectStatus(l.Status.AUTHFAIL,null,t),this.disconnect(\"authentication failed\")),!1},_addSysTimedHandler:function(t,e){var n=new l.TimedHandler(t,e);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(t,e,n,r,o){var s=new l.Handler(t,e,n,r,o);return s.user=!1,this.addHandlers.push(s),s},_onDisconnectTimeout:function(){return l.info(\"_onDisconnectTimeout was called\"),this._changeConnectStatus(l.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var t=this;0<this.addTimeds.length;)this.timedHandlers.push(this.addTimeds.pop());for(;0<this.removeTimeds.length;){var e=this.removeTimeds.pop(),n=this.timedHandlers.indexOf(e);0<=n&&this.timedHandlers.splice(n,1)}for(var r=(new Date).getTime(),o=[],s=0;s<this.timedHandlers.length;s++){var i=this.timedHandlers[s];!this.authenticated&&i.user||(i.lastCalled+i.period-r<=0?i.run()&&o.push(i):o.push(i))}this.timedHandlers=o,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){return t._onIdle()},100))}},l.SASLMechanism=function(t,e,n){this.name=t,this.isClientFirst=e,this.priority=n},l.SASLMechanism.prototype={test:function(t){return!0},onStart:function(t){this._connection=t},onChallenge:function(t,e){throw new Error(\"You should implement challenge handling!\")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},l.SASLAnonymous=function(){},l.SASLAnonymous.prototype=new l.SASLMechanism(\"ANONYMOUS\",!1,20),l.SASLAnonymous.prototype.test=function(t){return null===t.authcid},l.SASLPlain=function(){},l.SASLPlain.prototype=new l.SASLMechanism(\"PLAIN\",!0,50),l.SASLPlain.prototype.test=function(t){return null!==t.authcid},l.SASLPlain.prototype.onChallenge=function(t){var e=t.authzid;return e+=\"\\0\",e+=t.authcid,e+=\"\\0\",s.default.utf16to8(e+=t.pass)},l.SASLSHA1=function(){},l.SASLSHA1.prototype=new l.SASLMechanism(\"SCRAM-SHA-1\",!0,70),l.SASLSHA1.prototype.test=function(t){return null!==t.authcid},l.SASLSHA1.prototype.onChallenge=function(t,e,n){var i=n||r.default.hexdigest(1234567890*Math.random()),a=\"n=\"+s.default.utf16to8(t.authcid);return a+=\",r=\",a+=i,t._sasl_data.cnonce=i,a=\"n,,\"+(t._sasl_data[\"client-first-message-bare\"]=a),this.onChallenge=function(t,e){for(var n,r,i,a,c,u,l,h,d=\"c=biws,\",p=\"\".concat(t._sasl_data[\"client-first-message-bare\"],\",\").concat(e,\",\"),f=t._sasl_data.cnonce,g=/([a-z]+)=([^,]+)(,|$)/;e.match(g);){var E=e.match(g);switch(e=e.replace(E[0],\"\"),E[1]){case\"r\":n=E[2];break;case\"s\":r=E[2];break;case\"i\":i=E[2]}}if(n.substr(0,f.length)!==f)return t._sasl_data={},t._sasl_failure_cb();p+=d+=\"r=\"+n,r=atob(r),r+=\"\\0\\0\\0\\x01\";var m=s.default.utf16to8(t.pass);for(a=u=o.default.core_hmac_sha1(m,r),l=1;l<i;l++){for(c=o.default.core_hmac_sha1(m,o.default.binb2str(u)),h=0;h<5;h++)a[h]^=c[h];u=c}a=o.default.binb2str(a);var _=o.default.core_hmac_sha1(a,\"Client Key\"),T=o.default.str_hmac_sha1(a,\"Server Key\"),C=o.default.core_hmac_sha1(o.default.str_sha1(o.default.binb2str(_)),p);for(t._sasl_data[\"server-signature\"]=o.default.b64_hmac_sha1(T,p),h=0;h<5;h++)_[h]^=C[h];return d+\",p=\"+btoa(o.default.binb2str(_))},a},l.SASLMD5=function(){},l.SASLMD5.prototype=new l.SASLMechanism(\"DIGEST-MD5\",!1,60),l.SASLMD5.prototype.test=function(t){return null!==t.authcid},l.SASLMD5.prototype._quote=function(t){return'\"'+t.replace(/\\\\/g,\"\\\\\\\\\").replace(/\"/g,'\\\\\"')+'\"'},l.SASLMD5.prototype.onChallenge=function(t,e,n){for(var o=/([a-z]+)=(\"[^\"]+\"|[^,\"]+)(?:,|$)/,i=n||r.default.hexdigest(\"\"+1234567890*Math.random()),a=\"\",c=null,u=\"\";e.match(o);){var l=e.match(o);switch(e=e.replace(l[0],\"\"),l[2]=l[2].replace(/^\"(.+)\"$/,\"$1\"),l[1]){case\"realm\":a=l[2];break;case\"nonce\":u=l[2];break;case\"qop\":break;case\"host\":c=l[2]}}var h=t.servtype+\"/\"+t.domain;null!==c&&(h=h+\"/\"+c);var d=s.default.utf16to8(t.authcid+\":\"+a+\":\"+this._connection.pass),p=r.default.hash(d)+\":\"+u+\":\"+i,f=\"AUTHENTICATE:\"+h,g=\"\";return g+=\"charset=utf-8,\",g+=\"username=\"+this._quote(s.default.utf16to8(t.authcid))+\",\",g+=\"realm=\"+this._quote(a)+\",\",g+=\"nonce=\"+this._quote(u)+\",\",g+=\"nc=00000001,\",g+=\"cnonce=\"+this._quote(i)+\",\",g+=\"digest-uri=\"+this._quote(h)+\",\",g+=\"response=\"+r.default.hexdigest(r.default.hexdigest(p)+\":\"+u+\":00000001:\"+i+\":auth:\"+r.default.hexdigest(f))+\",\",g+=\"qop=auth\",this.onChallenge=function(){return\"\"},g},l.SASLOAuthBearer=function(){},l.SASLOAuthBearer.prototype=new l.SASLMechanism(\"OAUTHBEARER\",!0,40),l.SASLOAuthBearer.prototype.test=function(t){return null!==t.pass},l.SASLOAuthBearer.prototype.onChallenge=function(t){var e=\"n,\";return null!==t.authcid&&(e=e+\"a=\"+t.authzid),e+=\",\",e+=\"\\x01\",e+=\"auth=Bearer \",e+=t.pass,e+=\"\\x01\",s.default.utf16to8(e+=\"\\x01\")},l.SASLExternal=function(){},l.SASLExternal.prototype=new l.SASLMechanism(\"EXTERNAL\",!0,10),l.SASLExternal.prototype.onChallenge=function(t){return t.authcid===t.authzid?\"\":t.authzid},l.SASLXOAuth2=function(){},l.SASLXOAuth2.prototype=new l.SASLMechanism(\"X-OAUTH2\",!0,30),l.SASLXOAuth2.prototype.test=function(t){return null!==t.pass},l.SASLXOAuth2.prototype.onChallenge=function(t){var e=\"\\0\";return null!==t.authcid&&(e+=t.authzid),e+=\"\\0\",s.default.utf16to8(e+=t.pass)},e.default={Strophe:l,$build:a,$iq:c,$msg:function(t){return new l.Builder(\"message\",t)},$pres:u,SHA1:o.default,MD5:r.default,b64_hmac_sha1:o.default.b64_hmac_sha1,b64_sha1:o.default.b64_sha1,str_hmac_sha1:o.default.str_hmac_sha1,str_sha1:o.default.str_sha1}},\"./src/md5.js\":function(t,e,n){\"use strict\";n.r(e),n.d(e,\"default\",function(){return h});var r=function(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n},o=function(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return e},s=function(t,e,n,o,s,i){return r((a=r(r(e,t),r(o,i)))<<(c=s)|a>>>32-c,n);var a,c},i=function(t,e,n,r,o,i,a){return s(e&n|~e&r,t,e,o,i,a)},a=function(t,e,n,r,o,i,a){return s(e&r|n&~r,t,e,o,i,a)},c=function(t,e,n,r,o,i,a){return s(e^n^r,t,e,o,i,a)},u=function(t,e,n,r,o,i,a){return s(n^(e|~r),t,e,o,i,a)},l=function(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var n,o,s,l,h=1732584193,d=-271733879,p=-1732584194,f=271733878,g=0;g<t.length;g+=16)h=i(n=h,o=d,s=p,l=f,t[g+0],7,-680876936),f=i(f,h,d,p,t[g+1],12,-389564586),p=i(p,f,h,d,t[g+2],17,606105819),d=i(d,p,f,h,t[g+3],22,-1044525330),h=i(h,d,p,f,t[g+4],7,-176418897),f=i(f,h,d,p,t[g+5],12,1200080426),p=i(p,f,h,d,t[g+6],17,-1473231341),d=i(d,p,f,h,t[g+7],22,-45705983),h=i(h,d,p,f,t[g+8],7,1770035416),f=i(f,h,d,p,t[g+9],12,-1958414417),p=i(p,f,h,d,t[g+10],17,-42063),d=i(d,p,f,h,t[g+11],22,-1990404162),h=i(h,d,p,f,t[g+12],7,1804603682),f=i(f,h,d,p,t[g+13],12,-40341101),p=i(p,f,h,d,t[g+14],17,-1502002290),d=i(d,p,f,h,t[g+15],22,1236535329),h=a(h,d,p,f,t[g+1],5,-165796510),f=a(f,h,d,p,t[g+6],9,-1069501632),p=a(p,f,h,d,t[g+11],14,643717713),d=a(d,p,f,h,t[g+0],20,-373897302),h=a(h,d,p,f,t[g+5],5,-701558691),f=a(f,h,d,p,t[g+10],9,38016083),p=a(p,f,h,d,t[g+15],14,-660478335),d=a(d,p,f,h,t[g+4],20,-405537848),h=a(h,d,p,f,t[g+9],5,568446438),f=a(f,h,d,p,t[g+14],9,-1019803690),p=a(p,f,h,d,t[g+3],14,-187363961),d=a(d,p,f,h,t[g+8],20,1163531501),h=a(h,d,p,f,t[g+13],5,-1444681467),f=a(f,h,d,p,t[g+2],9,-51403784),p=a(p,f,h,d,t[g+7],14,1735328473),d=a(d,p,f,h,t[g+12],20,-1926607734),h=c(h,d,p,f,t[g+5],4,-378558),f=c(f,h,d,p,t[g+8],11,-2022574463),p=c(p,f,h,d,t[g+11],16,1839030562),d=c(d,p,f,h,t[g+14],23,-35309556),h=c(h,d,p,f,t[g+1],4,-1530992060),f=c(f,h,d,p,t[g+4],11,1272893353),p=c(p,f,h,d,t[g+7],16,-155497632),d=c(d,p,f,h,t[g+10],23,-1094730640),h=c(h,d,p,f,t[g+13],4,681279174),f=c(f,h,d,p,t[g+0],11,-358537222),p=c(p,f,h,d,t[g+3],16,-722521979),d=c(d,p,f,h,t[g+6],23,76029189),h=c(h,d,p,f,t[g+9],4,-640364487),f=c(f,h,d,p,t[g+12],11,-421815835),p=c(p,f,h,d,t[g+15],16,530742520),d=c(d,p,f,h,t[g+2],23,-995338651),h=u(h,d,p,f,t[g+0],6,-198630844),f=u(f,h,d,p,t[g+7],10,1126891415),p=u(p,f,h,d,t[g+14],15,-1416354905),d=u(d,p,f,h,t[g+5],21,-57434055),h=u(h,d,p,f,t[g+12],6,1700485571),f=u(f,h,d,p,t[g+3],10,-1894986606),p=u(p,f,h,d,t[g+10],15,-1051523),d=u(d,p,f,h,t[g+1],21,-2054922799),h=u(h,d,p,f,t[g+8],6,1873313359),f=u(f,h,d,p,t[g+15],10,-30611744),p=u(p,f,h,d,t[g+6],15,-1560198380),d=u(d,p,f,h,t[g+13],21,1309151649),h=u(h,d,p,f,t[g+4],6,-145523070),f=u(f,h,d,p,t[g+11],10,-1120210379),p=u(p,f,h,d,t[g+2],15,718787259),d=u(d,p,f,h,t[g+9],21,-343485551),h=r(h,n),d=r(d,o),p=r(p,s),f=r(f,l);return[h,d,p,f]},h={hexdigest:function(t){return function(t){for(var e=\"0123456789abcdef\",n=\"\",r=0;r<4*t.length;r++)n+=e.charAt(t[r>>2]>>r%4*8+4&15)+e.charAt(t[r>>2]>>r%4*8&15);return n}(l(o(t),8*t.length))},hash:function(t){return function(t){for(var e=\"\",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>n%32&255);return e}(l(o(t),8*t.length))}}},\"./src/sha1.js\":function(t,e,n){\"use strict\";function r(t,e){t[e>>5]|=128<<24-e%32,t[15+(e+64>>9<<4)]=e;var n,r,s,c,u,l,h,d,p,f=new Array(80),g=1732584193,E=-271733879,m=-1732584194,_=271733878,T=-1009589776;for(n=0;n<t.length;n+=16){for(c=g,u=E,l=m,h=_,d=T,r=0;r<80;r++)f[r]=r<16?t[n+r]:a(f[r-3]^f[r-8]^f[r-14]^f[r-16],1),s=i(i(a(g,5),o(r,E,m,_)),i(i(T,f[r]),(p=r)<20?1518500249:p<40?1859775393:p<60?-1894007588:-899497514)),T=_,_=m,m=a(E,30),E=g,g=s;g=i(g,c),E=i(E,u),m=i(m,l),_=i(_,h),T=i(T,d)}return[g,E,m,_,T]}function o(t,e,n,r){return t<20?e&n|~e&r:t<40?e^n^r:t<60?e&n|e&r|n&r:e^n^r}function s(t,e){var n=c(t);16<n.length&&(n=r(n,8*t.length));for(var o=new Array(16),s=new Array(16),i=0;i<16;i++)o[i]=909522486^n[i],s[i]=1549556828^n[i];var a=r(o.concat(c(e)),512+8*e.length);return r(s.concat(a),672)}function i(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function a(t,e){return t<<e|t>>>32-e}function c(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<24-n%32;return e}function u(t){for(var e,n,r=\"\",o=0;o<4*t.length;o+=3)for(e=(t[o>>2]>>8*(3-o%4)&255)<<16|(t[o+1>>2]>>8*(3-(o+1)%4)&255)<<8|t[o+2>>2]>>8*(3-(o+2)%4)&255,n=0;n<4;n++)r+=8*o+6*n>32*t.length?\"=\":\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\".charAt(e>>6*(3-n)&63);return r}function l(t){for(var e=\"\",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>24-n%32&255);return e}n.r(e),n.d(e,\"default\",function(){return h});var h={b64_hmac_sha1:function(t,e){return u(s(t,e))},b64_sha1:function(t){return u(r(c(t),8*t.length))},binb2str:l,core_hmac_sha1:s,str_hmac_sha1:function(t,e){return l(s(t,e))},str_sha1:function(t){return l(r(c(t),8*t.length))}}},\"./src/strophe.js\":function(t,e,n){\"use strict\";n.r(e),n(\"./src/bosh.js\"),n(\"./src/websocket.js\");var r=n(\"./src/core.js\");n.d(e,\"default\",function(){return r.default})},\"./src/utils.js\":function(t,e,n){\"use strict\";function r(t){return(r=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t})(t)}n.r(e),n.d(e,\"default\",function(){return o});var o={utf16to8:function(t){var e,n,r=\"\",o=t.length;for(e=0;e<o;e++)0<=(n=t.charCodeAt(e))&&n<=127?r+=t.charAt(e):(2047<n?(r+=String.fromCharCode(224|n>>12&15),r+=String.fromCharCode(128|n>>6&63)):r+=String.fromCharCode(192|n>>6&31),r+=String.fromCharCode(128|n>>0&63));return r},addCookies:function(t){for(var e in t=t||{})if(Object.prototype.hasOwnProperty.call(t,e)){var n=\"\",o=\"\",s=\"\",i=t[e],a=\"object\"===r(i),c=escape(unescape(a?i.value:i));a&&(n=i.expires?\";expires=\"+i.expires:\"\",o=i.domain?\";domain=\"+i.domain:\"\",s=i.path?\";path=\"+i.path:\"\"),document.cookie=e+\"=\"+c+n+o+s}}}},\"./src/websocket.js\":function(t,e,n){\"use strict\";n.r(e);var r=n(\"./src/core.js\"),o=r.default.Strophe,s=r.default.$build;o.Websocket=function(t){this._conn=t,this.strip=\"wrapper\";var e=t.service;if(0!==e.indexOf(\"ws:\")&&0!==e.indexOf(\"wss:\")){var n=\"\";\"ws\"===t.options.protocol&&\"https:\"!==window.location.protocol?n+=\"ws\":n+=\"wss\",n+=\"://\"+window.location.host,0!==e.indexOf(\"/\")?n+=window.location.pathname+e:n+=e,t.service=n}},o.Websocket.prototype={_buildStream:function(){return s(\"open\",{xmlns:o.NS.FRAMING,to:this._conn.domain,version:\"1.0\"})},_check_streamerror:function(t,e){var n;if(0===(n=t.getElementsByTagNameNS?t.getElementsByTagNameNS(o.NS.STREAM,\"error\"):t.getElementsByTagName(\"stream:error\")).length)return!1;for(var r=n[0],s=\"\",i=\"\",a=0;a<r.childNodes.length;a++){var c=r.childNodes[a];if(\"urn:ietf:params:xml:ns:xmpp-streams\"!==c.getAttribute(\"xmlns\"))break;\"text\"===c.nodeName?i=c.textContent:s=c.nodeName}var u=\"WebSocket stream error: \";return u+=s||\"unknown\",i&&(u+=\" - \"+i),o.error(u),this._conn._changeConnectStatus(e,s),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,\"xmpp\"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(t){if(this._check_streamerror(t,o.Status.CONNFAIL))return o.Status.CONNFAIL},_handleStreamStart:function(t){var e=!1,n=t.getAttribute(\"xmlns\");\"string\"!=typeof n?e=\"Missing xmlns in <open />\":n!==o.NS.FRAMING&&(e=\"Wrong xmlns in <open />: \"+n);var r=t.getAttribute(\"version\");return\"string\"!=typeof r?e=\"Missing version in <open />\":\"1.0\"!==r&&(e=\"Wrong version in <open />: \"+r),!e||(this._conn._changeConnectStatus(o.Status.CONNFAIL,e),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(t){if(0===t.data.indexOf(\"<open \")||0===t.data.indexOf(\"<?xml\")){var e=t.data.replace(/^(<\\?.*?\\?>\\s*)*/,\"\");if(\"\"===e)return;var n=(new DOMParser).parseFromString(e,\"text/xml\").documentElement;this._conn.xmlInput(n),this._conn.rawInput(t.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===t.data.indexOf(\"<close \")){var r=(new DOMParser).parseFromString(t.data,\"text/xml\").documentElement;this._conn.xmlInput(r),this._conn.rawInput(t.data);var s=r.getAttribute(\"see-other-uri\");if(s){var i=this._conn.service;(0<=i.indexOf(\"wss:\")&&0<=s.indexOf(\"wss:\")||0<=i.indexOf(\"ws:\"))&&(this._conn._changeConnectStatus(o.Status.REDIRECT,\"Received see-other-uri, resetting connection\"),this._conn.reset(),this._conn.service=s,this._connect())}else this._conn._changeConnectStatus(o.Status.CONNFAIL,\"Received closing stream\"),this._conn._doDisconnect()}else{var a=this._streamWrap(t.data),c=(new DOMParser).parseFromString(a,\"text/xml\").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(c,null,t.data)}},_disconnect:function(t){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){t&&this._conn.send(t);var e=s(\"close\",{xmlns:o.NS.FRAMING});this._conn.xmlOutput(e.tree());var n=o.serialize(e);this._conn.rawOutput(n);try{this.socket.send(n)}catch(t){o.info(\"Couldn't send <close /> tag.\")}}this._conn._doDisconnect()},_doDisconnect:function(){o.info(\"WebSockets _doDisconnect was called\"),this._closeSocket()},_streamWrap:function(t){return\"<wrapper>\"+t+\"</wrapper>\"},_closeSocket:function(){if(this.socket)try{this.socket.onerror=null,this.socket.close()}catch(t){o.debug(t.message)}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(t){this._conn.connected&&!this._conn.disconnecting?(o.error(\"Websocket closed unexpectedly\"),this._conn._doDisconnect()):t&&1006===t.code&&!this._conn.connected&&this.socket?(o.error(\"Websocket closed unexcectedly\"),this._conn._changeConnectStatus(o.Status.CONNFAIL,\"The WebSocket connection could not be established or was disconnected.\"),this._conn._doDisconnect()):o.info(\"Websocket closed\")},_no_auth_received:function(t){o.error(\"Server did not offer a supported authentication mechanism\"),this._changeConnectStatus(o.Status.CONNFAIL,o.ErrorCondition.NO_AUTH_MECH),t&&t.call(this._conn),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(t){o.error(\"Websocket error \"+t),this._conn._changeConnectStatus(o.Status.CONNFAIL,\"The WebSocket connection could not be established or was disconnected.\"),this._disconnect()},_onIdle:function(){var t=this._conn._data;if(0<t.length&&!this._conn.paused){for(var e=0;e<t.length;e++)if(null!==t[e]){var n;n=\"restart\"===t[e]?this._buildStream().tree():t[e];var r=o.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(r),this.socket.send(r)}this._conn._data=[]}},_onMessage:function(t){var e,n='<close xmlns=\"urn:ietf:params:xml:ns:xmpp-framing\" />';if(t.data===n)return this._conn.rawInput(n),this._conn.xmlInput(t),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===t.data.search(\"<open \")){if(e=(new DOMParser).parseFromString(t.data,\"text/xml\").documentElement,!this._handleStreamStart(e))return}else{var r=this._streamWrap(t.data);e=(new DOMParser).parseFromString(r,\"text/xml\").documentElement}return this._check_streamerror(e,o.Status.ERROR)?void 0:this._conn.disconnecting&&\"presence\"===e.firstChild.nodeName&&\"unavailable\"===e.firstChild.getAttribute(\"type\")?(this._conn.xmlInput(e),void this._conn.rawInput(o.serialize(e))):void this._conn._dataRecv(e,t.data)},_onOpen:function(){o.info(\"Websocket open\");var t=this._buildStream();this._conn.xmlOutput(t.tree());var e=o.serialize(t);this._conn.rawOutput(e),this.socket.send(e)},_reqToData:function(t){return t},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}}}}).default},t.exports=r()},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(23),o=n(8),s=n(24),i=n(6),a=n(16),c=n(1),u=n(0),l=n(7),h=n(17),d=n(19),p=n(40),f=n(41),g=n(25),E=function(){function t(){}return t.trasformXMPPMessage=function(t){var e={};try{var n=JSON.parse(unescape(o.parseHTML(t.getElementsByTagName(\"body\")[0])).trim().toString());e=this.trasformJSONMessge(n)}catch(t){c.Logger.error(\"MessageController:transformXMPPMessage\",{e:t})}return e},t.trasformJSONMessge=function(t){var e;switch(t[u.MessageConstatnts.KEYS.CATEGORY]){case u.MessageConstatnts.CATEGORY.ACTION:e=h.Action.actionFromJSON(t);break;case u.MessageConstatnts.CATEGORY.CALL:e=d.Call.callFromJSON(t);break;case u.MessageConstatnts.CATEGORY.MESSAGE:switch(t[u.MessageConstatnts.KEYS.TYPE]){case u.MessageConstatnts.TYPE.TEXT:e=new r.TextMessage(t[u.MessageConstatnts.KEYS.RECEIVER],t[u.MessageConstatnts.KEYS.DATA][u.MessageConstatnts.KEYS.TEXT],t[u.MessageConstatnts.KEYS.TYPE],t[u.MessageConstatnts.KEYS.RECEIVER_TYPE]);break;case u.MessageConstatnts.TYPE.CUSTOM:e=new g.CustomMessage(t[u.MessageConstatnts.KEYS.RECEIVER],t[u.MessageConstatnts.KEYS.DATA][u.MessageConstatnts.KEYS.CUSTOM_DATA],t[u.MessageConstatnts.KEYS.RECEIVER_TYPE]);break;default:if(e=new s.MediaMessage(t[u.MessageConstatnts.KEYS.RECEIVER],t[u.MessageConstatnts.KEYS.DATA][u.MessageConstatnts.KEYS.URL],t[u.MessageConstatnts.KEYS.TYPE],t[u.MessageConstatnts.KEYS.RECEIVER_TYPE]),t.hasOwnProperty(u.MessageConstatnts.KEYS.DATA)){var n=t[u.MessageConstatnts.KEYS.DATA];if(n.hasOwnProperty(u.MessageConstatnts.KEYS.ATTATCHMENTS)){var o,i=n[u.MessageConstatnts.KEYS.ATTATCHMENTS];new Array,i.map(function(t){o=new f.Attachment(t)}),e.setAttachment(o)}n.hasOwnProperty(u.MessageConstatnts.KEYS.TEXT)&&e.setCaption(n[u.MessageConstatnts.KEYS.TEXT])}}break;default:c.Logger.log(\"MessageConroller:trasformJSONMessge\",\"Default case\")}t[u.MessageConstatnts.KEYS.RECEIPTS]&&(t[u.MessageConstatnts.KEYS.RECEIPTS]=t[u.MessageConstatnts.KEYS.RECEIPTS][u.MessageConstatnts.KEYS.DATA],t[u.MessageConstatnts.KEYS.RECEIPTS].map(function(e){var n=new p.MessageReceipt;e[u.DELIVERY_RECEIPTS.DELIVERED_AT]&&(n.setReceiptType(n.RECEIPT_TYPE.DELIVERY_RECEIPT),n.setSender(e[u.DELIVERY_RECEIPTS.RECIPIENT]),n.setReceiverType(t[u.MessageConstatnts.KEYS.RECEIVER_TYPE]),n.setReceiver(t[u.MessageConstatnts.KEYS.RECEIVER]))}));try{if(Object.assign(e,t),(t=e)instanceof r.TextMessage)t.setSender(t.getSender()),t.getData()[u.MessageConstatnts.KEYS.METADATA]&&t.setMetadata(t.getData()[u.MessageConstatnts.KEYS.METADATA]);else if(t instanceof s.MediaMessage)t.getData()[u.MessageConstatnts.KEYS.METADATA]&&t.setMetadata(t.getData()[u.MessageConstatnts.KEYS.METADATA]),t.setSender(t.getSender());else if(t instanceof h.Action)t.setSender(t.getSender()),t.setActionBy(t.getActionBy()),t.setActionOn(t.getActionOn()),t.setActionFor(t.getActionFor()),t.setMessage(t.getMessage());else if(t instanceof d.Call){try{t.setSender(t.getSender())}catch(e){c.Logger.error(\"MessageController:trasformJSONMessge:setSender\",e)}try{t.setCallInitiator(t.getCallInitiator())}catch(e){c.Logger.error(\"MessageController:trasformJSONMessge:setCallInitiator\",e)}try{t.setCallReceiver(t.getCallReceiver())}catch(e){c.Logger.error(\"MessageController:trasformJSONMessge:setCallreceiver\",e)}c.Logger.log(\"MessageController:transformJSONMessage\",t)}else t instanceof g.CustomMessage&&(t.getData()[u.MessageConstatnts.KEYS.METADATA]&&t.setMetadata(t.getData()[u.MessageConstatnts.KEYS.METADATA]),t.setSubType(t.getData()[u.MessageConstatnts.KEYS.CUSTOM_SUB_TYPE]),t.setSender(t.getSender()))}catch(e){c.Logger.error(\"MessageController:trasformJSONMessge:Main\",e),t=null}return t},t.getOfflineHistory=function(e,n){void 0===e&&(e=1e3),void 0===n&&(n=1),a.MessagesStore.getInstance();var r=[];i.makeApiCall(\"getMessages\",{},this.createData(e,n)).then(function(e){return c.isFalsy(e.data)||e.data.map(function(e){l.XMPPConnectionHelper.getInstance().trigerMessageHandler(e),r.push(t.trasformJSONMessge(e))}),!0})},t.getAllMessage=function(e,n,r,o){var s=this;void 0===e&&(e=100);var a=[];return new Promise(function(u,l){i.makeApiCall(\"getMessages\",{},s.createAllMessageData(e,n,r,o)).then(function(e){c.isFalsy(e.data)||(e.data.map(function(e){a.push(t.trasformJSONMessge(e))}),u(a))},function(t){c.Logger.error(\"Error on fetching all message\",t),u([])})})},t.createData=function(t,e){return void 0===e&&(e=0),{per_page:t,cursorValue:e,cursorField:u.MessageConstatnts.PAGINATION.CURSOR_FILEDS.ID,cursorAffix:c.isFalsy(e)?u.MessageConstatnts.PAGINATION.AFFIX.PREPEND:u.MessageConstatnts.PAGINATION.AFFIX.APPEND}},t.createAllMessageData=function(t,e,n,r){return{per_page:t,cursorValue:e,cursorField:n,cursorAffix:r}},t.isDeliveryReceipt=function(t){return!c.isFalsy(t.getElementsByTagName(u.DELIVERY_RECEIPTS.RECEIVED))},t.isReadRceipt=function(t){return!c.isFalsy(t.getElementsByTagName(u.READ_RECEIPTS.READ))},t.processDeliveryReceipt=function(t){return new Promise(function(e,n){var r=t.getElementsByTagName(u.DELIVERY_RECEIPTS.RECEIVED)[0],s=t.getElementsByTagName(u.DELIVERY_RECEIPTS.DELIVERED_AT)[0];l.XMPPConnectionHelper.getInstance().getUsersVCard(o.getUidFromJid(t.getAttribute(u.MessageConstatnts.XMPP_KEYS.FROM)),function(n){var i=new p.MessageReceipt;i.setSender(n),r.getAttribute(u.DELIVERY_RECEIPTS.RECEIVER_TYPE)==u.MessageConstatnts.RECEIVER_TYPE.GROUP?(i.setReceiverType(u.MessageConstatnts.RECEIVER_TYPE.GROUP),i.setReceiver(r.getAttribute(u.DELIVERY_RECEIPTS.RECEIVER_ID))):(i.setReceiverType(u.MessageConstatnts.RECEIVER_TYPE.USER),i.setReceiver(o.getUidFromJid(t.getAttribute(u.MessageConstatnts.XMPP_KEYS.TO)))),i.setReceiptType(i.RECEIPT_TYPE.DELIVERY_RECEIPT),i.setMessageId(o.getmessageIdFromStanzaId(r.getAttribute(u.DELIVERY_RECEIPTS.ID))),i.setTimestamp(s.getAttribute(u.DELIVERY_RECEIPTS.TIME)),e(i)})})},t.processReadReceipt=function(t){return new Promise(function(e,n){var r=t.getElementsByTagName(u.READ_RECEIPTS.READ)[0],s=t.getElementsByTagName(u.READ_RECEIPTS.READ_AT)[0];l.XMPPConnectionHelper.getInstance().getUsersVCard(o.getUidFromJid(t.getAttribute(u.MessageConstatnts.XMPP_KEYS.FROM)),function(n){var i=new p.MessageReceipt;i.setSender(n),r.getAttribute(u.READ_RECEIPTS.RECEIVER_TYPE)==u.MessageConstatnts.RECEIVER_TYPE.GROUP?(i.setReceiverType(u.MessageConstatnts.RECEIVER_TYPE.GROUP),i.setReceiver(r.getAttribute(u.READ_RECEIPTS.RECEIVER_ID))):(i.setReceiverType(u.MessageConstatnts.RECEIVER_TYPE.USER),i.setReceiver(o.getUidFromJid(t.getAttribute(u.MessageConstatnts.XMPP_KEYS.TO)))),i.setReceiptType(i.RECEIPT_TYPE.READ_RECEIPT),i.setMessageId(o.getmessageIdFromStanzaId(r.getAttribute(u.READ_RECEIPTS.ID))),i.setTimestamp(s.getAttribute(u.READ_RECEIPTS.TIME)),e(i)})})},t}();e.MessageController=E},function(t,e,n){\"use strict\";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,s){function i(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(i,a)}c((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},\"function\"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError(\"Generator is already executing.\");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(a){s=[6,a],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};e.__esModule=!0;var s=n(30),i=n(1),a=n(13),c=n(0),u=function(){function t(){}return t.executeInSync=function(t,e){var n=this;return new Promise(function(s,i){return r(n,void 0,void 0,function(){var n,r;return o(this,function(o){switch(o.label){case 0:return n=t,e?(r=setTimeout(function(){s(t)},this.SMALL_TIMEOUT),[4,e(t)]):[3,2];case 1:n=o.sent(),o.label=2;case 2:return clearTimeout(r),s(n),[2]}})})})},t.hookBeforeMessageSent=function(t){return r(this,void 0,void 0,function(){var e,n;return o(this,function(r){switch(r.label){case 0:e=0,r.label=1;case 1:return e<s.ExtensionManager.cometChatExtensionList.length?[4,this.getExtensionList()]:[3,7];case 2:if(!r.sent()[s.ExtensionManager.cometChatExtensionList[e].getExtensionId()])return[3,6];if(!s.ExtensionManager.cometChatExtensionList[e].beforeMessageSent)return[3,6];r.label=3;case 3:return r.trys.push([3,5,,6]),[4,this.executeInSync(t,s.ExtensionManager.cometChatExtensionList[e].beforeMessageSent)];case 4:return t=r.sent(),[3,6];case 5:return n=r.sent(),i.Logger.error(\"Logging error\",n),[3,6];case 6:return e++,[3,1];case 7:return[2,t]}})})},t.hookAfterMessageSent=function(t){return r(this,void 0,void 0,function(){var e,n;return o(this,function(r){switch(r.label){case 0:e=0,r.label=1;case 1:return e<s.ExtensionManager.cometChatExtensionList.length?[4,this.getExtensionList()]:[3,7];case 2:if(!r.sent()[s.ExtensionManager.cometChatExtensionList[e].getExtensionId()])return[3,6];if(!s.ExtensionManager.cometChatExtensionList[e].afterMessageSent)return[3,6];r.label=3;case 3:return r.trys.push([3,5,,6]),[4,this.executeInSync(t,s.ExtensionManager.cometChatExtensionList[e].afterMessageSent)];case 4:return t=r.sent(),[3,6];case 5:return n=r.sent(),i.Logger.error(\"Logging error\",n),[3,6];case 6:return e++,[3,1];case 7:return[2,t]}})})},t.hookOnInit=function(t,e){return r(this,void 0,void 0,function(){var n=this;return o(this,function(i){return s.ExtensionManager.cometChatExtensionList.map(function(s){return r(n,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,this.getExtensionList()];case 1:return n.sent()[s.getExtensionId()]?t&&e&&s.onInit?[4,s.onInit(t,e)]:[3,3]:[3,5];case 2:return n.sent(),[3,5];case 3:return t&&s.onInit?[4,s.onInit(t)]:[3,5];case 4:n.sent(),n.label=5;case 5:return[2]}})})}),[2]})})},t.hookOnMessageReceived=function(t){return r(this,void 0,void 0,function(){var e,n,r;return o(this,function(o){switch(o.label){case 0:e=a.MessageController.trasformJSONMessge(t),n=0,o.label=1;case 1:return n<s.ExtensionManager.cometChatExtensionList.length?[4,this.getExtensionList()]:[3,7];case 2:if(!o.sent()[s.ExtensionManager.cometChatExtensionList[n].getExtensionId()])return[3,6];if(!s.ExtensionManager.cometChatExtensionList[n].onMessageReceived)return[3,6];o.label=3;case 3:return o.trys.push([3,5,,6]),[4,this.executeInSync(e,s.ExtensionManager.cometChatExtensionList[n].onMessageReceived)];case 4:return t=o.sent(),[3,6];case 5:return r=o.sent(),i.Logger.error(\"Logging error\",r),[3,6];case 6:return n++,[3,1];case 7:return[2,t]}})})},t.hookOnLogin=function(t){return r(this,void 0,void 0,function(){var e=this;return o(this,function(n){return s.ExtensionManager.cometChatExtensionList.map(function(n){return r(e,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,this.getExtensionList()];case 1:return e.sent()[n.getExtensionId()]&&t&&n.onLogin?[4,n.onLogin(t)]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}),[2]})})},t.executeInSyncBulk=function(t,e){var n=this;return new Promise(function(s,i){return r(n,void 0,void 0,function(){var n,r;return o(this,function(o){switch(o.label){case 0:return n=t,e?(r=setTimeout(function(){s(t)},this.BIG_TIMEOUT),[4,e(t)]):[3,2];case 1:n=o.sent(),o.label=2;case 2:return clearTimeout(r),s(n),[2]}})})})},t.hookOnMessageListIsFetched=function(t){return r(this,void 0,void 0,function(){var e,n;return o(this,function(r){switch(r.label){case 0:e=0,r.label=1;case 1:return e<s.ExtensionManager.cometChatExtensionList.length?[4,this.getExtensionList()]:[3,7];case 2:if(!r.sent()[s.ExtensionManager.cometChatExtensionList[e].getExtensionId()])return[3,6];if(!s.ExtensionManager.cometChatExtensionList[e].onMessageListFetched)return[3,6];r.label=3;case 3:return r.trys.push([3,5,,6]),[4,this.executeInSyncBulk(t,s.ExtensionManager.cometChatExtensionList[e].onMessageListFetched)];case 4:return t=r.sent(),[3,6];case 5:return n=r.sent(),i.Logger.error(\"Logging error\",n),[3,6];case 6:return e++,[3,1];case 7:return[2,t]}})})},t.getExtensionList=function(){return r(this,void 0,void 0,function(){var t=this;return o(this,function(e){switch(e.label){case 0:return i.isFalsy(this.extentionList)?[4,i.getAppSettings()]:[3,2];case 1:e.sent()[c.APP_SETTINGS.KEYS.EXTENSION_LIST].map(function(e){t.extentionList[e.id]=e}),e.label=2;case 2:return[2,this.extentionList]}})})},t.SMALL_TIMEOUT=5e3,t.BIG_TIMEOUT=2e4,t.extentionList={},t}();e.ExtensionController=u},function(t,e,n){\"use strict\";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var s=n(1);e.MessageEventListener=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.onAction=void 0,this.onTextMessageReceived=void 0,this.onMediaMessageReceived=void 0,this.onCustomMessageReceived=void 0,this.onCall=void 0,this.onTypingStarted=void 0,this.onTypingEnded=void 0,this.onMessageDelivered=void 0,this.onMessageRead=void 0,s.isFalsy(t[0].onAction)||(this.onAction=t[0].onAction),s.isFalsy(t[0].onTextMessageReceived)||(this.onTextMessageReceived=t[0].onTextMessageReceived),s.isFalsy(t[0].onMediaMessageReceived)||(this.onMediaMessageReceived=t[0].onMediaMessageReceived),s.isFalsy(t[0].onCall)||(this.onCall=t[0].onCall),s.isFalsy(t[0].onTypingStarted)||(this.onTypingStarted=t[0].onTypingStarted),s.isFalsy(t[0].onTypingEnded)||(this.onTypingEnded=t[0].onTypingEnded),s.isFalsy(t[0].onMessageDelivered)||(this.onMessageDelivered=t[0].onMessageDelivered),s.isFalsy(t[0].onMessageRead)||(this.onMessageRead=t[0].onMessageRead),s.isFalsy(t[0].onCustomMessageReceived)||(this.onCustomMessageReceived=t[0].onCustomMessageReceived)},e.CallEventListener=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.onIncomingCallReceived=void 0,this.onOutgoingCallAccepted=void 0,this.onOutgoingCallRejected=void 0,this.onIncomingCallCancelled=void 0,s.isFalsy(t[0].onIncomingCallReceived)||(this.onIncomingCallReceived=t[0].onIncomingCallReceived),s.isFalsy(t[0].onOutgoingCallAccepted)||(this.onOutgoingCallAccepted=t[0].onOutgoingCallAccepted),s.isFalsy(t[0].onOutgoingCallRejected)||(this.onOutgoingCallRejected=t[0].onOutgoingCallRejected),s.isFalsy(t[0].onIncomingCallCancelled)||(this.onIncomingCallCancelled=t[0].onIncomingCallCancelled)},e.UserEventListener=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];s.isFalsy(t[0].onUserOnline)||(this.onUserOnline=t[0].onUserOnline),s.isFalsy(t[0].onUserOffline)||(this.onUserOffline=t[0].onUserOffline)},e.GroupEventListener=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];s.isFalsy(t[0].onGroupMemberJoined)||(this.onUserJoined=t[0].onGroupMemberJoined),s.isFalsy(t[0].onGroupMemberLeft)||(this.onUserLeft=t[0].onGroupMemberLeft),s.isFalsy(t[0].onGroupMemberKicked)||(this.onUserKicked=t[0].onGroupMemberKicked),s.isFalsy(t[0].onGroupMemberBanned)||(this.onUserBanned=t[0].onGroupMemberBanned),s.isFalsy(t[0].onGroupMemberUnbanned)||(this.onUserUnbanned=t[0].onGroupMemberUnbanned),s.isFalsy(t[0].onGroupMemberScopeChanged)||(this.onMemberScopeChanged=t[0].onGroupMemberScopeChanged)},e.UserCallEventListener=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];s.isFalsy(t[0].onYouLeft)||(this.onYouLeft=t[0].onYouLeft),s.isFalsy(t[0].onYouJoined)||(this.onYouJoined=t[0].onYouJoined),s.isFalsy(t[0].onUserJoined)||(this.onUserJoined=t[0].onUserJoined),s.isFalsy(t[0].onUserLeft)||(this.onUserLeft=t[0].onUserLeft),s.isFalsy(t[0].onCallEnded)||(this.onCallEnded=t[0].onCallEnded),s.isFalsy(t[0].onError)||(this.onError=t[0].onError)};var i=function(t,e){this._name=t,this._callback=e},a=function(t){function e(e,n,r,o){var s=t.call(this,e,o)||this;return s._eventListener=n,r&&(s._cursor=r),s}return o(e,t),e}(e.Listener=i);e.MessageListener=a;var c=function(t){function e(e,n,r,o){var s=t.call(this,e,o)||this;return s._eventListener=n,r&&(s._cursor=r),s}return o(e,t),e}(i);e.UserListener=c;var u=function(t){function e(e,n,r,o){var s=t.call(this,e,o)||this;return s._eventListener=n,r&&(s._cursor=r),s}return o(e,t),e}(i);e.GroupListener=u;var l=function(t){function e(e,n,r){var o=t.call(this,\"callListner\",r)||this;return o._eventListener=e,o}return o(e,t),e}(i);e.UserCallListener=l;var h=function(t){function e(e,n,r,o){var s=t.call(this,e,o)||this;return s._eventListener=n,s}return o(e,t),e}(i);e.CallListener=h},function(t,e,n){\"use strict\";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};e.__esModule=!0;var o=n(2),s=n(1),i=n(0),a=n(10),c=function(){function t(t){if(this.store=i.constants.DEFAULT_STORE,o.CometChat.isNative)try{this.messagesStore=n(11).AsyncStorage}catch(t){}else s.isFalsy(t)||(this.store=t),this.messagesStore=a.createInstance({name:s.format(i.LOCAL_STORE.STORE_STRING,o.CometChat.getAppId(),i.LOCAL_STORE.MESSAGES_STORE)}),this.messagesStore.setDriver([a.LOCALSTORAGE,a.INDEXEDDB,a.WEBSQL])}return t.getInstance=function(){return null==t.MessagesStore&&(t.MessagesStore=new t),t.MessagesStore},t.prototype.set=function(t,e){return this.messagesStore.setItem(t,e)},t.prototype.remove=function(t){this.messagesStore.removeItem(t)},t.prototype.get=function(t){return this.messagesStore.getItem(t)},t.prototype.clearStore=function(){return this.messagesStore.clear()},t.prototype.getAllMessages=function(){var t=this,e={};return new Promise(function(n,o){t.messagesStore.iterate(function(t,n,o){n!=i.constants.MSG_VER_POST&&n!=i.constants.MSG_VER_POST&&(e=r({},e,t))}).then(function(){n(e)})})},t.prototype.clear=function(t){},t.prototype.selectStore=function(t){this.store=t},t.prototype.storeMessages=function(t){var e=this;if(o.CometChat.user.getUid()){var n=o.CometChat.user.getUid(),a={},c=0;return this.get(i.constants.MSG_VER_POST).then(function(o){t.map(function(t){var e;if(!s.isFalsy(t)){0==c&&(c=parseInt(t.getId().toString())),c>t.getId()&&(c=parseInt(t.getId().toString())),o<t.getId()&&(o=parseInt(t.getId().toString()));var u=void 0;u=t.getSender()instanceof Object?t.getSender().getUid():t.getSender(),t.getReceiverType()==i.MessageConstatnts.RECEIVER_TYPE.GROUP&&(u=t.getReceiver()),t.getSender()instanceof Object?t.getSender().getUid()==n&&(u=t.getReceiver()):t.getSender()==n&&(u=t.getReceiver()),a[u]||(a[u]={}),a[u]=r({},a[u],((e={})[t.getId()]=t,e))}}),e.get(i.constants.MSG_VER_PRE).then(function(t){(0<c&&c<t||null==t)&&e.set(i.constants.MSG_VER_PRE,c)})&&0<o&&e.set(i.constants.MSG_VER_POST,o),Object.keys(a).map(function(t){e.get(t).then(function(n){null==n&&(n={}),e.set(t,r({},a[t],n))})})}),!0}},t}();e.MessagesStore=c},function(t,e,n){\"use strict\";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};e.__esModule=!0;var i=n(9),a=n(18),c=n(3),u=n(0),l=n(1),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.actionFromJSON=function(t){var e=new this(t[u.MessageConstatnts.KEYS.RECEIVER],t[u.MessageConstatnts.KEYS.TYPE],t[u.MessageConstatnts.KEYS.RECEIVER_TYPE],u.MessageCategory.ACTION),n=t[u.MessageConstatnts.KEYS.DATA];if(e.data=n,e.setAction(n[u.MessageConstatnts.KEYS.ACTION]),n[u.MessageConstatnts.KEYS.METADATA]&&e.setMetadata(n[u.MessageConstatnts.KEYS.METADATA]),n[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY])if(n[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][u.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==u.ActionConstatnts.ACTION_ENTITY_TYPE.USER){var r=new c.User(n[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][u.ActionConstatnts.ACTION_KEYS.ENTITY]);Object.assign(r,n[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][u.ActionConstatnts.ACTION_KEYS.ENTITY]),e.actionBy=r,e.setSender(r)}else{var o=new a.Group(\"\",\"\",\"\");Object.assign(o,n[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][u.ActionConstatnts.ACTION_KEYS.ENTITY]),e.actionBy=o}return n[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR]&&(n[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][u.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==u.ActionConstatnts.ACTION_ENTITY_TYPE.USER?(r=new c.User(n[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][u.ActionConstatnts.ACTION_KEYS.ENTITY]),Object.assign(r,n[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][u.ActionConstatnts.ACTION_KEYS.ENTITY]),e.actionFor=r):(o=new a.Group(\"\",\"\",\"\"),Object.assign(o,n[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][u.ActionConstatnts.ACTION_KEYS.ENTITY]),e.actionFor=o)),n[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON]&&(n[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][u.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==u.ActionConstatnts.ACTION_ENTITY_TYPE.USER?(r=new c.User(n[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][u.ActionConstatnts.ACTION_KEYS.ENTITY]),Object.assign(r,n[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][u.ActionConstatnts.ACTION_KEYS.ENTITY]),e.actionOn=r):(o=new a.Group(\"\",\"\",\"\"),Object.assign(o,n[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][u.ActionConstatnts.ACTION_KEYS.ENTITY]),e.actionOn=o)),e.setMessage(e.getActionMessage(e)),e},e.prototype.setRawData=function(t){this.rawData=t},e.prototype.getRawData=function(){return this.rawData},e.prototype.setMessage=function(t){this.message=t},e.prototype.getMessage=function(){return this.message},e.prototype.setAction=function(t){this.action=t},e.prototype.getAction=function(){return this.action},e.prototype.getSender=function(){return this.getSenderFromData()},e.prototype.setActionBy=function(t){this.actionBy=t},e.prototype.getActionBy=function(){return this.actionBy},e.prototype.setActionOn=function(t){this.actionOn=t},e.prototype.getActionOn=function(){return this.actionOn},e.prototype.setActionFor=function(t){this.actionFor=t},e.prototype.getActionFor=function(){return this.actionFor},e.prototype.getMetadata=function(){return this.data.metadata&&(this.metadata=this.data.metadata),this.metadata},e.prototype.setMetadata=function(t){this.metadata=t,this.data=s({},this.data,{metadata:t})},e.prototype.getActionMessage=function(t){var e=\"\";switch(t.getType()){case u.ActionConstatnts.ACTION_KEYS.ACTION_TYPE_USER:case u.ActionConstatnts.ACTION_KEYS.ACTION_TYPE_GROUP:t.getAction();break;case u.ActionConstatnts.ACTION_KEYS.ACTION_TYPE_GROUP_MEMBER:switch(t.getAction()){case u.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_JOINED:var n=t.getActionBy(),r=t.getActionFor();e=l.format(u.ActionConstatnts.ActionMessages.ACTION_GROUP_JOINED_MESSAGE,n.getName(),r.getName());break;case u.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_LEFT:n=t.getActionBy(),r=t.getActionFor(),e=l.format(u.ActionConstatnts.ActionMessages.ACTION_GROUP_LEFT_MESSAGE,n.getName(),r.getName());break;case u.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_KICKED:n=t.getActionBy(),r=t.getActionFor();var o=t.getActionOn();e=l.format(u.ActionConstatnts.ActionMessages.ACTION_MEMBER_KICKED_MESSAGE,n.getName(),o,r.getName());break;case u.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_BANNED:n=t.getActionBy(),r=t.getActionFor(),o=t.getActionOn(),e=l.format(u.ActionConstatnts.ActionMessages.ACTION_MEMBER_BANNED_MESSAGE,n.getName(),r.getName());break;case u.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_UNBANNED:n=t.getActionBy(),r=t.getActionFor(),o=t.getActionOn(),e=l.format(u.ActionConstatnts.ActionMessages.ACTION_MEMBER_UNBANNED_MESSAGE,n.getName(),r.getName())}}return e},e.prototype.getSenderFromData=function(){var t=this.data;if(t[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY]&&t[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][u.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==u.ActionConstatnts.ACTION_ENTITY_TYPE.USER){var e=new c.User(t[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][u.ActionConstatnts.ACTION_KEYS.ENTITY]);return Object.assign(e,t[u.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][u.ActionConstatnts.ACTION_KEYS.ENTITY]),e}},e.TYPE=u.MessageConstatnts.TYPE,e.RECEIVER_TYPE=u.MessageConstatnts.RECEIVER_TYPE,e.CATEGORY=u.MessageConstatnts.CATEGORY,e.ACTION_TYPE=u.ActionConstatnts.ACTION_TYPE,e}(i.BaseMessage);e.Action=h},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(0),o=function(){function t(t,e,n,r,o,s,i){this.hasJoined=!1,this.guid=t,this.name=e,this.type=n,r&&(this.password=r),o&&(this.icon=o),s&&(this.description=s),i&&(this.hasJoined=i)}return t.prototype.getGuid=function(){return this.guid},t.prototype.setGuid=function(t){this.guid=t},t.prototype.getName=function(){return this.name},t.prototype.setName=function(t){this.name=t},t.prototype.getType=function(){return this.type},t.prototype.setType=function(t){this.type=t},t.prototype.setPassword=function(t){this.password=t},t.prototype.getIcon=function(){return this.icon},t.prototype.setIcon=function(t){this.icon=t},t.prototype.getDescription=function(){return this.description},t.prototype.setDescription=function(t){this.description=t},t.prototype.getOwner=function(){return this.owner},t.prototype.setOwner=function(t){this.owner=t},t.prototype.getMetadata=function(){return this.metadata},t.prototype.setMetadata=function(t){this.metadata=t},t.prototype.getCreatedAt=function(){return this.createdAt},t.prototype.setCreatedAt=function(t){this.createdAt=t},t.prototype.getUpdatedAt=function(){return this.updatedAt},t.prototype.setUpdatedAt=function(t){this.updatedAt=t},t.prototype.getHasJoined=function(){return this.hasJoined},t.prototype.setHasJoined=function(t){this.hasJoined=t},t.prototype.getWsChannel=function(){return this.wsChannel},t.prototype.setWsChannel=function(t){this.wsChannel=t},t.prototype.setScope=function(t){this.scope=t},t.prototype.getScope=function(){return this.scope},t.prototype.getJoinedAt=function(){return this.joinedAt},t.prototype.setJoinedAt=function(t){this.joinedAt=t},t.Type=t.TYPE=r.GroupType,t}();e.Group=o},function(t,e,n){\"use strict\";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};e.__esModule=!0;var i=n(9),a=n(0),c=n(1),u=n(3),l=function(t){function e(e,n,r,o){return c.isFalsy(o)?t.call(this,e,n,r,a.MessageCategory.CALL)||this:t.call(this,e,n,r,o)||this}return o(e,t),e.prototype.getCallInitiator=function(){return this.getCallInitiatedByFromData()},e.prototype.getCallReceiver=function(){return this.getCallReceivedByFromData()},e.prototype.setCallInitiator=function(t){this.callInitiator=t},e.prototype.setCallReceiver=function(t){this.callReceiver=t},e.prototype.getData=function(){return this.data},e.prototype.setData=function(t){this.data=t},e.prototype.getSessionId=function(){return this.sessionId},e.prototype.setSessionId=function(t){this.sessionId=t},e.prototype.getMetadata=function(){return this.data.metadata&&(this.metadata=this.data.metadata),this.metadata},e.prototype.getSender=function(){return this.getSenderFromData()},e.prototype.setMetadata=function(t){this.metadata=t,this.data=s({},this.data,{metadata:t})},e.prototype.getAction=function(){return this.action},e.prototype.setAction=function(t){this.action=t},e.prototype.getInitiatedAt=function(){return this.initiatedAt},e.prototype.setInitiatedAt=function(t){this.initiatedAt=t},e.prototype.getJoinedAt=function(){return this.joinedAt},e.prototype.setJoinedAt=function(t){this.joinedAt=t},e.prototype.setRawData=function(t){this.rawData=t},e.prototype.getRawData=function(){return this.rawData},e.prototype.setSender=function(t){this.sender=t},e.callFromJSON=function(t){var e=new this(t[a.MessageConstatnts.KEYS.RECEIVER],t[a.MessageConstatnts.KEYS.TYPE],t[a.MessageConstatnts.KEYS.RECEIVER_TYPE],a.MessageCategory.CALL),n=t[a.MessageConstatnts.KEYS.DATA];if(e.setAction(n[a.MessageConstatnts.KEYS.ACTION]),n[a.MessageConstatnts.KEYS.METADATA]&&e.setMetadata(n[a.MessageConstatnts.KEYS.METADATA]),n[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON]){var r=n[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON];if(r[a.CallConstants.CALL_KEYS.CALL_ENTITY]){var o=r[a.CallConstants.CALL_KEYS.CALL_ENTITY];if(o[a.CallConstants.CALL_KEYS.CALL_SESSION_ID]&&(e.sessionId=o[a.CallConstants.CALL_KEYS.CALL_SESSION_ID]),o[a.CallConstants.CALL_KEYS.CALL_STATUS]&&(e.status=o[a.CallConstants.CALL_KEYS.CALL_STATUS]),o[a.CallConstants.CALL_KEYS.CALL_DATA]){var s=o[a.CallConstants.CALL_KEYS.CALL_DATA];s[a.CallConstants.CALL_KEYS.CALL_METADATA]&&(e.metadata=s[a.CallConstants.CALL_KEYS.CALL_METADATA])}o[a.CallConstants.CALL_KEYS.CALL_INITIATED_AT]&&(e.initiatedAt=o[a.CallConstants.CALL_KEYS.CALL_INITIATED_AT]),o[a.CallConstants.CALL_KEYS.CALL_JOINED_AT]&&(e.joinedAt=o[a.CallConstants.CALL_KEYS.CALL_JOINED_AT]),o[a.CallConstants.CALL_KEYS.CALL_LEFT_AT]&&(e.joinedAt=o[a.CallConstants.CALL_KEYS.CALL_LEFT_AT])}}return e},e.prototype.getSenderFromData=function(){var t=this.getData();if(t[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][a.CallConstants.CALL_KEYS.CALL_ENTITY])return new u.User(t[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][a.CallConstants.CALL_KEYS.CALL_ENTITY])},e.prototype.getCallInitiatedByFromData=function(){var t=this.getData();if(t[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][a.CallConstants.CALL_KEYS.CALL_ENTITY][a.CallConstants.CALL_KEYS.CALL_DATA][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.CallConstants.CALL_KEYS.CALL_SENDER])return new u.User(t[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][a.CallConstants.CALL_KEYS.CALL_ENTITY][a.CallConstants.CALL_KEYS.CALL_DATA][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.CallConstants.CALL_KEYS.CALL_SENDER][a.CallConstants.CALL_KEYS.CALL_ENTITY])},e.prototype.getCallReceivedByFromData=function(){var t=this.getData();if(t[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][a.CallConstants.CALL_KEYS.CALL_ENTITY][a.CallConstants.CALL_KEYS.CALL_DATA][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.CallConstants.CALL_KEYS.CALL_SENDER])return new u.User(t[a.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][a.CallConstants.CALL_KEYS.CALL_ENTITY][a.CallConstants.CALL_KEYS.CALL_DATA][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.CallConstants.CALL_KEYS.CALL_RECEIVER][a.CallConstants.CALL_KEYS.CALL_ENTITY])},e.TYPE=a.MessageConstatnts.TYPE,e.RECEIVER_TYPE=a.MessageConstatnts.RECEIVER_TYPE,e.CATEGORY=a.MessageConstatnts.CATEGORY,e.ACTION_TYPE=a.ActionConstatnts.ACTION_TYPE,e}(i.BaseMessage);e.Call=l},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(1),o=n(0),s=n(10),i=n(2),a=function(){function t(t){if(this.store=o.constants.DEFAULT_STORE,i.CometChat.isNative)try{this.settingsStore=n(11).AsyncStorage}catch(t){}else r.isFalsy(t)||(this.store=t),this.settingsStore=s.createInstance({name:r.format(o.LOCAL_STORE.STORE_STRING,i.CometChat.getAppId(),o.LOCAL_STORE.MESSAGE_LISTENERS_LIST)}),this.settingsStore.setDriver([s.LOCALSTORAGE,s.INDEXEDDB,s.WEBSQL])}return t.getInstance=function(){return null==t.settingsStore&&(t.settingsStore=new t),t.settingsStore},t.prototype.set=function(t,e){return this.settingsStore.setItem(t,e)},t.prototype.remove=function(t){this.settingsStore.removeItem(t)},t.prototype.get=function(t){return this.settingsStore.getItem(t)},t.prototype.clearStore=function(){return this.settingsStore.clear()},t.prototype.clear=function(t){},t.prototype.selectStore=function(t){this.store=t},t.settingsStore=null,t}();e.MessageListnerMaping=a},function(t,e){var n;n=function(){return this}();try{n=n||new Function(\"return this\")()}catch(t){\"object\"==typeof window&&(n=window)}t.exports=n},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(1),o=n(0),s=n(5),i=function(){function t(){this.baseUrl=\"https://kohoutek.cometchat.com/\",this.apiVersion=\"v1.3\",this.apiBaseUrl=this.baseUrl+this.apiVersion+\"/\",this.adminApiUrl=\"https://api.cometchat.com/\",this.adminApiVersion=\"v1.3\",this.uriEndpoints={authToken:{endpoint:\"users/{{uid}}/auth_tokens\",method:\"POST\",data:{uid:\"string|max:100\"},isAdminApi:!0},appSettings:{endpoint:\"settings\",method:\"GET\"},login:{endpoint:\"admin/users/auth\",method:\"POST\",data:{uid:\"string|max:100\"}},logout:{endpoint:\"admin/users/auth/{{authToken}}\",method:\"DELETE\"},getMyDetails:{endpoint:\"me\",method:\"GET\"},updateMyDetails:{endpoint:\"/me\",method:\"PUT\"},users:{endpoint:\"users\",method:\"GET\"},user:{endpoint:\"users/{{uid}}\",method:\"GET\"},userLogout:{endpoint:\"me\",method:\"DELETE\"},sendFriendRequests:{endpoint:\"user/friends\",method:\"POST\",data:{uids:\"array<string|max:100>\"}},getFriends:{endpoint:\"user/friends\",method:\"GET\"},unfriend:{endpoint:\"user/friends/{{uid}}/{{gid}}\",method:\"DELETE\",data:{uids:\"array<string|max:100>\"}},acceptFriendRequest:{endpoint:\"user/friends/{{uid}}/accept\",method:\"PUT\",data:{uids:\"array<string|max:100>\"}},rejectFriendRequest:{endpoint:\"user/friends/{{uid}}/reject\",method:\"DELETE\",data:{uids:\"array<string|max:100>\"}},createGroup:{endpoint:\"groups\",method:\"POST\",data:{guid:\"required|string|max:100\",name:\"required|string|max:100\",type:\"enum|public,protected,password\",password:\"filled|string|max:100\"}},getGroups:{endpoint:\"groups\",method:\"GET\"},getGroup:{endpoint:\"groups/{{guid}}\",method:\"GET\"},updateGroup:{endpoint:\"groups/{{guid}}\",method:\"PUT\"},deleteGroup:{endpoint:\"groups/{{guid}}\",method:\"DELETE\"},addGroupMembers:{endpoint:\"groups/{{guid}}/members\",method:\"POST\",data:{uids:\"array<string|max:100>\"}},getGroupMembers:{endpoint:\"groups/{{guid}}/members\",method:\"GET\"},joinGroup:{endpoint:\"groups/{{guid}}/members\",method:\"POST\"},leaveGroup:{endpoint:\"groups/{{guid}}/members\",method:\"DELETE\"},kickGroupMembers:{endpoint:\"groups/{{guid}}/members/{{uid}}\",method:\"DELETE\",data:{uids:\"array<string|max:100>\"}},changeScopeOfMember:{endpoint:\"groups/{{guid}}/members/{{uid}}\",method:\"PUT\",data:{uids:\"array<string|max:100>\"}},banGroupMember:{endpoint:\"groups/{{guid}}/bannedusers/{{uid}}\",method:\"POST\",data:{uids:\"array<string|max:100>\"}},unbanGroupMember:{endpoint:\"groups/{{guid}}/bannedusers/{{uid}}\",method:\"DELETE\",data:{uids:\"array<string|max:100>\"}},addMemebersToGroup:{endpoint:\"groups/{{guid}}/members\",method:\"PUT\"},getBannedGroupMembers:{endpoint:\"groups/{{guid}}/bannedusers\",method:\"GET\"},promotemoteGroupMember:{endpoint:\"groups/{{guid}}/promote\",method:\"PUT\",data:{uids:\"array<string|max:100>\"}},demoteGroupMember:{endpoint:\"groups/{{guid}}/demote\",method:\"DELETE\",data:{uids:\"array<string|max:100>\"}},sendMessage:{endpoint:\"messages\",method:\"POST\",data:{sender:\"array:string:max:100>\",isGroupMember:\"filled|boolean|bail\",data:\"required|json\"}},getMessages:{endpoint:\"messages\",method:\"GET\"},getMessageDetails:{endpoint:\"messages/{{messageId}}\",method:\"GET\"},getUserMessages:{endpoint:\"users/{{listId}}/messages\",method:\"GET\"},getGroupMessages:{endpoint:\"groups/{{listId}}/messages\",method:\"GET\"},getMessage:{endpoint:\"user/messages/{{muid}}\",method:\"GET\"},updateMessage:{endpoint:\"user/messages/{{muid}}\",method:\"PUT\",data:{data:\"required|json\"}},deleteMessage:{endpoint:\"user/messages/{{muid}}\",method:\"DELETE\"},createCallSession:{endpoint:\"calls\",method:\"POST\",data:{}},updateCallSession:{endpoint:\"calls/{{sessionid}}\",method:\"put\",data:{}}}}return t.prototype.getEndpointData=function(t){var e=this;return new Promise(function(n,i){s.LocalStorage.getInstance().get(o.APP_SETTINGS.APP_SETTINGS).then(function(s){if(r.isFalsy(s)){var i=void 0;if(e.uriEndpoints.hasOwnProperty(t))if((i=e.uriEndpoints[t]).hasOwnProperty(\"isAdminApi\")){var a=e.adminApiUrl+e.adminApiVersion+\"/\"+i.endpoint;i.endpoint=a}else a=i.endpoint=e.baseUrl+e.apiVersion+\"/\"+i.endpoint,i.endpoint=a;n(i)}else i=void 0,e.uriEndpoints.hasOwnProperty(t)&&(i.endpoint=(i=e.uriEndpoints[t]).hasOwnProperty(\"isAdminApi\")?\"https://\"+s[o.APP_SETTINGS.KEYS.ADMIN_API_HOST]+\"/\"+e.adminApiVersion+\"/\"+i.endpoint:\"https://\"+s[o.APP_SETTINGS.KEYS.CLIENT_API_HOST]+\"/\"+e.apiVersion+\"/\"+i.endpoint),n(i)},function(r){var o;e.uriEndpoints.hasOwnProperty(t)&&(o.endpoint=(o=e.uriEndpoints[t]).hasOwnProperty([\"isAdminApi\"])?e.adminApiUrl+e.adminApiVersion+\"/\"+o.endpoint:e.baseUrl+e.apiVersion+\"/\"+o.endpoint),n(o)})})},t}();e.EndpointFactory=i},function(t,e,n){\"use strict\";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};e.__esModule=!0;var i=n(9),a=n(0),c=n(3),u=function(t){function e(e,n,r,o){var s=t.call(this,e,r,o,a.MessageCategory.MESSAGE)||this;switch(r){case\"text\":s.data={text:n},s.text=n}return s}return o(e,t),e.prototype.getSender=function(){return this.getSenderFromData()},e.prototype.getMetadata=function(){return this.data.metadata&&(this.metadata=this.data.metadata),this.metadata},e.prototype.setMetadata=function(t){this.metadata=t,this.data=s({},this.data,{metadata:t})},e.prototype.getData=function(){return this.data},e.prototype.setData=function(t){this.data=t},e.prototype.getText=function(){return this.text},e.prototype.setText=function(t){this.text=t,this.data.text=t},e.prototype.setProcessedText=function(t){this.processedText=t},e.prototype.getProcessedText=function(){return this.processedText},e.prototype.getSenderFromData=function(){var t=this.getData();if(t[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])return new c.User(t[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])},e.TYPE=a.MessageConstatnts.TYPE.TEXT,e.RECEIVER_TYPE=a.MessageConstatnts.RECEIVER_TYPE,e.CATEGORY=a.MessageConstatnts.CATEGORY.MESSAGE,e}(i.BaseMessage);e.TextMessage=u},function(t,e,n){\"use strict\";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};e.__esModule=!0;var i=n(9),a=n(0),c=n(3),u=function(t){function e(e,n,r,o){var s=t.call(this,e,r,o,a.MessageCategory.MESSAGE)||this;return s.data={url:n instanceof File?void 0:n},(s.file=n)instanceof File||(s.url=n),s}return o(e,t),e.prototype.setCaption=function(t){this.caption=t,this.data[a.MessageConstatnts.KEYS.TEXT]=t},e.prototype.getCaption=function(){return this.data[a.MessageConstatnts.KEYS.TEXT]},e.prototype.getSender=function(){return this.getSenderFromData()},e.prototype.getUrl=function(){return this.url},e.prototype.setUrl=function(t){this.url=t},e.prototype.getMetadata=function(){return this.data.metadata&&(this.metadata=this.data.metadata),this.metadata},e.prototype.setMetadata=function(t){this.metadata=t,this.data=s({},this.data,{metadata:t})},e.prototype.getData=function(){return this.data},e.prototype.setData=function(t){this.data=t},e.prototype.getAttachment=function(){return this.attachment},e.prototype.setAttachment=function(t){this.attachment=t},e.prototype.getSenderFromData=function(){var t=this.getData();if(t[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])return new c.User(t[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])},e.TYPE=a.MessageConstatnts.TYPE,e.RECEIVER_TYPE=a.MessageConstatnts.RECEIVER_TYPE,e.CATEGORY=a.MessageConstatnts.CATEGORY,e}(i.BaseMessage);e.MediaMessage=u},function(t,e,n){\"use strict\";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};e.__esModule=!0;var i=n(9),a=n(0),c=n(3),u=n(1),l=function(t){function e(e,n,r){var o=t.call(this,e,a.MessageConstatnts.TYPE.CUSTOM,r,a.MessageCategory.MESSAGE)||this;return o.customData=n,u.isFalsy(o.data)&&(o.data={}),o.data[a.MessageConstatnts.KEYS.CUSTOM_DATA]=n,o}return o(e,t),e.prototype.getCustomData=function(){return this.customData},e.prototype.setCustomData=function(t){this.customData=t,this.data[a.MessageConstatnts.KEYS.CUSTOM_DATA]=t},e.prototype.getSender=function(){return this.getSenderFromData()},e.prototype.getSubType=function(){return this.subType},e.prototype.setSubType=function(t){this.subType=t,this.data=s({},this.data,{subType:t})},e.prototype.getMetadata=function(){return this.metadata},e.prototype.setMetadata=function(t){this.metadata=t,this.data=s({},this.data,{metadata:t})},e.prototype.getData=function(){return this.data},e.prototype.getSenderFromData=function(){var t=this.getData();if(t[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])return new c.User(t[a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][a.MessageConstatnts.KEYS.SENDER][a.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])},e}(i.BaseMessage);e.CustomMessage=l},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(42),o=n(0),s=function(){function t(){}return t.transformPresence=function(t){return t.getAttribute(\"type\")?new r.UserPresence(t.getAttribute(o.PresenceConstatnts.XMPP_KEYS.FROM),o.PresenceConstatnts.STATUS.OFFLINE,(new Date).getTime()):new r.UserPresence(t.getAttribute(o.PresenceConstatnts.XMPP_KEYS.FROM),o.PresenceConstatnts.STATUS.ONLINE,(new Date).getTime())},t.transformPresences=function(t){var e=[];return t.map(function(t){try{e.push(new r.UserPresence(t.getAttribute(o.PresenceConstatnts.XMPP_KEYS.FROM),t.getAttribute(o.PresenceConstatnts.XMPP_KEYS.STATUS),t.getAttribute(o.PresenceConstatnts.XMPP_KEYS.LAST_ACTIVE_AT)))}catch(t){}}),e},t.transformMUCUserPresence=function(t){return t.getAttribute(\"type\")?new r.UserPresence(t.getAttribute(o.PresenceConstatnts.XMPP_KEYS.FROM),o.PresenceConstatnts.STATUS.LEFT,(new Date).getTime()):new r.UserPresence(t.getAttribute(o.PresenceConstatnts.XMPP_KEYS.FROM),o.PresenceConstatnts.STATUS.JOINED,(new Date).getTime())},t.trandformMUCPresence=function(t){0<t.getElementsByTagName(\"x\").length&&this.transformMUCUserPresence(t)},t}();e.PresenceController=s},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(0),o=n(7),s=n(1),i=n(2),a=n(26),c=n(4),u=n(15),l=n(5),h=function(){function e(){this.TAG=\"calling Log\",this.callListner=void 0,this.CALL_NO_ANSWER_INTERVAL=45e3,this.view=void 0,this.scrollHight=0,this.scrollHight=0}return e.prototype.getCallListner=function(){return this.callListner},e.prototype.setCallListner=function(t){this.callListner=new u.UserCallListener(t)},e.getInstance=function(){return null!=this.callController&&null!=this.callController||(this.callController=new e),this.callController},e.prototype.getActiveCall=function(){return s.isFalsy(this.call)?null:this.call},e.prototype.initiateCall=function(t){var e=this;return new Promise(function(n,o){s.isFalsy(e.call)?null!=t&&null!=t?(e.call=t,e.joinCallMuc(t.getSessionId()),e.startCallTimer(),n(t)):o(new c.CometChatException(r.CALL_ERROR.ERROR_IN_CALLING)):o(new c.CometChatException(r.CALL_ERROR.CALL_ALREADY_INITIATED))})},e.prototype.onCallInitialized=function(){},e.prototype.joinCall=function(t){s.Logger.log(this.TAG,t)},e.prototype.cancelCall=function(){s.Logger.log(this.TAG,\"calceling the call\"),this.stopCallTimer()},e.prototype.rejectCall=function(){s.Logger.log(this.TAG,\"rejectCall\")},e.prototype.sendBusyResponse=function(){s.Logger.log(this.TAG,\"sendBusyResponse\")},e.prototype.endCall=function(t){var e=this;i.CometChat.isNative||document.getElementsByName(\"frame\").forEach(function(t){e.view.removeChild(t),e.view=void 0}),this.endCallSession()},e.prototype.onCallEnded=function(){var t=this;s.isFalsy(this.call)||(this.call.getReceiverType()==r.CallConstants.RECEIVER_TYPE_GROUP?s.Logger.info(this.TAG,JSON.stringify(this.call)+\"This call ended\"):(document.getElementsByName(\"frame\").forEach(function(e){t.view.removeChild(e),t.view=void 0}),this.endCallSession()))},e.prototype.unAnswerCall=function(){s.Logger.log(this.TAG,\"unAnswerCall\")},e.prototype.onCallStarted=function(t){var e=this;return new Promise(function(n,o){s.isFalsy(e.call)?null!=t&&null!=t?(e.call=t,e.joinCallMuc(t.getSessionId()),n(t)):o(new c.CometChatException(r.CALL_ERROR.ERROR_IN_CALLING)):o(new c.CometChatException(r.CALL_ERROR.CALL_ALREADY_INITIATED))})},e.prototype.endCallSession=function(){try{this.leaveCallMuc(this.call.getSessionId()),this.call=void 0,e.callController=void 0,this.timer&&this.stopCallTimer(),this.view=void 0}catch(t){s.Logger.error(\"EndCallSession\",{e:t})}},e.prototype.joinCallMuc=function(t){var e=this;s.getAppSettings().then(function(n){o.XMPPConnectionHelper.getInstance().connection.muc.join(s.format(r.XMPP.muc_jid_string,i.CometChat.getAppId(),t,i.CometChat.getAppId(),\"call.\"+n[r.APP_SETTINGS.KEYS.CHAT_HOST]),o.XMPPConnectionHelper.getInstance().connection.jid,null,function(t){try{var i=a.PresenceController.transformPresence(t);o.XMPPConnectionHelper.getInstance().getUsersVCard(i.getUid(),function(n){if(!s.isFalsy(n.getUid()))switch(n.setLastActiveAt(i.getLastActiveAt()),i.getStatus()){case r.PresenceConstatnts.STATUS.ONLINE:n.setStatus(r.PresenceConstatnts.STATUS.ONLINE);break;default:n.setStatus(r.PresenceConstatnts.STATUS.OFFLINE)}switch(a.PresenceController.transformMUCUserPresence(t).getStatus()){case r.PresenceConstatnts.STATUS.JOINED:e.callListner&&(s.isFalsy(e.callListner._eventListener.onUserJoined)||e.callListner._eventListener.onUserJoined(n));break;case r.PresenceConstatnts.STATUS.LEFT:e.callListner&&(s.isFalsy(e.callListner._eventListener.onUserLeft)||e.callListner._eventListener.onUserLeft(n))}})}catch(n){}return!0})},function(t){})},e.prototype.leaveCallMuc=function(t){s.getAppSettings().then(function(e){o.XMPPConnectionHelper.getInstance().connection.muc.leave(s.format(r.XMPP.muc_jid_string,i.CometChat.getAppId(),t,i.CometChat.getAppId(),\"call.\"+e[r.APP_SETTINGS.KEYS.CHAT_HOST]),o.XMPPConnectionHelper.getInstance().connection.jid)})},e.prototype.startCallTimer=function(){var t=this;this.timer=setTimeout(function(){i.CometChat.sendUnansweredResponse(t.call.getSessionId()).then(function(e){t.endCallSession()})},this.CALL_NO_ANSWER_INTERVAL)},e.prototype.stopCallTimer=function(){clearTimeout(this.timer)},e.prototype.startCall=function(t,n,r){var o=this;if(null==this.view){this.timer&&this.stopCallTimer(),s.isFalsy(n)||this.setCallListner(n);var a=document.createElement(\"iframe\");this.getCallUrl(this.call.getType()).then(function(n){if(a.src=n+\"\",a.name=\"frame\",a.setAttribute(\"allow\",\"camera,microphone\"),a.setAttribute(\"width\",\"100%\"),a.setAttribute(\"height\",\"100%\"),e.callScreen=a,t&&(o.view=t),i.CometChat.isNative)return o.view.props.prop1(r,n),void(o.view.props.onMessage=function(t){});t.appendChild(a),window.addEventListener(\"message\",function(t){\"hangup\"==t.data.type&&o.call&&(s.Logger.info(o.TAG,o.callListner),o.callListner&&o.callListner._eventListener.onCallEnded(o.call),i.CometChat.endCall(o.call.getSessionId()).then(function(t){o.callListner&&o.callListner._eventListener.onCallEnded(t),s.Logger.info(o.TAG,{call:t})}).catch(function(t){s.Logger.info(o.TAG,\"The Call Was Already Ended\")}))})})}},e.prototype.getCallUrl=function(t){var e=this,n=void 0;return new Promise(function(t,o){l.LocalStorage.getInstance().get(r.APP_SETTINGS.APP_SETTINGS).then(function(r){s.isFalsy(r)?s.getAppSettings().then(function(r){n=(n=\"https://borrelly.cometchat.com/avchat/index.htm\")+\"?session=\"+e.call.getSessionId()+\"&uid=user&\",t(n)}):(n=(n=\"https://borrelly.cometchat.com/avchat/index.htm\")+\"?session=\"+e.call.getSessionId()+\"&uid=user&\",t(n))})})},e.toggleAudio=function(){this.callScreen&&this.callScreen.contentWindow.postMessage({action:\"audio\"},\"*\")},e.toggleVideo=function(){this.callScreen&&this.callScreen.contentWindow.postMessage({action:\"video\"},\"*\")},e.leave=function(){this.callScreen&&this.callScreen.contentWindow.postMessage({action:\"leave\"},\"*\")},e.prototype.destroy=function(){s.isFalsy(this.call)||(this.call=void 0),s.isFalsy(this.timer)||(this.timer=void 0),s.isFalsy(this.view)||(this.view=void 0)},e.callController=void 0,e}();e.CallController=h},function(t,e,n){\"use strict\";e.__esModule=!0;var r=function(){function t(t,e,n){this.receiverId=t,this.receiverType=e,this.metadata=n}return t.prototype.getReceiverType=function(){return this.receiverType},t.prototype.setReceiverType=function(t){this.receiverType=t},t.prototype.getReceiverId=function(){return this.receiverId},t.prototype.setReceiverId=function(t){this.receiverId=t},t.prototype.getMetadata=function(){return this.metadata},t.prototype.setMetadata=function(t){this.metadata=t},t.prototype.getSender=function(){return this.sender},t.prototype.setSender=function(t){this.sender=t},t}();e.TypingIndicator=r},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(1),o=n(0),s=n(7),i=function(){function t(){}return t.addTypingStarted=function(t){this.TYPING_STARTED_MAP[t]=r.getCurrentTime()},t.removeTypingStarted=function(t){delete this.TYPING_STARTED_MAP[t]},t.getTypingStartedMap=function(t){if(t)return this.TYPING_STARTED_MAP[t]},t.addTypingEnded=function(t){this.TYPING_ENDED_MAP[t]=r.getCurrentTime()},t.removeTypingEnded=function(t){delete this.TYPING_ENDED_MAP[t]},t.getTypingEndedMap=function(t){if(t)return this.TYPING_ENDED_MAP[t]},t.addIncomingTypingStarted=function(t){this.INCOMING_TYPING_STARTED_MAP[t.getReceiverId()]={typingNotification:t,timestamp:r.getCurrentTime()}},t.removeIncomingTypingStarted=function(t){delete this.INCOMING_TYPING_STARTED_MAP[t.getReceiverId()]},t.clearTimer=function(){var t=this;new Promise(function(e,n){Object.keys(t.TYPING_STARTED_MAP).map(function(e){r.getCurrentTime()-t.TYPING_STARTED_MAP[e]>=1e3*o.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT&&delete t.TYPING_STARTED_MAP[e]})}),new Promise(function(e,n){Object.keys(t.TYPING_ENDED_MAP).map(function(e){r.getCurrentTime()-t.TYPING_ENDED_MAP[e]>=1e3*o.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT&&delete t.TYPING_ENDED_MAP[e]})}),new Promise(function(e,n){Object.keys(t.INCOMING_TYPING_STARTED_MAP).map(function(e){r.getCurrentTime()-t.INCOMING_TYPING_STARTED_MAP[e][o.TYPING_NOTIFICATION.KEYS.TIMESTAMP]>=1e3*o.DEFAULT_VALUES.DEFAULT_MAX_TYPING_INDICATOR_LIMIT&&(s.XMPPConnectionHelper.getInstance().publishTypinStatusNotification(t.INCOMING_TYPING_STARTED_MAP[e][o.TYPING_NOTIFICATION.KEYS.TYPING_NOTIFICATION],o.TYPING_NOTIFICATION.ACTIONS.ENDED),delete t.INCOMING_TYPING_STARTED_MAP[e])})})},t.TYPING_STARTED_MAP={},t.TYPING_ENDED_MAP={},t.INCOMING_TYPING_STARTED_MAP={},t}();e.TypingNotificationController=i},function(t,e,n){\"use strict\";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,s){function i(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(i,a)}c((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},\"function\"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError(\"Generator is already executing.\");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(a){s=[6,a],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};e.__esModule=!0;var s=n(2),i=function(){function t(){}return t.addCometChatExtension=function(e){return r(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return t.cometChatExtensionList.push(e),s.CometChat.user?[4,e.onInit(s.CometChat.getAppId(),s.CometChat.user)]:[3,2];case 1:return n.sent(),[3,4];case 2:return[4,e.onInit(s.CometChat.getAppId())];case 3:n.sent(),n.label=4;case 4:return[2]}})})},t.cometChatExtensionList=[],t}();e.ExtensionManager=i},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(3),o=function(){function t(){}return t.trasformJSONUser=function(t){var e;try{e=new r.User(t),Object.assign(e,t),t=e}catch(t){}return t},t}();e.UsersController=o},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(18),o=n(0),s=function(){function t(){}return t.trasformJSONGroup=function(t){var e;try{e=new r.Group(t[o.GroupConstants.KEYS.GUID],t[o.GroupConstants.KEYS.NAME],t[o.GroupConstants.KEYS.NAME]),Object.assign(e,t),t=e}catch(t){}return t},t}();e.GroupsController=s},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(2),o=n(1),s=n(0),i=n(10),a=function(){function t(t){if(this.store=s.constants.DEFAULT_STORE,o.isFalsy(t)||(this.store=t),r.CometChat.isNative)try{this.userStore=n(11).AsyncStorage}catch(t){}else this.userStore=i.createInstance({name:o.format(s.LOCAL_STORE.STORE_STRING,r.CometChat.getAppId(),s.LOCAL_STORE.USERS_STORE)}),this.userStore.setDriver([i.LOCALSTORAGE,i.INDEXEDDB,i.WEBSQL])}return t.getInstance=function(){return null==t.UserStore&&(t.UserStore=new t),t.UserStore},t.prototype.set=function(t,e){return this.userStore.setItem(t,e)},t.prototype.remove=function(t){this.userStore.removeItem(t)},t.prototype.get=function(t){return this.userStore.getItem(t)},t.prototype.clearStore=function(){return this.userStore.clear()},t.prototype.clear=function(t){},t.prototype.selectStore=function(t){this.store=t},t.prototype.storeUsers=function(t){var e=this;return t.map(function(t){e.set(t.getUid(),t)}),!0},t.prototype.storeUser=function(t){return this.set(t.getUid(),t),!0},t}();e.UserStore=a},function(t,e,n){\"use strict\";e.__esModule=!0,e.ERRORS={PARAMETER_MISSING:{code:\"MISSING_PARAMETERS\",name:\"MISSING/ INVALID PARAMETER\"},NOT_INITIALIZED:{code:\"NOT_INITIALIZED\",name:\"INITIALIZATION NOT DONE\"}},e.INIT_ERROR={NO_APP_ID:{code:e.ERRORS.PARAMETER_MISSING.code,name:e.ERRORS.PARAMETER_MISSING.name,message:\"mandatory parameter appId missing\",details:{}}},e.GROUP_CREATION_ERRORS={EMPTY_PASSWORD:{code:\"ERR_EMPTY_GROUP_PASS\",details:void 0,message:\"The password is required to join a group.\",name:void 0}},e.MESSAGES_REQUEST_ERRORS={REQUEST_IN_PROGRESS_ERROR:{code:\"REQUEST_IN_PROGRESS\",name:\"REQUEST_IN_PROGRESS\",message:\"request already in progress\",details:{}},NOT_ENOUGH_PARAMS:{code:\"NOT_ENOUGH_PARAMETERS\",name:\"NOT_ENOUGH_PARAMETERS\",message:\"you need to set timstamp or message id to fetch next set of messages\",details:{}}},e.LOGIN_ERROR={NOT_INITIALIZED:{code:\"-1\",name:\"COMETCHAT_INITIALIZATION_NOT_DONE\",message:\"please initialize the cometchat before using login method\",details:{}},UNAUTHORISED:{code:401,name:\"USER_NOT_AUTHORISED\",message:\"provided user is not authorised\",details:{}},XMPP_CONNECTION_FAIL:{code:-1,name:\"XMPP_CONNECTION_FAIL\",message:\"XMPP username/password not correct\",details:{}}},e.TYPINGNOTIFICATION_CONSTANTS={TOO_MANY_REQUEST:{code:\"TOO_MANY_REQUEST\",name:\"TOO MANY REQUEST\",message:\"too many request, wait for `%s` seconds before sending next request\",details:{}}}},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(0),o=function(){function t(t,e){this.joinedAt=0,this.isBanned=0,this.uid=t,e&&(this.scope=e)}return t.prototype.getName=function(){return this.name},t.prototype.setName=function(t){this.name=t},t.prototype.getAvatar=function(){return this.avatar},t.prototype.setAvatar=function(t){this.avatar=t},t.prototype.getCredits=function(){return this.credits},t.prototype.setCredits=function(t){this.credits=t},t.prototype.getEmail=function(){return this.email},t.prototype.setEmail=function(t){this.email=t},t.prototype.getLastActiveAt=function(){return this.lastActiveAt},t.prototype.setLastActiveAt=function(t){this.lastActiveAt=t},t.prototype.getLink=function(){return this.link},t.prototype.setLink=function(t){this.link=t},t.prototype.getMetadata=function(){return this.metadata},t.prototype.setMetadata=function(t){this.metadata=t},t.prototype.getRole=function(){return this.role},t.prototype.setRole=function(t){this.role=t},t.prototype.getStatus=function(){return this.status},t.prototype.setStatus=function(t){this.status=t},t.prototype.getStatusMessage=function(){return this.statusMessage},t.prototype.setStatusMessage=function(t){this.statusMessage=t},t.prototype.setGuid=function(t){this.guid=t},t.prototype.setUid=function(t){this.uid=t},t.prototype.setScope=function(t){this.scope=t},t.prototype.setJoinedAt=function(t){this.joinedAt=t},t.prototype.setIsBanned=function(t){this.isBanned=t},t.prototype.setUser=function(t){this.user=t},t.prototype.getGuid=function(){return this.guid},t.prototype.getUid=function(){return this.uid},t.prototype.getuser=function(){return this.user},t.prototype.getScope=function(){return this.scope},t.prototype.getJoinedAt=function(){return this.joinedAt},t.prototype.getIsBanned=function(){return this.isBanned},t.GroupMemberScope=r.GroupMemberScope,t}();e.GroupMember=o},function(t,e){function n(t,e){for(var n in t)e[n]=t[n]}function r(t,e){var r=t.prototype;if(Object.create){var o=Object.create(e.prototype);r.__proto__=o}if(!(r instanceof e)){function s(){}s.prototype=e.prototype,n(r,s=new s),t.prototype=r=s}r.constructor!=t&&(r.constructor=t)}var o=\"http://www.w3.org/1999/xhtml\",s={},i=s.ELEMENT_NODE=1,a=s.ATTRIBUTE_NODE=2,c=s.TEXT_NODE=3,u=s.CDATA_SECTION_NODE=4,l=s.ENTITY_REFERENCE_NODE=5,h=s.ENTITY_NODE=6,d=s.PROCESSING_INSTRUCTION_NODE=7,p=s.COMMENT_NODE=8,f=s.DOCUMENT_NODE=9,g=s.DOCUMENT_TYPE_NODE=10,E=s.DOCUMENT_FRAGMENT_NODE=11,m=s.NOTATION_NODE=12,_={},T={},C=(_.INDEX_SIZE_ERR=(T[1]=\"Index size error\",1),_.DOMSTRING_SIZE_ERR=(T[2]=\"DOMString size error\",2),_.HIERARCHY_REQUEST_ERR=(T[3]=\"Hierarchy request error\",3)),S=(_.WRONG_DOCUMENT_ERR=(T[4]=\"Wrong document\",4),_.INVALID_CHARACTER_ERR=(T[5]=\"Invalid character\",5),_.NO_DATA_ALLOWED_ERR=(T[6]=\"No data allowed\",6),_.NO_MODIFICATION_ALLOWED_ERR=(T[7]=\"No modification allowed\",7),_.NOT_FOUND_ERR=(T[8]=\"Not found\",8)),A=(_.NOT_SUPPORTED_ERR=(T[9]=\"Not supported\",9),_.INUSE_ATTRIBUTE_ERR=(T[10]=\"Attribute in use\",10));function y(t,e){if(e instanceof Error)var n=e;else n=this,Error.call(this,T[t]),this.message=T[t],Error.captureStackTrace&&Error.captureStackTrace(this,y);return n.code=t,e&&(this.message=this.message+\": \"+e),n}function I(){}function v(t,e){this._node=t,this._refresh=e,N(this)}function N(t){var e=t._node._inc||t._node.ownerDocument._inc;if(t._inc!=e){var r=t._refresh(t._node);nt(t,\"length\",r.length),n(r,t),t._inc=e}}function M(){}function R(t,e){for(var n=t.length;n--;)if(t[n]===e)return n}function O(t,e,n,r){if(r?e[R(e,r)]=n:e[e.length++]=n,t){var o=(n.ownerElement=t).ownerDocument;o&&(r&&U(o,t,r),i=t,a=n,(s=o)&&s._inc++,\"http://www.w3.org/2000/xmlns/\"==a.namespaceURI&&(i._nsMap[a.prefix?a.localName:\"\"]=a.value))}var s,i,a}function P(t,e,n){var r=R(e,n);if(!(0<=r))throw y(S,new Error(t.tagName+\"@\"+n));for(var o=e.length-1;r<o;)e[r]=e[++r];if(e.length=o,t){var s=t.ownerDocument;s&&(U(s,t,n),n.ownerElement=null)}}function b(t){if(this._features={},t)for(var e in t)this._features=t[e]}function L(){}function w(t){return(\"<\"==t?\"&lt;\":\">\"==t&&\"&gt;\")||\"&\"==t&&\"&amp;\"||'\"'==t&&\"&quot;\"||\"&#\"+t.charCodeAt()+\";\"}function D(t,e){if(e(t))return!0;if(t=t.firstChild)do{if(D(t,e))return!0}while(t=t.nextSibling)}function x(){}function U(t,e,n,r){t&&t._inc++,\"http://www.w3.org/2000/xmlns/\"==n.namespaceURI&&delete e._nsMap[n.prefix?n.localName:\"\"]}function Y(t,e,n){if(t&&t._inc){t._inc++;var r=e.childNodes;if(n)r[r.length++]=n;else{for(var o=e.firstChild,s=0;o;)o=(r[s++]=o).nextSibling;r.length=s}}}function G(t,e){var n=e.previousSibling,r=e.nextSibling;return n?n.nextSibling=r:t.firstChild=r,r?r.previousSibling=n:t.lastChild=n,Y(t.ownerDocument,t),e}function F(t,e,n){var r=e.parentNode;if(r&&r.removeChild(e),e.nodeType===E){var o=e.firstChild;if(null==o)return e;var s=e.lastChild}else o=s=e;var i=n?n.previousSibling:t.lastChild;for(o.previousSibling=i,s.nextSibling=n,i?i.nextSibling=o:t.firstChild=o,null==n?t.lastChild=s:n.previousSibling=s;o.parentNode=t,o!==s&&(o=o.nextSibling););return Y(t.ownerDocument||t,t),e.nodeType==E&&(e.firstChild=e.lastChild=null),e}function H(){this._nsMap={}}function k(){}function B(){}function K(){}function j(){}function q(){}function X(){}function V(){}function J(){}function W(){}function $(){}function z(){}function Q(){}function Z(t,e){var n=[],r=9==this.nodeType?this.documentElement:this,o=r.prefix,s=r.namespaceURI;if(s&&null==o&&null==(o=r.lookupPrefix(s)))var i=[{namespace:s,prefix:null}];return et(this,n,t,e,i),n.join(\"\")}function tt(t,e,n){var r=t.prefix||\"\",o=t.namespaceURI;if(!r&&!o)return!1;if(\"xml\"===r&&\"http://www.w3.org/XML/1998/namespace\"===o||\"http://www.w3.org/2000/xmlns/\"==o)return!1;for(var s=n.length;s--;){var i=n[s];if(i.prefix==r)return i.namespace!=o}return!0}function et(t,e,n,r,s){if(r){if(!(t=r(t)))return;if(\"string\"==typeof t)return void e.push(t)}switch(t.nodeType){case i:s||(s=[]);var h=t.attributes,m=h.length,_=t.firstChild,T=t.tagName;n=o===t.namespaceURI||n,e.push(\"<\",T);for(var C=0;C<m;C++)\"xmlns\"==(S=h.item(C)).prefix?s.push({prefix:S.localName,namespace:S.value}):\"xmlns\"==S.nodeName&&s.push({prefix:\"\",namespace:S.value});for(C=0;C<m;C++){var S;if(tt(S=h.item(C),0,s)){var A=S.prefix||\"\",y=S.namespaceURI,I=A?\" xmlns:\"+A:\" xmlns\";e.push(I,'=\"',y,'\"'),s.push({prefix:A,namespace:y})}et(S,e,n,r,s)}if(tt(t,0,s)&&(e.push(I=(A=t.prefix||\"\")?\" xmlns:\"+A:\" xmlns\",'=\"',y=t.namespaceURI,'\"'),s.push({prefix:A,namespace:y})),_||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(T)){if(e.push(\">\"),n&&/^script$/i.test(T))for(;_;)_.data?e.push(_.data):et(_,e,n,r,s),_=_.nextSibling;else for(;_;)et(_,e,n,r,s),_=_.nextSibling;e.push(\"</\",T,\">\")}else e.push(\"/>\");return;case f:case E:for(_=t.firstChild;_;)et(_,e,n,r,s),_=_.nextSibling;return;case a:return e.push(\" \",t.name,'=\"',t.value.replace(/[<&\"]/g,w),'\"');case c:return e.push(t.data.replace(/[<&]/g,w));case u:return e.push(\"<![CDATA[\",t.data,\"]]>\");case p:return e.push(\"\\x3c!--\",t.data,\"--\\x3e\");case g:var v=t.publicId,N=t.systemId;if(e.push(\"<!DOCTYPE \",t.name),v)e.push(' PUBLIC \"',v),N&&\".\"!=N&&e.push('\" \"',N),e.push('\">');else if(N&&\".\"!=N)e.push(' SYSTEM \"',N,'\">');else{var M=t.internalSubset;M&&e.push(\" [\",M,\"]\"),e.push(\">\")}return;case d:return e.push(\"<?\",t.target,\" \",t.data,\"?>\");case l:return e.push(\"&\",t.nodeName,\";\");default:e.push(\"??\",t.nodeName)}}function nt(t,e,n){t[e]=n}_.INVALID_STATE_ERR=(T[11]=\"Invalid state\",11),_.SYNTAX_ERR=(T[12]=\"Syntax error\",12),_.INVALID_MODIFICATION_ERR=(T[13]=\"Invalid modification\",13),_.NAMESPACE_ERR=(T[14]=\"Invalid namespace\",14),_.INVALID_ACCESS_ERR=(T[15]=\"Invalid access\",15),y.prototype=Error.prototype,n(_,y),I.prototype={length:0,item:function(t){return this[t]||null},toString:function(t,e){for(var n=[],r=0;r<this.length;r++)et(this[r],n,t,e);return n.join(\"\")}},v.prototype.item=function(t){return N(this),this[t]},r(v,I),M.prototype={length:0,item:I.prototype.item,getNamedItem:function(t){for(var e=this.length;e--;){var n=this[e];if(n.nodeName==t)return n}},setNamedItem:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new y(A);var n=this.getNamedItem(t.nodeName);return O(this._ownerElement,this,t,n),n},setNamedItemNS:function(t){var e,n=t.ownerElement;if(n&&n!=this._ownerElement)throw new y(A);return e=this.getNamedItemNS(t.namespaceURI,t.localName),O(this._ownerElement,this,t,e),e},removeNamedItem:function(t){var e=this.getNamedItem(t);return P(this._ownerElement,this,e),e},removeNamedItemNS:function(t,e){var n=this.getNamedItemNS(t,e);return P(this._ownerElement,this,n),n},getNamedItemNS:function(t,e){for(var n=this.length;n--;){var r=this[n];if(r.localName==e&&r.namespaceURI==t)return r}return null}},b.prototype={hasFeature:function(t,e){var n=this._features[t.toLowerCase()];return!(!n||e&&!(e in n))},createDocument:function(t,e,n){var r=new x;if(r.implementation=this,r.childNodes=new I,(r.doctype=n)&&r.appendChild(n),e){var o=r.createElementNS(t,e);r.appendChild(o)}return r},createDocumentType:function(t,e,n){var r=new X;return r.name=t,r.nodeName=t,r.publicId=e,r.systemId=n,r}},L.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(t,e){return F(this,t,e)},replaceChild:function(t,e){this.insertBefore(t,e),e&&this.removeChild(e)},removeChild:function(t){return G(this,t)},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(t){return function t(e,n,r){var o=new n.constructor;for(var s in n){var c=n[s];\"object\"!=typeof c&&c!=o[s]&&(o[s]=c)}switch(n.childNodes&&(o.childNodes=new I),o.ownerDocument=e,o.nodeType){case i:var u=n.attributes,l=o.attributes=new M,h=u.length;l._ownerElement=o;for(var d=0;d<h;d++)o.setAttributeNode(t(e,u.item(d),!0));break;case a:r=!0}if(r)for(var p=n.firstChild;p;)o.appendChild(t(e,p,r)),p=p.nextSibling;return o}(this.ownerDocument||this,this,t)},normalize:function(){for(var t=this.firstChild;t;){var e=t.nextSibling;e&&e.nodeType==c&&t.nodeType==c?(this.removeChild(e),t.appendData(e.data)):(t.normalize(),t=e)}},isSupported:function(t,e){return this.ownerDocument.implementation.hasFeature(t,e)},hasAttributes:function(){return 0<this.attributes.length},lookupPrefix:function(t){for(var e=this;e;){var n=e._nsMap;if(n)for(var r in n)if(n[r]==t)return r;e=e.nodeType==a?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(t){for(var e=this;e;){var n=e._nsMap;if(n&&t in n)return n[t];e=e.nodeType==a?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(t){return null==this.lookupPrefix(t)}},n(s,L),n(s,L.prototype),x.prototype={nodeName:\"#document\",nodeType:f,doctype:null,documentElement:null,_inc:1,insertBefore:function(t,e){if(t.nodeType!=E)return null==this.documentElement&&t.nodeType==i&&(this.documentElement=t),F(this,t,e),t.ownerDocument=this,t;for(var n=t.firstChild;n;){var r=n.nextSibling;this.insertBefore(n,e),n=r}return t},removeChild:function(t){return this.documentElement==t&&(this.documentElement=null),G(this,t)},importNode:function(t,e){return function t(e,n,r){var o;switch(n.nodeType){case i:(o=n.cloneNode(!1)).ownerDocument=e;case E:break;case a:r=!0}if(o||(o=n.cloneNode(!1)),o.ownerDocument=e,o.parentNode=null,r)for(var s=n.firstChild;s;)o.appendChild(t(e,s,r)),s=s.nextSibling;return o}(this,t,e)},getElementById:function(t){var e=null;return D(this.documentElement,function(n){if(n.nodeType==i&&n.getAttribute(\"id\")==t)return e=n,!0}),e},createElement:function(t){var e=new H;return e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.childNodes=new I,(e.attributes=new M)._ownerElement=e},createDocumentFragment:function(){var t=new $;return t.ownerDocument=this,t.childNodes=new I,t},createTextNode:function(t){var e=new K;return e.ownerDocument=this,e.appendData(t),e},createComment:function(t){var e=new j;return e.ownerDocument=this,e.appendData(t),e},createCDATASection:function(t){var e=new q;return e.ownerDocument=this,e.appendData(t),e},createProcessingInstruction:function(t,e){var n=new z;return n.ownerDocument=this,n.tagName=n.target=t,n.nodeValue=n.data=e,n},createAttribute:function(t){var e=new k;return e.ownerDocument=this,e.name=t,e.nodeName=t,e.localName=t,e.specified=!0,e},createEntityReference:function(t){var e=new W;return e.ownerDocument=this,e.nodeName=t,e},createElementNS:function(t,e){var n=new H,r=e.split(\":\"),o=n.attributes=new M;return n.childNodes=new I,n.ownerDocument=this,n.nodeName=e,n.tagName=e,n.namespaceURI=t,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=e,o._ownerElement=n},createAttributeNS:function(t,e){var n=new k,r=e.split(\":\");return n.ownerDocument=this,n.nodeName=e,n.name=e,n.namespaceURI=t,n.specified=!0,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=e,n}},r(x,L),x.prototype.getElementsByTagName=(H.prototype={nodeType:i,hasAttribute:function(t){return null!=this.getAttributeNode(t)},getAttribute:function(t){var e=this.getAttributeNode(t);return e&&e.value||\"\"},getAttributeNode:function(t){return this.attributes.getNamedItem(t)},setAttribute:function(t,e){var n=this.ownerDocument.createAttribute(t);n.value=n.nodeValue=\"\"+e,this.setAttributeNode(n)},removeAttribute:function(t){var e=this.getAttributeNode(t);e&&this.removeAttributeNode(e)},appendChild:function(t){return t.nodeType===E?this.insertBefore(t,null):function(t,e){var n=e.parentNode;if(n){var r=t.lastChild;n.removeChild(e),r=t.lastChild}return r=t.lastChild,e.parentNode=t,e.previousSibling=r,e.nextSibling=null,r?r.nextSibling=e:t.firstChild=e,t.lastChild=e,Y(t.ownerDocument,t,e),e}(this,t)},setAttributeNode:function(t){return this.attributes.setNamedItem(t)},setAttributeNodeNS:function(t){return this.attributes.setNamedItemNS(t)},removeAttributeNode:function(t){return this.attributes.removeNamedItem(t.nodeName)},removeAttributeNS:function(t,e){var n=this.getAttributeNodeNS(t,e);n&&this.removeAttributeNode(n)},hasAttributeNS:function(t,e){return null!=this.getAttributeNodeNS(t,e)},getAttributeNS:function(t,e){var n=this.getAttributeNodeNS(t,e);return n&&n.value||\"\"},setAttributeNS:function(t,e,n){var r=this.ownerDocument.createAttributeNS(t,e);r.value=r.nodeValue=\"\"+n,this.setAttributeNode(r)},getAttributeNodeNS:function(t,e){return this.attributes.getNamedItemNS(t,e)},getElementsByTagName:function(t){return new v(this,function(e){var n=[];return D(e,function(r){r===e||r.nodeType!=i||\"*\"!==t&&r.tagName!=t||n.push(r)}),n})},getElementsByTagNameNS:function(t,e){return new v(this,function(n){var r=[];return D(n,function(o){o===n||o.nodeType!==i||\"*\"!==t&&o.namespaceURI!==t||\"*\"!==e&&o.localName!=e||r.push(o)}),r})}}).getElementsByTagName,x.prototype.getElementsByTagNameNS=H.prototype.getElementsByTagNameNS,r(H,L),k.prototype.nodeType=a,r(k,L),B.prototype={data:\"\",substringData:function(t,e){return this.data.substring(t,t+e)},appendData:function(t){this.nodeValue=this.data=t=this.data+t,this.length=t.length},insertData:function(t,e){this.replaceData(t,0,e)},appendChild:function(t){throw new Error(T[C])},deleteData:function(t,e){this.replaceData(t,e,\"\")},replaceData:function(t,e,n){n=this.data.substring(0,t)+n+this.data.substring(t+e),this.nodeValue=this.data=n,this.length=n.length}},r(B,L),K.prototype={nodeName:\"#text\",nodeType:c,splitText:function(t){var e=this.data,n=e.substring(t);e=e.substring(0,t),this.data=this.nodeValue=e,this.length=e.length;var r=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(r,this.nextSibling),r}},r(K,B),j.prototype={nodeName:\"#comment\",nodeType:p},r(j,B),q.prototype={nodeName:\"#cdata-section\",nodeType:u},r(q,B),X.prototype.nodeType=g,r(X,L),V.prototype.nodeType=m,r(V,L),J.prototype.nodeType=h,r(J,L),W.prototype.nodeType=l,r(W,L),$.prototype.nodeName=\"#document-fragment\",$.prototype.nodeType=E,r($,L),z.prototype.nodeType=d,r(z,L),Q.prototype.serializeToString=function(t,e,n){return Z.call(t,e,n)},L.prototype.toString=Z;try{Object.defineProperty&&(Object.defineProperty(v.prototype,\"length\",{get:function(){return N(this),this.$$length}}),Object.defineProperty(L.prototype,\"textContent\",{get:function(){return function t(e){switch(e.nodeType){case i:case E:var n=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&n.push(t(e)),e=e.nextSibling;return n.join(\"\");default:return e.nodeValue}}(this)},set:function(t){switch(this.nodeType){case i:case E:for(;this.firstChild;)this.removeChild(this.firstChild);(t||String(t))&&this.appendChild(this.ownerDocument.createTextNode(t));break;default:this.data=t,this.value=t,this.nodeValue=t}}}),nt=function(t,e,n){t[\"$$\"+e]=n})}catch(t){}e.DOMImplementation=b,e.XMLSerializer=Q},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(2);e.init=function(t){return r.CometChat.getInstance(t)},e.CometChat=r.CometChat},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(22);e.getEndPoint=function(t,e){void 0===t&&(t=\"\"),void 0===e&&(e={});var n=new r.EndpointFactory;return new Promise(function(r,o){n.getEndpointData(t).then(function(t){var n=t;if(n){for(var s in e)n.endpoint=n.endpoint.replace(\"{{\"+s+\"}}\",e[s]);r(n)}else o({error:\"Unknown endPoint name.\"})})})}},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(12),o=n(8),s=n(0),i=n(1);e.$iq=r.$iq,e.$build=r.$build,e.$msg=r.$msg,e.$pres=r.$pres,e.Strophe=r.Strophe,e.NS=r.Strophe.NS,e.Status=r.Strophe.Status,window.Strophe=e.Strophe,window.$iq=e.$iq,window.$msg=e.$msg,e.Strophe.addConnectionPlugin(\"chatstates\",{init:function(t){this._connection=t,e.Strophe.addNamespace(\"CHATSTATES\",\"http://jabber.org/protocol/chatstates\")},statusChanged:function(t){},addActive:function(t){return t.c(\"active\",{xmlns:e.Strophe.NS.CHATSTATES}).up()},_notificationReceived:function(t){var e=t.getElementsByTagName(\"composing\");return t.getElementsByTagName(\"paused\"),t.getAttribute(\"from\"),0<e.length&&JSON.stringify(unescape(o.parseHTML(t.getElementsByTagName(\"body\")[0]))),!0},sendActive:function(t,e,n){this._sendNotification(t,e,\"active\",n)},sendComposing:function(t,e,n){this._sendNotification(t,e,\"composing\",n)},sendPaused:function(t,e,n){this._sendNotification(t,e,\"paused\",n)},sendInactive:function(t,e){this._sendNotification(t,e,\"inactive\")},sendGone:function(t,e){this._sendNotification(t,e,\"gone\")},_sendNotification:function(t,n,r,o){n||(n=\"chat\"),i.isFalsy(o)?this._connection.send(e.$msg({to:t,from:this._connection.jid,type:n}).c(r,{xmlns:e.Strophe.NS.CHATSTATES})):this._connection.send(e.$msg({to:t,from:this._connection.jid,type:n}).c(\"body\",JSON.stringify(o)).up().c(r,{xmlns:e.Strophe.NS.CHATSTATES}))}}),e.Strophe.addConnectionPlugin(\"receipts\",{_conn:null,_msgQueue:{},_retries:{},_resendCount:10,_resendTime:9e3,init:function(t){this._conn=t,e.Strophe.addNamespace(\"RECEIPTS\",\"urn:xmpp:receipts\")},statusChanged:function(t){if(t===e.Strophe.Status.CONNECTED||t===e.Strophe.Status.ATTACHED){var n=this;setTimeout(function(){n.resendQueue()},5e3)}},sendMessage:function(t){var n=this._conn.getUniqaueId();t.tree().setAttribute(\"id\",n);var r=e.Strophe.xmlElement(\"request\",{xmlns:e.Strophe.NS.RECEIPTS});return t.tree().appendChild(r),this._msgQueue[n]=t,this._retries[n]=0,this._conn.send(t),this.resendMessage(n),n},resendMessage:function(t){var e=this;setTimeout(function(){if(e._msgQueue[t]){if(!e._conn.connected)return void e.resendMessage(t);if(e._retries[t]++,e._retries[t]>e._resendCount)return;e._msgQueue[t].tree().setAttribute(\"from\",e._conn.jid),e._conn.send(e._msgQueue[t]),e.resendMessage(t)}},this._resendTime)},addReceiptHandler:function(t,n,r,o){var s=this;this._conn.addHandler(function(e){return s._processReceipt(e),t(e)},e.Strophe.NS.RECEIPTS,\"message\",n,null,r,o)},_processReceipt:function(t,n){void 0===n&&(n=0);var r=t.getAttribute(s.DELIVERY_RECEIPTS.ID),i=e.Strophe.getBareJidFromJid(t.getAttribute(s.MessageConstatnts.XMPP_KEYS.FROM)),a=o.getUidFromJid(i),c=s.MessageConstatnts.XMPP_KEYS.TYPE_USER,u=s.MessageConstatnts.RECEIVER_TYPE.USER,l=t.getElementsByTagName(\"request\"),h=t.getElementsByTagName(\"received\");if(t.getAttribute(s.MessageConstatnts.XMPP_KEYS.TYPE)==s.MessageConstatnts.XMPP_KEYS.TYPE_GROUP&&(u=s.MessageConstatnts.RECEIVER_TYPE.GROUP,i=o.getFullJidForGroup(t.getAttribute(s.MessageConstatnts.XMPP_KEYS.FROM))),0<l.length){var d=e.$msg({to:i,type:c,from:this._conn.jid,id:this._conn.getUniqueId()}),p=e.Strophe.xmlElement(\"delivered\",{type:u,receiverId:a,xmlns:e.Strophe.NS.RECEIPTS,id:r});d.tree().appendChild(p),this._conn.send(d)}if(0<h.length){var f=h[0].getAttribute(s.DELIVERY_RECEIPTS.ID);f&&(delete this._msgQueue[f],delete this._retries[f])}},resendQueue:function(){if(this._conn.connected)for(var t in this._msgQueue)this._msgQueue.hasOwnProperty(t)&&this._conn.send(this._msgQueue[t]);else{var e=this;setTimeout(function(){e.resendQueue()},5e3)}},getUnreceivedMsgs:function(){var t=[];for(var e in this._msgQueue)this._msgQueue.hasOwnProperty(e)&&t.push(this._msgQueue[e]);return t},clearMessages:function(){this._msgQueue={}}})},function(t,e,n){\"use strict\";e.__esModule=!0;var r=function(){function t(){this.RECEIPT_TYPE={READ_RECEIPT:\"read\",DELIVERY_RECEIPT:\"delivery\"},this.receiptType=this.RECEIPT_TYPE.DELIVERY_RECEIPT}return t.prototype.getReceiverType=function(){return this.receiverType},t.prototype.setReceiverType=function(t){this.receiverType=t},t.prototype.getSender=function(){return this.sender},t.prototype.setSender=function(t){this.sender=t},t.prototype.getReceiver=function(){return this.receiver},t.prototype.setReceiver=function(t){this.receiver=t},t.prototype.getTimestamp=function(){return this.timestamp},t.prototype.setTimestamp=function(t){this.timestamp=t},t.prototype.getMessageId=function(){return this.messageId},t.prototype.setMessageId=function(t){this.messageId=t},t.prototype.getReceiptType=function(){return this.receiptType},t.prototype.setReceiptType=function(t){void 0===t&&(t=this.RECEIPT_TYPE.DELIVERY_RECEIPT),this.receiptType=t},t}();e.MessageReceipt=r},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(0),o=function(){function t(t){t.hasOwnProperty(r.ATTACHMENTS_CONSTANTS.KEYS.EXTENSION)&&(this.fileEextension=t[r.ATTACHMENTS_CONSTANTS.KEYS.EXTENSION]),t.hasOwnProperty(r.ATTACHMENTS_CONSTANTS.KEYS.MIME_TYPE)&&(this.fileMimeType=t[r.ATTACHMENTS_CONSTANTS.KEYS.MIME_TYPE]),t.hasOwnProperty(r.ATTACHMENTS_CONSTANTS.KEYS.NAME)&&(this.fileName=t[r.ATTACHMENTS_CONSTANTS.KEYS.NAME]),t.hasOwnProperty(r.ATTACHMENTS_CONSTANTS.KEYS.SIZE)&&(this.fileSize=t[r.ATTACHMENTS_CONSTANTS.KEYS.SIZE]),t.hasOwnProperty(r.ATTACHMENTS_CONSTANTS.KEYS.URL)&&(this.fileUrl=t[r.ATTACHMENTS_CONSTANTS.KEYS.URL])}return t.prototype.createFileFromJSON=function(e){return new t(e)},t.prototype.toJSON=function(t){return JSON.stringify(t)},t.prototype.getFileExtension=function(){return this.fileEextension},t.prototype.setFileExtension=function(t){this.fileEextension=t},t.prototype.getFileMimeType=function(){return this.fileMimeType},t.prototype.setFileMimeType=function(t){this.fileMimeType=t},t.prototype.getFileName=function(){return this.fileName},t.prototype.setFileName=function(t){this.fileName=t},t.prototype.getFileSize=function(){return this.fileSize},t.prototype.setFileSize=function(t){this.fileSize=t},t.prototype.getFileUrl=function(){return this.fileUrl},t.prototype.setFileUrl=function(t){this.fileUrl=t},t}();e.Attachment=o},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(1),o=n(8),s=function(){function t(t,e,n,s){r.isFalsy(t)||(this.jid=t,this.uid=o.getUidFromJid(t),r.isFalsy(s)||(this.priority=s),r.isFalsy(e)||(this.status=e),r.isFalsy(n)||(this.lastActiveAt=n))}return t.prototype.getUid=function(){return this.uid},t.prototype.setUid=function(t){this.uid=t},t.prototype.getJid=function(){return this.jid},t.prototype.setJid=function(t){this.jid=t},t.prototype.getPriority=function(){return this.priority},t.prototype.setPriority=function(t){this.priority=t},t.prototype.getStatus=function(){return this.status},t.prototype.setStatus=function(t){this.status=t},t.prototype.getLastActiveAt=function(){return this.lastActiveAt},t.prototype.setLastActiveAt=function(t){this.lastActiveAt=t},t.prototype.getStatusMessage=function(){return this.statusMessage},t.prototype.setStatusMessage=function(t){this.statusMessage=t},t}();e.UserPresence=s},function(t,e,n){!function(t){\"use strict\";var e,n,r={}.hasOwnProperty,o=function(t,e){return function(){return t.apply(e,arguments)}};t.Strophe.addConnectionPlugin(\"muc\",{_connection:null,rooms:{},roomNames:[],init:function(e){return this._connection=e,this._muc_handler=null,t.Strophe.addNamespace(\"MUC_OWNER\",t.Strophe.NS.MUC+\"#owner\"),t.Strophe.addNamespace(\"MUC_ADMIN\",t.Strophe.NS.MUC+\"#admin\"),t.Strophe.addNamespace(\"MUC_USER\",t.Strophe.NS.MUC+\"#user\"),t.Strophe.addNamespace(\"MUC_ROOMCONF\",t.Strophe.NS.MUC+\"#roomconfig\"),t.Strophe.addNamespace(\"MUC_REGISTER\",\"jabber:iq:register\")},join:function(e,r,o,s,i,a,c,u){var l,h,d;return h=this.test_append_nick(e,r),l=t.$pres({from:this._connection.jid,to:h}).c(\"x\",{xmlns:t.Strophe.NS.MUC}),null!=c&&(l=l.c(\"history\",c).up()),null!=a&&l.cnode(t.Strophe.xmlElement(\"password\",[],a)),null!=u&&l.up().cnode(u),null==this._muc_handler&&(this._muc_handler=this._connection.addHandler((d=this,function(n){var r,o,s,i,a,c,u,l;if(!(r=n.getAttribute(\"from\")))return!0;if(c=r.split(\"/\")[0],!d.rooms[c])return!0;if(e=d.rooms[c],o={},\"message\"===n.nodeName)o=e._message_handlers;else if(\"presence\"===n.nodeName&&0<(l=n.getElementsByTagName(\"x\")).length)for(s=0,a=l.length;s<a;s++)if((u=l[s].getAttribute(\"xmlns\"))&&u.match(t.Strophe.NS.MUC)){o=e._presence_handlers;break}for(i in o)(0,o[i])(n,e)||delete o[i];return!0}))),this.rooms.hasOwnProperty(e)||(this.rooms[e]=new n(this,e,r,a),s&&this.rooms[e].addHandler(\"presence\",s),o&&this.rooms[e].addHandler(\"message\",o),i&&this.rooms[e].addHandler(\"roster\",i),this.roomNames.push(e)),this._connection.send(l)},leave:function(e,n,r,o){var s,i,a,c;return s=this.roomNames.indexOf(e),delete this.rooms[e],0<=s&&(this.roomNames.splice(s,1),0===this.roomNames.length&&(this._connection.deleteHandler(this._muc_handler),this._muc_handler=null)),c=this.test_append_nick(e,n),a=this._connection.getUniqueId(),i=t.$pres({type:\"unavailable\",id:a,from:this._connection.jid,to:c}),null!=o&&i.c(\"status\",o),null!=r&&this._connection.addHandler(r,null,\"presence\",null,a),this._connection.send(i),a},message:function(e,n,r,o,s,i){var a,c,u;return u=this.test_append_nick(e,n),s=s||(null!=n?\"chat\":\"groupchat\"),i=i||this._connection.getUniqueId(),(a=t.$msg({to:u,from:this._connection.jid,type:s,id:i}).c(\"body\").t(r)).up(),null!=o&&(a.c(\"html\",{xmlns:t.Strophe.NS.XHTML_IM}).c(\"body\",{xmlns:t.Strophe.NS.XHTML}).h(o),0===a.node.childNodes.length?(c=a.node.parentNode,a.up().up(),a.node.removeChild(c)):a.up().up()),a.c(\"x\",{xmlns:\"jabber:x:event\"}).c(\"composing\"),this._connection.send(a),i},groupchat:function(t,e,n,r){return this.message(t,null,e,n,void 0,r)},invite:function(e,n,r){var o,s;return s=this._connection.getUniqueId(),o=t.$msg({from:this._connection.jid,to:e,id:s}).c(\"x\",{xmlns:t.Strophe.NS.MUC_USER}).c(\"invite\",{to:n}),null!=r&&o.c(\"reason\",r),this._connection.send(o),s},multipleInvites:function(e,n,r){var o,s,i,a;for(a=this._connection.getUniqueId(),s=t.$msg({from:this._connection.jid,to:e,id:a}).c(\"x\",{xmlns:t.Strophe.NS.MUC_USER}),o=0,i=n.length;o<i;o++)s.c(\"invite\",{to:n[o]}),null!=r&&(s.c(\"reason\",r),s.up()),s.up();return this._connection.send(s),a},directInvite:function(e,n,r,o){var s,i,a;return a=this._connection.getUniqueId(),s={xmlns:\"jabber:x:conference\",jid:e},null!=r&&(s.reason=r),null!=o&&(s.password=o),i=t.$msg({from:this._connection.jid,to:n,id:a}).c(\"x\",s),this._connection.send(i),a},queryOccupants:function(e,n,r){var o,s;return o={xmlns:t.Strophe.NS.DISCO_ITEMS},s=t.$iq({from:this._connection.jid,to:e,type:\"get\"}).c(\"query\",o),this._connection.sendIQ(s,n,r)},configure:function(e,n,r){var o;return o=t.$iq({to:e,type:\"get\"}).c(\"query\",{xmlns:t.Strophe.NS.MUC_OWNER}).tree(),this._connection.sendIQ(o,n,r)},cancelConfigure:function(e){var n;return n=t.$iq({to:e,type:\"set\"}).c(\"query\",{xmlns:t.Strophe.NS.MUC_OWNER}).c(\"x\",{xmlns:\"jabber:x:data\",type:\"cancel\"}).tree(),this._connection.sendIQ(n)},saveConfiguration:function(e,n,r,o){var s,i,a,c;if(i=t.$iq({to:e,type:\"set\"}).c(\"query\",{xmlns:t.Strophe.NS.MUC_OWNER}),void 0!==t.Strophe.x&&void 0!==t.Strophe.x.Form&&n instanceof t.Strophe.x.Form)n.type=\"submit\",i.cnode(n.toXML());else for(i.c(\"x\",{xmlns:\"jabber:x:data\",type:\"submit\"}),s=0,a=n.length;s<a;s++)i.cnode(n[s]).up();return c=i.tree(),this._connection.sendIQ(c,r,o)},createInstantRoom:function(e,n,r){var o;return o=t.$iq({to:e,type:\"set\"}).c(\"query\",{xmlns:t.Strophe.NS.MUC_OWNER}).c(\"x\",{xmlns:\"jabber:x:data\",type:\"submit\"}),this._connection.sendIQ(o.tree(),n,r)},createConfiguredRoom:function(e,n,o,s){var i,a,c;for(i in(a=t.$iq({to:e,type:\"set\"}).c(\"query\",{xmlns:t.Strophe.NS.MUC_OWNER}).c(\"x\",{xmlns:\"jabber:x:data\",type:\"submit\"})).c(\"field\",{var:\"FORM_TYPE\"}).c(\"value\").t(\"http://jabber.org/protocol/muc#roomconfig\").up().up(),n)r.call(n,i)&&(c=n[i],a.c(\"field\",{var:i}).c(\"value\").t(c).up().up());return this._connection.sendIQ(a.tree(),o,s)},setTopic:function(e,n){var r;return r=t.$msg({to:e,from:this._connection.jid,type:\"groupchat\"}).c(\"subject\",{xmlns:\"jabber:client\"}).t(n),this._connection.send(r.tree())},_modifyPrivilege:function(e,n,r,o,s){var i;return i=t.$iq({to:e,type:\"set\"}).c(\"query\",{xmlns:t.Strophe.NS.MUC_ADMIN}).cnode(n.node),null!=r&&i.c(\"reason\",r),this._connection.sendIQ(i.tree(),o,s)},modifyRole:function(e,n,r,o,s,i){var a;return a=t.$build(\"item\",{nick:n,role:r}),this._modifyPrivilege(e,a,o,s,i)},kick:function(t,e,n,r,o){return this.modifyRole(t,e,\"none\",n,r,o)},voice:function(t,e,n,r,o){return this.modifyRole(t,e,\"participant\",n,r,o)},mute:function(t,e,n,r,o){return this.modifyRole(t,e,\"visitor\",n,r,o)},op:function(t,e,n,r,o){return this.modifyRole(t,e,\"moderator\",n,r,o)},deop:function(t,e,n,r,o){return this.modifyRole(t,e,\"participant\",n,r,o)},modifyAffiliation:function(e,n,r,o,s,i){var a;return a=t.$build(\"item\",{jid:n,affiliation:r}),this._modifyPrivilege(e,a,o,s,i)},ban:function(t,e,n,r,o){return this.modifyAffiliation(t,e,\"outcast\",n,r,o)},member:function(t,e,n,r,o){return this.modifyAffiliation(t,e,\"member\",n,r,o)},revoke:function(t,e,n,r,o){return this.modifyAffiliation(t,e,\"none\",n,r,o)},owner:function(t,e,n,r,o){return this.modifyAffiliation(t,e,\"owner\",n,r,o)},admin:function(t,e,n,r,o){return this.modifyAffiliation(t,e,\"admin\",n,r,o)},changeNick:function(e,n){var r,o;return o=this.test_append_nick(e,n),r=t.$pres({from:this._connection.jid,to:o,id:this._connection.getUniqueId()}),this._connection.send(r.tree())},setStatus:function(e,n,r,o){var s,i;return i=this.test_append_nick(e,n),s=t.$pres({from:this._connection.jid,to:i}),null!=r&&s.c(\"show\",r).up(),null!=o&&s.c(\"status\",o),this._connection.send(s.tree())},registrationRequest:function(e,n,r){var o;return o=t.$iq({to:e,from:this._connection.jid,type:\"get\"}).c(\"query\",{xmlns:t.Strophe.NS.MUC_REGISTER}),this._connection.sendIQ(o,function(t){var e,r,o,s,i,a;for(s={required:[],optional:[]},i=0,a=(r=t.getElementsByTagName(\"field\")).length;i<a;i++)o={var:(e=r[i]).getAttribute(\"var\"),label:e.getAttribute(\"label\"),type:e.getAttribute(\"type\")},0<e.getElementsByTagName(\"required\").length?s.required.push(o):s.optional.push(o);return n(s)},r)},submitRegistrationForm:function(e,n,r,o){var s,i,a;for(i in(s=t.$iq({to:e,type:\"set\"}).c(\"query\",{xmlns:t.Strophe.NS.MUC_REGISTER})).c(\"x\",{xmlns:\"jabber:x:data\",type:\"submit\"}),s.c(\"field\",{var:\"FORM_TYPE\"}).c(\"value\").t(\"http://jabber.org/protocol/muc#register\").up().up(),n)a=n[i],s.c(\"field\",{var:i}).c(\"value\").t(a).up().up();return this._connection.sendIQ(s,r,o)},listRooms:function(e,n,r){var o;return o=t.$iq({to:e,from:this._connection.jid,type:\"get\"}).c(\"query\",{xmlns:t.Strophe.NS.DISCO_ITEMS}),this._connection.sendIQ(o,n,r)},test_append_nick:function(e,n){return t.Strophe.escapeNode(t.Strophe.getNodeFromJid(e))+\"@\"+t.Strophe.getDomainFromJid(e)+(null!=n?\"/\"+n:\"\")}}),n=function(){function n(e,n,r,s){this.client=e,this.name=n,this.nick=r,this.password=s,this._roomRosterHandler=o(this._roomRosterHandler,this),this._addOccupant=o(this._addOccupant,this),this.roster={},this._message_handlers={},this._presence_handlers={},this._roster_handlers={},this._handler_ids=0,this.client.muc&&(this.client=this.client.muc),this.name=t.Strophe.getBareJidFromJid(this.name),this.addHandler(\"presence\",this._roomRosterHandler)}return n.prototype.join=function(t,e,n){return this.client.join(this.name,this.nick,t,e,n,this.password)},n.prototype.leave=function(t,e){return this.client.leave(this.name,this.nick,t,e),delete this.client.rooms[this.name]},n.prototype.message=function(t,e,n,r){return this.client.message(this.name,t,e,n,r)},n.prototype.groupchat=function(t,e){return this.client.groupchat(this.name,t,e)},n.prototype.invite=function(t,e){return this.client.invite(this.name,t,e)},n.prototype.multipleInvites=function(t,e){return this.client.invite(this.name,t,e)},n.prototype.directInvite=function(t,e){return this.client.directInvite(this.name,t,e,this.password)},n.prototype.configure=function(t){return this.client.configure(this.name,t)},n.prototype.cancelConfigure=function(){return this.client.cancelConfigure(this.name)},n.prototype.saveConfiguration=function(t){return this.client.saveConfiguration(this.name,t)},n.prototype.queryOccupants=function(t,e){return this.client.queryOccupants(this.name,t,e)},n.prototype.setTopic=function(t){return this.client.setTopic(this.name,t)},n.prototype.modifyRole=function(t,e,n,r,o){return this.client.modifyRole(this.name,t,e,n,r,o)},n.prototype.kick=function(t,e,n,r){return this.client.kick(this.name,t,e,n,r)},n.prototype.voice=function(t,e,n,r){return this.client.voice(this.name,t,e,n,r)},n.prototype.mute=function(t,e,n,r){return this.client.mute(this.name,t,e,n,r)},n.prototype.op=function(t,e,n,r){return this.client.op(this.name,t,e,n,r)},n.prototype.deop=function(t,e,n,r){return this.client.deop(this.name,t,e,n,r)},n.prototype.modifyAffiliation=function(t,e,n,r,o){return this.client.modifyAffiliation(this.name,t,e,n,r,o)},n.prototype.ban=function(t,e,n,r){return this.client.ban(this.name,t,e,n,r)},n.prototype.member=function(t,e,n,r){return this.client.member(this.name,t,e,n,r)},n.prototype.revoke=function(t,e,n,r){return this.client.revoke(this.name,t,e,n,r)},n.prototype.owner=function(t,e,n,r){return this.client.owner(this.name,t,e,n,r)},n.prototype.admin=function(t,e,n,r){return this.client.admin(this.name,t,e,n,r)},n.prototype.changeNick=function(t){return this.nick=t,this.client.changeNick(this.name,nick)},n.prototype.setStatus=function(t,e){return this.client.setStatus(this.name,this.nick,t,e)},n.prototype.addHandler=function(t,e){var n;switch(n=this._handler_ids++,t){case\"presence\":this._presence_handlers[n]=e;break;case\"message\":this._message_handlers[n]=e;break;case\"roster\":this._roster_handlers[n]=e;break;default:return this._handler_ids--,null}return n},n.prototype.removeHandler=function(t){return delete this._presence_handlers[t],delete this._message_handlers[t],delete this._roster_handlers[t]},n.prototype._addOccupant=function(t){var n;return n=new e(t,this),this.roster[n.nick]=n},n.prototype._roomRosterHandler=function(t){var e,r,o,s,i;switch(s=(e=n._parsePresence(t)).nick,o=e.newnick||null,e.type){case\"error\":return!0;case\"unavailable\":o&&(e.nick=o,this.roster[s]&&this.roster[o]&&(this.roster[s].update(this.roster[o]),this.roster[o]=this.roster[s]),this.roster[s]&&!this.roster[o]&&(this.roster[o]=this.roster[s].update(e))),delete this.roster[s];break;default:this.roster[s]?this.roster[s].update(e):this._addOccupant(e)}for(r in i=this._roster_handlers)(0,i[r])(this.roster,this)||delete this._roster_handlers[r];return!0},n._parsePresence=function(e){var n,r,o,s,i,a,c,u,l,h;for((o={}).nick=t.Strophe.getResourceFromJid(e.getAttribute(\"from\")),o.type=e.getAttribute(\"type\"),o.states=[],s=0,a=(u=e.childNodes).length;s<a;s++)switch((n=u[s]).nodeName){case\"error\":o.errorcode=n.getAttribute(\"code\"),o.error=null!=(l=n.childNodes[0])?l.nodeName:void 0;break;case\"status\":o.status=n.textContent||null;break;case\"show\":o.show=n.textContent||null;break;case\"x\":if(n.getAttribute(\"xmlns\")===t.Strophe.NS.MUC_USER)for(i=0,c=(h=n.childNodes).length;i<c;i++)switch((r=h[i]).nodeName){case\"item\":o.affiliation=r.getAttribute(\"affiliation\"),o.role=r.getAttribute(\"role\"),o.jid=r.getAttribute(\"jid\"),o.newnick=r.getAttribute(\"nick\");break;case\"status\":r.getAttribute(\"code\")&&o.states.push(r.getAttribute(\"code\"))}}return o},n}(),e=function(){function t(t,e){this.room=e,this.update=o(this.update,this),this.admin=o(this.admin,this),this.owner=o(this.owner,this),this.revoke=o(this.revoke,this),this.member=o(this.member,this),this.ban=o(this.ban,this),this.modifyAffiliation=o(this.modifyAffiliation,this),this.deop=o(this.deop,this),this.op=o(this.op,this),this.mute=o(this.mute,this),this.voice=o(this.voice,this),this.kick=o(this.kick,this),this.modifyRole=o(this.modifyRole,this),this.update(t)}return t.prototype.modifyRole=function(t,e,n,r){return this.room.modifyRole(this.nick,t,e,n,r)},t.prototype.kick=function(t,e,n){return this.room.kick(this.nick,t,e,n)},t.prototype.voice=function(t,e,n){return this.room.voice(this.nick,t,e,n)},t.prototype.mute=function(t,e,n){return this.room.mute(this.nick,t,e,n)},t.prototype.op=function(t,e,n){return this.room.op(this.nick,t,e,n)},t.prototype.deop=function(t,e,n){return this.room.deop(this.nick,t,e,n)},t.prototype.modifyAffiliation=function(t,e,n,r){return this.room.modifyAffiliation(this.jid,t,e,n,r)},t.prototype.ban=function(t,e,n){return this.room.ban(this.jid,t,e,n)},t.prototype.member=function(t,e,n){return this.room.member(this.jid,t,e,n)},t.prototype.revoke=function(t,e,n){return this.room.revoke(this.jid,t,e,n)},t.prototype.owner=function(t,e,n){return this.room.owner(this.jid,t,e,n)},t.prototype.admin=function(t,e,n){return this.room.admin(this.jid,t,e,n)},t.prototype.update=function(t){return this.nick=t.nick||null,this.affiliation=t.affiliation||null,this.role=t.role||null,this.jid=t.jid||null,this.status=t.status||null,this.show=t.show||null,this},t}()}(n(12))},function(t,e,n){var r,o;r=[n(12)],void 0===(o=(function(t){var e,n,r;return n=t.$iq,r=function(t,r,o){var s=n(r?{type:t,to:r}:{type:t});return s.c(\"vCard\",{xmlns:e.NS.VCARD}),o&&s.cnode(o),s},(e=t.Strophe).addConnectionPlugin(\"vcard\",{_connection:null,init:function(t){return this._connection=t,e.addNamespace(\"VCARD\",\"vcard-temp\")},get:function(t,e,n){var o=r(\"get\",e);return this._connection.sendIQ(o,t,n)},set:function(t,e,n,o){var s=r(\"set\",n,e);return this._connection.sendIQ(s,t,o)}}),t}).apply(e,r))||(t.exports=o)},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(3),o=n(0),s=n(8),i=function(){function t(){}return t.transformVCard=function(t){var e={};return e[o.UserConstants.NAME]=unescape(s.parseHTML(t.getElementsByTagName(o.UserConstants.NAME)[0])),e[o.UserConstants.UID]=unescape(s.parseHTML(t.getElementsByTagName(o.UserConstants.UID)[0])),e[o.UserConstants.AVATAR]=unescape(s.parseHTML(t.getElementsByTagName(o.UserConstants.AVATAR)[0])),e[o.UserConstants.LINK]=unescape(s.parseHTML(t.getElementsByTagName(o.UserConstants.LINK)[0])),e[o.UserConstants.STATUS]=unescape(s.parseHTML(t.getElementsByTagName(o.UserConstants.STATUS)[0])),e[o.UserConstants.LAST_ACTIVE_AT]=unescape(s.parseHTML(t.getElementsByTagName(o.UserConstants.LAST_ACTIVE_AT)[0])),e[o.UserConstants.ROLE]=unescape(s.parseHTML(t.getElementsByTagName(o.UserConstants.ROLE)[0])),e[o.UserConstants.USER_NAME]=unescape(s.parseHTML(t.getElementsByTagName(o.UserConstants.USER_NAME)[0])),new r.User(e)},t}();e.VCardController=i},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(6),o=n(1),s=n(4),i=n(32),a=function(){function t(e){this.limit=t.DEFAULT_LIMIT,this.cursor=-1,this.total=-1,this.next_page=1,this.last_page=-1,this.current_page=1,this.total_pages=-1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},o.isFalsy(e)||(o.isFalsy(e.limit)&&(e.limit=t.DEFAULT_LIMIT),e.limit>t.MAX_LIMIT&&(e.limit=t.MAX_LIMIT),this.limit=e.limit,this.search_keyword=e.searchKeyWord)}return t.prototype.fetchPrevious=function(){var t=this;return new Promise(function(e,n){if(0!=t.next_page)return r.makeApiCall(\"groups\",{},t.getPreData()).then(function(n){if(n.meta&&(t.total_pages=n.meta.pagination.total_pages),0<n.data.length){t.pagination=n.meta.pagination;var r=[];n.data.map(function(t,e){r.push(i.GroupsController.trasformJSONGroup(t))}),e(r)}e([])});e([])})},t.prototype.fetchNext=function(){var t=this;return new Promise(function(e,n){r.makeApiCall(\"getGroups\",{},t.getNextData()).then(function(n){if(n.meta&&(t.total_pages=n.meta.pagination.total_pages),0<n.data.length){t.pagination=n.meta.pagination;var r=[];n.data.map(function(t,e){r.push(i.GroupsController.trasformJSONGroup(t))}),e(r)}e([])},function(t){n(new s.CometChatException(t.error))})})},t.prototype.getNextData=function(){var t={};if(t.per_page=this.limit,1==this.current_page)t.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return t.page=this.next_page,t;t.page=this.next_page++}return t},t.prototype.getPreData=function(){var t={};return t.per_page=this.limit,0<=this.next_page&&0<this.next_page&&(t.page=--this.next_page),t},t.MAX_LIMIT=100,t.DEFAULT_LIMIT=30,t}();e.GroupsRequest=a;var c=function(){function t(){}return t.prototype.setLimit=function(t){return this.limit=t,this},t.prototype.setSearchKeyWord=function(t){return this.searchKeyWord=t,this},t.prototype.build=function(){return new a(this)},t}();e.GroupsRequestBuilder=c},function(t,e,n){\"use strict\";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var s=n(6),i=n(1),a=n(5),c=n(4),u=n(48),l=n(7),h=n(0),d=n(2),p=function(){function t(e){this.limit=t.DEFAULT_LIMIT,this.cursor=-1,this.total=-1,this.next_page=1,this.last_page=-1,this.current_page=1,this.total_pages=-1,this.isOutCastReq=!1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},this.store=a.LocalStorage.getInstance(),i.isFalsy(e)||(this.limit=e.limit,this.guid=e.guid,this.search_keyword=e.searchKeyWord,e instanceof g&&(this.isOutCastReq=e.isOutCastReq))}return t.prototype.fetchPrevious=function(){var t=this;return new Promise(function(e,n){if(0!=t.next_page)return s.makeApiCall(t.isOutCastReq?\"getBannedGroupMembers\":\"getGroupMembers\",{guid:t.guid},t.getPreData()).then(function(n){if(n.meta&&(t.total_pages=n.meta.pagination.total_pages),0<n.data.length){t.pagination=n.meta.pagination;var r=[];n.data.map(function(e){e.guid=t.guid,r.push(u.GroupMembersController.trasformJSONGroupMember(e))}),e(r)}e([])},function(t){n(new c.CometChatException(t.error))});e([])})},t.prototype.fetchNext=function(){var t=this;return new Promise(function(e,n){s.makeApiCall(t.isOutCastReq?\"getBannedGroupMembers\":\"getGroupMembers\",{guid:t.guid},t.getNextData()).then(function(n){if(n.meta&&(t.total_pages=n.meta.pagination.total_pages),0<n.data.length){t.pagination=n.meta.pagination;var r=[];n.data.map(function(e){e.guid=t.guid,r.push(u.GroupMembersController.trasformJSONGroupMember(e))});var o=[];r.map(function(t){o.push(i.format(h.XMPP.username_string,d.CometChat.getAppId(),t[h.UserConstants.UID]))}),l.XMPPConnectionHelper.getInstance().getPresenceInfo(o,function(t){r.map(function(e,n){t[n]&&(e.setLastActiveAt(t[n].getLastActiveAt()),e.setStatus(t[n].getStatus()))}),e(r)})}else e([])},function(t){n(new c.CometChatException(t.error))})})},t.prototype.getNextData=function(){var t={};if(t.per_page=this.limit,1==this.current_page)t.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return t.page=this.next_page,t;t.page=++this.next_page}return t},t.prototype.getPreData=function(){var t={};return t.per_page=this.limit,0<=this.next_page&&0<this.next_page&&(t.page=--this.next_page),t},t.MAX_LIMIT=2,t.DEFAULT_LIMIT=1,t}();e.GroupMembersRequest=p;var f=function(){function t(t){this.guid=t}return t.prototype.setLimit=function(t){return this.limit=t,this},t.prototype.setSearchKeyWord=function(t){return this.searchKeyWord=t,this},t.prototype.build=function(){return new p(this)},t}(),g=function(t){function e(e){var n=t.call(this,e)||this;return n.isOutCastReq=!0,n}return o(e,t),e.prototype.build=function(){return new p(this)},e}(e.GroupMembersRequestBuilder=f);e.GroupOutCastMembersRequestBuilder=g},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(35),o=n(0),s=n(1),i=function(){function t(){}return t.trasformJSONGroupMember=function(t){var e;try{return e=new r.GroupMember(t[o.GroupMemersConstans.KEYS.UID]),Object.assign(e,t),e}catch(e){return s.Logger.error(\"GroupMembersController:trasformJSONGroupMember\",{e:e,groupMember:t}),t}},t}();e.GroupMembersController=i},function(t,e,n){\"use strict\";e.__esModule=!0;var r=n(6),o=n(1),s=n(5),i=n(3),a=n(31),c=n(4),u=n(33),l=n(7),h=n(0),d=n(2),p=function(){function t(e){this.limit=t.DEFAULT_LIMIT,this.cursor=-1,this.total=-1,this.next_page=1,this.last_page=-1,this.current_page=1,this.total_pages=-1,this.fetchingInProgress=!1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},this.store=s.LocalStorage.getInstance(),t.userStore=u.UserStore.getInstance(),o.isFalsy(e)||(this.limit=e.limit,this.search_keyword=e.searchKeyWord)}return t.prototype.fetchPrevious=function(){var e=this;return this.fetchingInProgress=!0,new Promise(function(n,o){if(0==e.next_page)n([]),e.fetchingInProgress=!1;else{if(!e.fetchingInProgress)return r.makeApiCall(\"users\",{},e.getPreData()).then(function(r){if(r.meta&&(e.total_pages=r.meta.pagination.total_pages),0<r.data.length){e.pagination=r.meta.pagination;var o=[];r.data.map(function(t,e){o.push(a.UsersController.trasformJSONUser(t))}),t.userStore.storeUsers(o),n(o),e.fetchingInProgress=!1}n([]),e.fetchingInProgress=!1},function(t){o(new c.CometChatException(t.error)),e.fetchingInProgress=!1});n([])}})},t.prototype.fetchNext=function(){var t=this;return new Promise(function(e,n){t.fetchingInProgress?(t.fetchingInProgress=!1,e([])):(t.fetchingInProgress=!0,r.makeApiCall(\"users\",{},t.getNextData()).then(function(n){if(n.meta&&(t.total_pages=n.meta.pagination.total_pages),0<n.data.length){t.pagination=n.meta.pagination;var r=[],s=[];n.data.map(function(t){r.push(a.UsersController.trasformJSONUser(t)),s.push(o.format(h.XMPP.username_string,d.CometChat.getAppId(),t[h.UserConstants.UID]))}),l.XMPPConnectionHelper.getInstance().getPresenceInfo(s,function(n){var o=[];r.map(function(t,e){if(n[e]){var r=new i.User(t);r.setLastActiveAt(n[e].getLastActiveAt()),r.setStatus(n[e].getStatus()),o.push(r)}}),t.fetchingInProgress=!1,e(o)})}else e([])},function(e){t.fetchingInProgress=!1,n(new c.CometChatException(e.error))}))})},t.prototype.getNextData=function(){var t={};if(t.per_page=this.limit,0==this.current_page)t.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return t.page=this.next_page,t;t.page=++this.next_page}return t},t.prototype.getPreData=function(){var t={};return t.per_page=this.limit,0<=this.next_page&&0<this.next_page&&(t.page=--this.next_page),t},t.MAX_LIMIT=2,t.DEFAULT_LIMIT=1,t}();e.UsersRequest=p;var f=function(){function t(){}return t.prototype.setLimit=function(t){return this.limit=t,this},t.prototype.setSearchKeyWord=function(t){return this.searchKeyWord=t,this},t.prototype.build=function(){return new p(this)},t}();e.UsersRequestBuilder=f},function(t,e,n){\"use strict\";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,s){function i(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(i,a)}c((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},\"function\"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError(\"Generator is already executing.\");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(a){s=[6,a],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};e.__esModule=!0;var s=n(4),i=n(6),a=n(13),c=n(1),u=n(16),l=n(0),h=n(34),d=n(2),p=n(7),f=n(8),g=n(20),E=n(14),m=function(){function t(t){this.limit=l.DEFAULT_VALUES.MSGS_LIMIT,this.timestamp=0,this.id=l.DEFAULT_VALUES.DEFAULT_MSG_ID,this.messageStore=u.MessagesStore.getInstance(),this.endpointName=\"getUserMessages\",this.listId=\"\",this.totalPages=0,this.inProgress=!1,this.paginationMeta={},this.limit=t.limit,this.paginationMeta[l.MessageConstatnts.PAGINATION.KEYS.PER_PAGE]=this.limit,this.uid=t.uid,this.uid&&(this.paginationMeta[l.MessageConstatnts.PAGINATION.KEYS.UID]=this.uid),this.guid=t.guid,this.timestamp=t.timestamp,this.timestamp&&(this.paginationMeta[l.MessageConstatnts.PAGINATION.KEYS.SENT_AT]=this.timestamp),this.id=t.id,this.id!=l.DEFAULT_VALUES.DEFAULT_MSG_ID&&(this.paginationMeta[l.MessageConstatnts.PAGINATION.KEYS.ID]=this.id)}return t.prototype.fetchNext=function(){var t=this;return new Promise(function(e,n){return r(t,void 0,void 0,function(){var t,r,i;return o(this,function(o){switch(o.label){case 0:if(this.inProgress)return n(new s.CometChatException(h.MESSAGES_REQUEST_ERRORS.REQUEST_IN_PROGRESS_ERROR)),this.inProgress=!1,[2];if(this.inProgress=!0,0==this.timestamp&&0==this.id)return n(new s.CometChatException(h.MESSAGES_REQUEST_ERRORS.NOT_ENOUGH_PARAMS)),[2];this.affix=l.MessageConstatnts.PAGINATION.AFFIX.APPEND,this.paginationMeta[l.MessageConstatnts.PAGINATION.KEYS.AFFIX]=this.affix,this.currentMethod=l.MessageConstatnts.PAGINATION.AFFIX.APPEND,o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.makeAPICall()];case 2:return t=o.sent(),[4,E.ExtensionController.hookOnMessageListIsFetched(t)];case 3:return r=o.sent(),e(r),this.inProgress=!1,[3,5];case 4:return i=o.sent(),n(i),this.inProgress=!1,[3,5];case 5:return[2]}})})})},t.prototype.fetchPrevious=function(){var t=this;return new Promise(function(e,n){return r(t,void 0,void 0,function(){var t,r,i;return o(this,function(o){switch(o.label){case 0:if(this.inProgress)return n(new s.CometChatException(h.MESSAGES_REQUEST_ERRORS.REQUEST_IN_PROGRESS_ERROR)),this.inProgress=!1,[2];this.inProgress=!0,this.affix=l.MessageConstatnts.PAGINATION.AFFIX.PREPEND,this.paginationMeta[l.MessageConstatnts.PAGINATION.KEYS.AFFIX]=this.affix,this.currentMethod=l.MessageConstatnts.PAGINATION.AFFIX.PREPEND,o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.makeAPICall()];case 2:return t=o.sent(),[4,E.ExtensionController.hookOnMessageListIsFetched(t)];case 3:return r=o.sent(),e(r),this.inProgress=!1,[3,5];case 4:return i=o.sent(),n(i),this.inProgress=!1,[3,5];case 5:return[2]}})})})},t.prototype.makeAPICall=function(){var t=this;return new Promise(function(e,n){if(t.createEndpoint(),t.totalPages)if(1!=t.totalPages);else if(t.lastAffix==t.affix)return void e([]);i.makeApiCall(t.endpointName,{listId:t.listId},t.paginationMeta).then(function(n){var r=[];n[l.ResponseConstants.RESPONSE_KEYS.KEY_META][l.ResponseConstants.RESPONSE_KEYS.KEY_CURSOR].hasOwnProperty(l.MessageConstatnts.PAGINATION.KEYS.ID)&&0==t.id&&(t.id=n.meta.cursor[l.MessageConstatnts.PAGINATION.KEYS.ID]),n[l.ResponseConstants.RESPONSE_KEYS.KEY_META][l.ResponseConstants.RESPONSE_KEYS.KEY_CURSOR].hasOwnProperty(l.MessageConstatnts.PAGINATION.KEYS.SENT_AT)&&0==t.timestamp&&(t.timestamp=n.meta.cursor[l.MessageConstatnts.PAGINATION.KEYS.SENT_AT]),n.meta.pagination.hasOwnProperty(\"total_pages\")&&(t.totalPages=n.meta.pagination.total_pages),n.meta.cursor.hasOwnProperty(\"affix\")&&(t.lastAffix=n.meta.cursor.affix),n.data[0]?(0<t.id&&(t.id=n.data[0].id),0<t.timestamp&&(t.timestamp=n.data[0].sentAt),n.data.map(function(e){if(e.sender.toLowerCase()!=f.getUidFromJid(p.XMPPConnectionHelper.getInstance().connection.jid).toLowerCase()){var n=e.id,o=e.receiverType,s=l.MessageConstatnts.XMPP_KEYS.TYPE_USER,i=e.sender;o==l.MessageConstatnts.RECEIVER_TYPE.USER?c.isFalsy(e.deliveredAt)&&(s=l.MessageConstatnts.XMPP_KEYS.TYPE_USER,f.getJidFromUid(i).then(function(t){var e=$msg({to:t,type:s,from:p.XMPPConnectionHelper.getInstance().connection.jid,id:p.XMPPConnectionHelper.getInstance().connection.getUniqueId()}),r=Strophe.xmlElement(\"received\",{type:o,xmlns:\"urn:xmpp:receipts\",id:\"[\"+d.CometChat.getAppId()+\"]\"+n});e.tree().appendChild(r),p.XMPPConnectionHelper.getInstance().connection.send(e)})):c.isFalsy(e.receipts.data)&&(s=l.MessageConstatnts.XMPP_KEYS.TYPE_USER,f.getJidFromUid(i=e.sender).then(function(t){var e=$msg({to:t,type:s,from:p.XMPPConnectionHelper.getInstance().connection.jid,id:p.XMPPConnectionHelper.getInstance().connection.getUniqueId()}),r=Strophe.xmlElement(\"received\",{type:o,xmlns:\"urn:xmpp:receipts\",id:\"[\"+d.CometChat.getAppId()+\"]\"+n});e.tree().appendChild(r),p.XMPPConnectionHelper.getInstance().connection.send(e)})),p.XMPPConnectionHelper.getInstance()}g.MessageListnerMaping.getInstance().get(\"all\").then(function(t){e.id>t&&g.MessageListnerMaping.getInstance().set(\"all\",e.id)},function(t){g.MessageListnerMaping.getInstance().set(\"all\",e.id)}),t.affix==l.MessageConstatnts.PAGINATION.AFFIX.APPEND?(t.id<e.id&&0<t.id&&(t.id=e.id),t.timestamp<e.sentAt&&0<t.timestamp&&(t.timestamp=e.sentAt)):(t.id>e.id&&(t.id=e.id),t.timestamp>e.sentAt&&(t.timestamp=e.sentAt)),t.paginationMeta[l.MessageConstatnts.PAGINATION.KEYS.ID]=t.id,r.push(a.MessageController.trasformJSONMessge(e))})):r=[],e(r)},function(t){n(t)})})},t.prototype.createEndpoint=function(){(c.isFalsy(this.guid)||c.isFalsy(this.uid))&&c.isFalsy(this.guid)?(this.endpointName=c.isFalsy(this.uid)?\"getMessages\":\"getUserMessages\",this.listId=this.uid):(this.endpointName=\"getGroupMessages\",this.listId=this.guid)},t.prototype.makeData=function(){var t={};t[l.MessageConstatnts.PAGINATION.KEYS.PER_PAGE]=this.limit,t[l.MessageConstatnts.PAGINATION.KEYS.AFFIX]=this.affix,(c.isFalsy(this.guid)||c.isFalsy(this.uid))&&c.isFalsy(this.guid)&&c.isFalsy(this.uid)},t.prototype.getFilteredPreviousDataByReceiverId=function(t){return r(this,void 0,void 0,function(){var e,n=this;return o(this,function(r){switch(r.label){case 0:switch(e=[],t){case\"user\":return[3,1];case\"group\":return[3,3];case\"both\":return[3,5]}return[3,7];case 1:return[4,u.MessagesStore.getInstance().get(this.uid).then(function(t){Object.keys(t).filter(function(t){return parseInt(t)>n.id}).map(function(n){e=e.concat([t[n]])})})];case 2:return r.sent(),[3,9];case 3:return[4,u.MessagesStore.getInstance().get(this.guid).then(function(t){Object.keys(t).filter(function(t){return parseInt(t)>n.id}).map(function(n){e=e.concat([t[n]])})})];case 4:r.sent(),r.label=5;case 5:return[4,u.MessagesStore.getInstance().get(this.guid).then(function(t){Object.keys(t).filter(function(t){return parseInt(t)>n.id}).filter(function(e){return t[e].sender.uid==n.uid}).map(function(n){e=e.concat([t[n]])})})];case 6:return r.sent(),[3,9];case 7:return[4,u.MessagesStore.getInstance().getAllMessages().then(function(t){Object.keys(t).filter(function(t){return parseInt(t)>n.id}).map(function(n){e=e.concat([t[n]])})})];case 8:return r.sent(),[3,9];case 9:return[2,e]}})})},t.prototype.getFilteredNextDataByReceiverId=function(t){return r(this,void 0,void 0,function(){var e,n=this;return o(this,function(r){switch(r.label){case 0:switch(e=[],t){case\"user\":return[3,1];case\"group\":return[3,3];case\"both\":return[3,5]}return[3,7];case 1:return[4,u.MessagesStore.getInstance().get(this.uid).then(function(t){Object.keys(t).filter(function(t){return parseInt(t)>n.id}).map(function(n){e=e.concat([t[n]])})})];case 2:return r.sent(),[3,9];case 3:return[4,u.MessagesStore.getInstance().get(this.guid).then(function(t){Object.keys(t).filter(function(t){return parseInt(t)>n.id}).map(function(n){e=e.concat([t[n]])})})];case 4:r.sent(),r.label=5;case 5:return[4,u.MessagesStore.getInstance().get(this.guid).then(function(t){Object.keys(t).filter(function(t){return parseInt(t)>n.id}).filter(function(e){return t[e].sender.uid==n.uid}).map(function(n){e=e.concat([t[n]])})})];case 6:return r.sent(),[3,9];case 7:return[4,u.MessagesStore.getInstance().getAllMessages().then(function(t){Object.keys(t).filter(function(t){return parseInt(t)>n.id}).map(function(n){e=e.concat([t[n]])})})];case 8:return r.sent(),[3,9];case 9:return[2,e]}})})},t}();e.DefaultMessagesRequest=m;var _=function(){function t(){this.limit=l.DEFAULT_VALUES.MSGS_LIMIT,this.maxLimit=l.DEFAULT_VALUES.MSGS_MAX_LIMIT,this.timestamp=0,this.id=l.DEFAULT_VALUES.DEFAULT_MSG_ID}return t.prototype.setLimit=function(t){return void 0===t&&(t=l.DEFAULT_VALUES.MSGS_LIMIT),t>this.maxLimit&&(t=this.maxLimit),this.limit=t,this},t.prototype.setGUID=function(t){return this.guid=t,this},t.prototype.setUID=function(t){return this.uid=t,this},t.prototype.setTimestamp=function(t){return void 0===t&&(t=c.getCurrentTime()),this.timestamp=t,this},t.prototype.setMessageId=function(t){return void 0===t&&(t=l.DEFAULT_VALUES.DEFAULT_MSG_ID),this.id=t,this},t.prototype.build=function(){return new m(this)},t}();e.DefaultMessagesRequestBuilder=_},function(t,e,n){\"use strict\";e.__esModule=!0,n(14),e.CometChatExtension=function(t){}},function(t,e,n){function r(t){this.options=t||{locator:{}}}function o(){this.cdata=!1}function s(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}function i(t,e,n){return\"string\"==typeof t?t.substr(e,n):t.length>=e+n||e?new java.lang.String(t,e,n)+\"\":t}function a(t,e){t.currentElement?t.currentElement.appendChild(e):t.doc.appendChild(e)}r.prototype.parseFromString=function(t,e){var n=this.options,r=new c,s=n.domBuilder||new o,i=n.errorHandler,a=n.locator,u=n.xmlns||{},l={lt:\"<\",gt:\">\",amp:\"&\",quot:'\"',apos:\"'\"};return a&&s.setDocumentLocator(a),r.errorHandler=function(t,e,n){if(!t){if(e instanceof o)return e;t=e}var r={},s=t instanceof Function;function i(e){var o=t[e];!o&&s&&(o=2==t.length?function(n){t(e,n)}:t),r[e]=o&&function(t){o(\"[xmldom \"+e+\"]\\t\"+t+function(t){if(n)return\"\\n@\"+(n.systemId||\"\")+\"#[line:\"+n.lineNumber+\",col:\"+n.columnNumber+\"]\"}())}||function(){}}return n=n||{},i(\"warning\"),i(\"error\"),i(\"fatalError\"),r}(i,s,a),r.domBuilder=n.domBuilder||s,/\\/x?html?$/.test(e)&&(l.nbsp=\"\\xa0\",l.copy=\"\\xa9\",u[\"\"]=\"http://www.w3.org/1999/xhtml\"),u.xml=u.xml||\"http://www.w3.org/XML/1998/namespace\",t?r.parse(t,u,l):r.errorHandler.error(\"invalid doc source\"),s.doc},o.prototype={startDocument:function(){this.doc=(new u).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(t,e,n,r){var o=this.doc,i=o.createElementNS(t,n||e),c=r.length;a(this,i),this.currentElement=i,this.locator&&s(this.locator,i);for(var u=0;u<c;u++){t=r.getURI(u);var l=r.getValue(u),h=(n=r.getQName(u),o.createAttributeNS(t,n));this.locator&&s(r.getLocator(u),h),h.value=h.nodeValue=l,i.setAttributeNode(h)}},endElement:function(t,e,n){this.currentElement=this.currentElement.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){var n=this.doc.createProcessingInstruction(t,e);this.locator&&s(this.locator,n),a(this,n)},ignorableWhitespace:function(t,e,n){},characters:function(t,e,n){if(t=i.apply(this,arguments)){if(this.cdata)var r=this.doc.createCDATASection(t);else r=this.doc.createTextNode(t);this.currentElement?this.currentElement.appendChild(r):/^\\s*$/.test(t)&&this.doc.appendChild(r),this.locator&&s(this.locator,r)}},skippedEntity:function(t){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,n){t=i.apply(this,arguments);var r=this.doc.createComment(t);this.locator&&s(this.locator,r),a(this,r)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,n){var r=this.doc.implementation;if(r&&r.createDocumentType){var o=r.createDocumentType(t,e,n);this.locator&&s(this.locator,o),a(this,o)}},warning:function(t){},error:function(t){},fatalError:function(t){throw t}},\"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl\".replace(/\\w+/g,function(t){o.prototype[t]=function(){return null}});var c=n(53).XMLReader,u=e.DOMImplementation=n(36).DOMImplementation;e.XMLSerializer=n(36).XMLSerializer,e.DOMParser=r},function(t,e){var n=/[A-Z_a-z\\xC0-\\xD6\\xD8-\\xF6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]/,r=new RegExp(\"[\\\\-\\\\.0-9\"+n.source.slice(1,-1)+\"\\\\u00B7\\\\u0300-\\\\u036F\\\\u203F-\\\\u2040]\"),o=new RegExp(\"^\"+n.source+r.source+\"*(?::\"+n.source+r.source+\"*)?$\"),s=0,i=1,a=2,c=3,u=4,l=5,h=6,d=7;function p(){}function f(t,e){return e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber,e}function g(t,e,n,r,o,p){for(var f,g=++e,E=s;;){var m=t.charAt(g);switch(m){case\"=\":if(E===i)f=t.slice(e,g),E=c;else{if(E!==a)throw new Error(\"attribute equal must after attrName\");E=c}break;case\"'\":case'\"':if(E===c||E===i){if(E===i&&(p.warning('attribute value must after \"=\"'),f=t.slice(e,g)),!(0<(g=t.indexOf(m,e=g+1))))throw new Error(\"attribute value no end '\"+m+\"' match\");_=t.slice(e,g).replace(/&#?\\w+;/g,o),n.add(f,_,e-1),E=l}else{if(E!=u)throw new Error('attribute value must after \"=\"');_=t.slice(e,g).replace(/&#?\\w+;/g,o),n.add(f,_,e),p.warning('attribute \"'+f+'\" missed start quot('+m+\")!!\"),e=g+1,E=l}break;case\"/\":switch(E){case s:n.setTagName(t.slice(e,g));case l:case h:case d:E=d,n.closed=!0;case u:case i:case a:break;default:throw new Error(\"attribute invalid close char('/')\")}break;case\"\":return p.error(\"unexpected end of input\"),E==s&&n.setTagName(t.slice(e,g)),g;case\">\":switch(E){case s:n.setTagName(t.slice(e,g));case l:case h:case d:break;case u:case i:\"/\"===(_=t.slice(e,g)).slice(-1)&&(n.closed=!0,_=_.slice(0,-1));case a:E===a&&(_=f),E==u?(p.warning('attribute \"'+_+'\" missed quot(\")!!'),n.add(f,_.replace(/&#?\\w+;/g,o),e)):(\"http://www.w3.org/1999/xhtml\"===r[\"\"]&&_.match(/^(?:disabled|checked|selected)$/i)||p.warning('attribute \"'+_+'\" missed value!! \"'+_+'\" instead!!'),n.add(_,_,e));break;case c:throw new Error(\"attribute value missed!!\")}return g;case\"\\x80\":m=\" \";default:if(m<=\" \")switch(E){case s:n.setTagName(t.slice(e,g)),E=h;break;case i:f=t.slice(e,g),E=a;break;case u:var _=t.slice(e,g).replace(/&#?\\w+;/g,o);p.warning('attribute \"'+_+'\" missed quot(\")!!'),n.add(f,_,e);case l:E=h}else switch(E){case a:\"http://www.w3.org/1999/xhtml\"===r[\"\"]&&f.match(/^(?:disabled|checked|selected)$/i)||p.warning('attribute \"'+f+'\" missed value!! \"'+f+'\" instead2!!'),n.add(f,f,e),e=g,E=i;break;case l:p.warning('attribute space is required\"'+f+'\"!!');case h:E=i,e=g;break;case c:E=u,e=g;break;case d:throw new Error(\"elements closed character '/' and '>' must be connected to\")}}g++}}function E(t,e,n){for(var r=t.tagName,o=null,s=t.length;s--;){var i=t[s],a=i.qName,c=i.value;if(0<(d=a.indexOf(\":\")))var u=i.prefix=a.slice(0,d),l=a.slice(d+1),h=\"xmlns\"===u&&l;else u=null,h=\"xmlns\"===(l=a)&&\"\";i.localName=l,!1!==h&&(null==o&&(o={},T(n,n={})),n[h]=o[h]=c,i.uri=\"http://www.w3.org/2000/xmlns/\",e.startPrefixMapping(h,c))}for(s=t.length;s--;)(u=(i=t[s]).prefix)&&(\"xml\"===u&&(i.uri=\"http://www.w3.org/XML/1998/namespace\"),\"xmlns\"!==u&&(i.uri=n[u||\"\"]));var d=r.indexOf(\":\");l=t.localName=0<d?(u=t.prefix=r.slice(0,d),r.slice(d+1)):(u=null,r);var p=t.uri=n[u||\"\"];if(e.startElement(p,l,r,t),!t.closed)return t.currentNSMap=n,t.localNSMap=o,!0;if(e.endElement(p,l,r),o)for(u in o)e.endPrefixMapping(u)}function m(t,e,n,r,o){if(/^(?:script|textarea)$/i.test(n)){var s=t.indexOf(\"</\"+n+\">\",e),i=t.substring(e+1,s);if(/[&<]/.test(i))return/^script$/i.test(n)||(i=i.replace(/&#?\\w+;/g,r)),o.characters(i,0,i.length),s}return e+1}function _(t,e,n,r){var o=r[n];return null==o&&((o=t.lastIndexOf(\"</\"+n+\">\"))<e&&(o=t.lastIndexOf(\"</\"+n)),r[n]=o),o<e}function T(t,e){for(var n in t)e[n]=t[n]}function C(t,e,n,r){switch(t.charAt(e+2)){case\"-\":return\"-\"!==t.charAt(e+3)?-1:e<(o=t.indexOf(\"--\\x3e\",e+4))?(n.comment(t,e+4,o-e-4),o+3):(r.error(\"Unclosed comment\"),-1);default:if(\"CDATA[\"==t.substr(e+3,6)){var o=t.indexOf(\"]]>\",e+9);return n.startCDATA(),n.characters(t,e+9,o-e-9),n.endCDATA(),o+3}var s=function(t,e){var n,r=[],o=/'[^']+'|\"[^\"]+\"|[^\\s<>\\/=]+=?|(\\/?\\s*>|<)/g;for(o.lastIndex=e,o.exec(t);n=o.exec(t);)if(r.push(n),n[1])return r}(t,e),i=s.length;if(1<i&&/!doctype/i.test(s[0][0])){var a=s[1][0],c=3<i&&/^public$/i.test(s[2][0])&&s[3][0],u=4<i&&s[4][0],l=s[i-1];return n.startDTD(a,c&&c.replace(/^(['\"])(.*?)\\1$/,\"$2\"),u&&u.replace(/^(['\"])(.*?)\\1$/,\"$2\")),n.endDTD(),l.index+l[0].length}}return-1}function S(t,e,n){var r=t.indexOf(\"?>\",e);if(r){var o=t.substring(e,r).match(/^<\\?(\\S*)\\s*([\\s\\S]*?)\\s*$/);return o?(n.processingInstruction(o[1],o[2]),r+2):-1}return-1}function A(t){}function y(t,e){return t.__proto__=e,t}p.prototype={parse:function(t,e,n){var r=this.domBuilder;r.startDocument(),T(e,e={}),function(t,e,n,r,o){function s(t){var e=t.slice(1,-1);return e in n?n[e]:\"#\"===e.charAt(0)?function(t){if(65535<t){var e=55296+((t-=65536)>>10);return String.fromCharCode(e,56320+(1023&t))}return String.fromCharCode(t)}(parseInt(e.substr(1).replace(\"x\",\"0x\"))):(o.error(\"entity not found:\"+t),t)}function i(e){if(T<e){var n=t.substring(T,e).replace(/&#?\\w+;/g,s);h&&a(T),r.characters(n,0,e-T),T=e}}function a(e,n){for(;u<=e&&(n=l.exec(t));)u=(c=n.index)+n[0].length,h.lineNumber++;h.columnNumber=e-c+1}for(var c=0,u=0,l=/.*(?:\\r\\n?|\\n)|.*$/g,h=r.locator,d=[{currentNSMap:e}],p={},T=0;;){try{var y=t.indexOf(\"<\",T);if(y<0){if(!t.substr(T).match(/^\\s*$/)){var I=r.doc,v=I.createTextNode(t.substr(T));I.appendChild(v),r.currentElement=v}return}switch(T<y&&i(y),t.charAt(y+1)){case\"/\":var N=t.indexOf(\">\",y+3),M=t.substring(y+2,N),R=d.pop();N<0?(M=t.substring(y+2).replace(/[\\s<].*/,\"\"),o.error(\"end tag name: \"+M+\" is not complete:\"+R.tagName),N=y+1+M.length):M.match(/\\s</)&&(M=M.replace(/[\\s<].*/,\"\"),o.error(\"end tag name: \"+M+\" maybe not complete\"),N=y+1+M.length);var O=R.localNSMap,P=R.tagName==M;if(P||R.tagName&&R.tagName.toLowerCase()==M.toLowerCase()){if(r.endElement(R.uri,R.localName,M),O)for(var b in O)r.endPrefixMapping(b);P||o.fatalError(\"end tag name: \"+M+\" is not match the current start tagName:\"+R.tagName)}else d.push(R);N++;break;case\"?\":h&&a(y),N=S(t,y,r);break;case\"!\":h&&a(y),N=C(t,y,r,o);break;default:h&&a(y);var L=new A,w=d[d.length-1].currentNSMap,D=(N=g(t,y,L,w,s,o),L.length);if(!L.closed&&_(t,N,L.tagName,p)&&(L.closed=!0,n.nbsp||o.warning(\"unclosed xml attribute\")),h&&D){for(var x=f(h,{}),U=0;U<D;U++){var Y=L[U];a(Y.offset),Y.locator=f(h,{})}r.locator=x,E(L,r,w)&&d.push(L),r.locator=h}else E(L,r,w)&&d.push(L);\"http://www.w3.org/1999/xhtml\"!==L.uri||L.closed?N++:N=m(t,N,L.tagName,s,r)}}catch(e){o.error(\"element parse error: \"+e),N=-1}T<N?T=N:i(Math.max(y,T)+1)}}(t,e,n,r,this.errorHandler),r.endDocument()}},A.prototype={setTagName:function(t){if(!o.test(t))throw new Error(\"invalid tagName:\"+t);this.tagName=t},add:function(t,e,n){if(!o.test(t))throw new Error(\"invalid attribute:\"+t);this[this.length++]={qName:t,value:e,offset:n}},length:0,getLocalName:function(t){return this[t].localName},getLocator:function(t){return this[t].locator},getQName:function(t){return this[t].qName},getURI:function(t){return this[t].uri},getValue:function(t){return this[t].value}},y({},y.prototype)instanceof y||(y=function(t,e){function n(){}for(e in n.prototype=e,n=new n,t)n[e]=t[e];return n}),e.XMLReader=p}]))}}]);","extractedComments":[]}